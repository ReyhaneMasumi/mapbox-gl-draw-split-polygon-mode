import Xr from"https://unpkg.com/@mapbox/mapbox-gl-draw@1.3.0/src/lib/theme.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function r(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerpolicy&&(i.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?i.credentials="include":o.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(o){if(o.ep)return;o.ep=!0;const i=r(o);fetch(o.href,i)}})();const V={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},qe={POLYGON:"polygon",LINE:"line_string",POINT:"point"},$={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},k={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},Me={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},Ie={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},W={ACTIVE:"true",INACTIVE:"false"};var T=63710088e-1,Ze={centimeters:T*100,centimetres:T*100,degrees:T/111325,feet:T*3.28084,inches:T*39.37,kilometers:T/1e3,kilometres:T/1e3,meters:T,metres:T,miles:T/1609.344,millimeters:T*1e3,millimetres:T*1e3,nauticalmiles:T/1852,radians:1,yards:T*1.0936},zr={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/T,yards:1.0936133},Re={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function R(t,e,r){r===void 0&&(r={});var n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=e||{},n.geometry=t,n}function $r(t,e,r){switch(t){case"Point":return z(e).geometry;case"LineString":return N(e).geometry;case"Polygon":return se(e).geometry;case"MultiPoint":return br(e).geometry;case"MultiLineString":return _e(e).geometry;case"MultiPolygon":return Le(e).geometry;default:throw new Error(t+" is invalid")}}function z(t,e,r){if(r===void 0&&(r={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ee(t[0])||!Ee(t[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:t};return R(n,e,r)}function qr(t,e,r){return r===void 0&&(r={}),K(t.map(function(n){return z(n,e)}),r)}function se(t,e,r){r===void 0&&(r={});for(var n=0,o=t;n<o.length;n++){var i=o[n];if(i.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<i[i.length-1].length;a++)if(i[i.length-1][a]!==i[0][a])throw new Error("First and last Position are not equivalent.")}var u={type:"Polygon",coordinates:t};return R(u,e,r)}function Zr(t,e,r){return r===void 0&&(r={}),K(t.map(function(n){return se(n,e)}),r)}function N(t,e,r){if(r===void 0&&(r={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:t};return R(n,e,r)}function Jr(t,e,r){return r===void 0&&(r={}),K(t.map(function(n){return N(n,e)}),r)}function K(t,e){e===void 0&&(e={});var r={type:"FeatureCollection"};return e.id&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.features=t,r}function _e(t,e,r){r===void 0&&(r={});var n={type:"MultiLineString",coordinates:t};return R(n,e,r)}function br(t,e,r){r===void 0&&(r={});var n={type:"MultiPoint",coordinates:t};return R(n,e,r)}function Le(t,e,r){r===void 0&&(r={});var n={type:"MultiPolygon",coordinates:t};return R(n,e,r)}function Qr(t,e,r){r===void 0&&(r={});var n={type:"GeometryCollection",geometries:t};return R(n,e,r)}function Wr(t,e){if(e===void 0&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,e||0);return Math.round(t*r)/r}function Sr(t,e){e===void 0&&(e="kilometers");var r=Ze[e];if(!r)throw new Error(e+" units is invalid");return t*r}function Je(t,e){e===void 0&&(e="kilometers");var r=Ze[e];if(!r)throw new Error(e+" units is invalid");return t/r}function Pr(t,e){return Mr(Je(t,e))}function Kr(t){var e=t%360;return e<0&&(e+=360),e}function Mr(t){var e=t%(2*Math.PI);return e*180/Math.PI}function Hr(t){var e=t%360;return e*Math.PI/180}function jr(t,e,r){if(e===void 0&&(e="kilometers"),r===void 0&&(r="kilometers"),!(t>=0))throw new Error("length must be a positive number");return Sr(Je(t,e),r)}function et(t,e,r){if(e===void 0&&(e="meters"),r===void 0&&(r="kilometers"),!(t>=0))throw new Error("area must be a positive number");var n=Re[e];if(!n)throw new Error("invalid original units");var o=Re[r];if(!o)throw new Error("invalid final units");return t/n*o}function Ee(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}function Oe(t){return!!t&&t.constructor===Object}function rt(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(function(e){if(!Ee(e))throw new Error("bbox must only contain numbers")})}function tt(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}const nt=Object.freeze(Object.defineProperty({__proto__:null,earthRadius:T,factors:Ze,unitsFactors:zr,areaFactors:Re,feature:R,geometry:$r,point:z,points:qr,polygon:se,polygons:Zr,lineString:N,lineStrings:Jr,featureCollection:K,multiLineString:_e,multiPoint:br,multiPolygon:Le,geometryCollection:Qr,round:Wr,radiansToLength:Sr,lengthToRadians:Je,lengthToDegrees:Pr,bearingToAzimuth:Kr,radiansToDegrees:Mr,degreesToRadians:Hr,convertLength:jr,convertArea:et,isNumber:Ee,isObject:Oe,validateBBox:rt,validateId:tt},Symbol.toStringTag,{value:"Module"}));function it(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return t.geometry.coordinates;if(t.type==="Point")return t.coordinates}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function te(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function ne(t){return t.type==="Feature"?t.geometry:t}function ot(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}function le(t,e,r){if(t!==null)for(var n,o,i,a,u,s,l,v=0,d=0,x,m=t.type,b=m==="FeatureCollection",S=m==="Feature",I=b?t.features.length:1,L=0;L<I;L++){l=b?t.features[L].geometry:S?t.geometry:t,x=l?l.type==="GeometryCollection":!1,u=x?l.geometries.length:1;for(var f=0;f<u;f++){var c=0,h=0;if(a=x?l.geometries[f]:l,a!==null){s=a.coordinates;var p=a.type;switch(v=r&&(p==="Polygon"||p==="MultiPolygon")?1:0,p){case null:break;case"Point":if(e(s,d,L,c,h)===!1)return!1;d++,c++;break;case"LineString":case"MultiPoint":for(n=0;n<s.length;n++){if(e(s[n],d,L,c,h)===!1)return!1;d++,p==="MultiPoint"&&c++}p==="LineString"&&c++;break;case"Polygon":case"MultiLineString":for(n=0;n<s.length;n++){for(o=0;o<s[n].length-v;o++){if(e(s[n][o],d,L,c,h)===!1)return!1;d++}p==="MultiLineString"&&c++,p==="Polygon"&&h++}p==="Polygon"&&c++;break;case"MultiPolygon":for(n=0;n<s.length;n++){for(h=0,o=0;o<s[n].length;o++){for(i=0;i<s[n][o].length-v;i++){if(e(s[n][o][i],d,L,c,h)===!1)return!1;d++}h++}c++}break;case"GeometryCollection":for(n=0;n<a.geometries.length;n++)if(le(a.geometries[n],e,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function at(t,e,r,n){var o=r;return le(t,function(i,a,u,s,l){a===0&&r===void 0?o=i:o=e(o,i,a,u,s,l)},n),o}function Ir(t,e){var r;switch(t.type){case"FeatureCollection":for(r=0;r<t.features.length&&e(t.features[r].properties,r)!==!1;r++);break;case"Feature":e(t.properties,0);break}}function ut(t,e,r){var n=r;return Ir(t,function(o,i){i===0&&r===void 0?n=o:n=e(n,o,i)}),n}function xe(t,e){if(t.type==="Feature")e(t,0);else if(t.type==="FeatureCollection")for(var r=0;r<t.features.length&&e(t.features[r],r)!==!1;r++);}function st(t,e,r){var n=r;return xe(t,function(o,i){i===0&&r===void 0?n=o:n=e(n,o,i)}),n}function lt(t){var e=[];return le(t,function(r){e.push(r)}),e}function Qe(t,e){var r,n,o,i,a,u,s,l,v,d,x=0,m=t.type==="FeatureCollection",b=t.type==="Feature",S=m?t.features.length:1;for(r=0;r<S;r++){for(u=m?t.features[r].geometry:b?t.geometry:t,l=m?t.features[r].properties:b?t.properties:{},v=m?t.features[r].bbox:b?t.bbox:void 0,d=m?t.features[r].id:b?t.id:void 0,s=u?u.type==="GeometryCollection":!1,a=s?u.geometries.length:1,o=0;o<a;o++){if(i=s?u.geometries[o]:u,i===null){if(e(null,x,l,v,d)===!1)return!1;continue}switch(i.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(i,x,l,v,d)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<i.geometries.length;n++)if(e(i.geometries[n],x,l,v,d)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}x++}}function ft(t,e,r){var n=r;return Qe(t,function(o,i,a,u,s){i===0&&r===void 0?n=o:n=e(n,o,i,a,u,s)}),n}function H(t,e){Qe(t,function(r,n,o,i,a){var u=r===null?null:r.type;switch(u){case null:case"Point":case"LineString":case"Polygon":return e(R(r,o,{bbox:i,id:a}),n,0)===!1?!1:void 0}var s;switch(u){case"MultiPoint":s="Point";break;case"MultiLineString":s="LineString";break;case"MultiPolygon":s="Polygon";break}for(var l=0;l<r.coordinates.length;l++){var v=r.coordinates[l],d={type:s,coordinates:v};if(e(R(d,o),n,l)===!1)return!1}})}function ct(t,e,r){var n=r;return H(t,function(o,i,a){i===0&&a===0&&r===void 0?n=o:n=e(n,o,i,a)}),n}function _r(t,e){H(t,function(r,n,o){var i=0;if(!!r.geometry){var a=r.geometry.type;if(!(a==="Point"||a==="MultiPoint")){var u,s=0,l=0,v=0;if(le(r,function(d,x,m,b,S){if(u===void 0||n>s||b>l||S>v){u=d,s=n,l=b,v=S,i=0;return}var I=N([u,d],r.properties);if(e(I,n,o,S,i)===!1)return!1;i++,u=d})===!1)return!1}}})}function ht(t,e,r){var n=r,o=!1;return _r(t,function(i,a,u,s,l){o===!1&&r===void 0?n=i:n=e(n,i,a,u,s,l),o=!0}),n}function Lr(t,e){if(!t)throw new Error("geojson is required");H(t,function(r,n,o){if(r.geometry!==null){var i=r.geometry.type,a=r.geometry.coordinates;switch(i){case"LineString":if(e(r,n,o,0,0)===!1)return!1;break;case"Polygon":for(var u=0;u<a.length;u++)if(e(N(a[u],r.properties),n,o,u)===!1)return!1;break}}})}function vt(t,e,r){var n=r;return Lr(t,function(o,i,a,u){i===0&&r===void 0?n=o:n=e(n,o,i,a,u)}),n}function pt(t,e){if(e=e||{},!Oe(e))throw new Error("options is invalid");var r=e.featureIndex||0,n=e.multiFeatureIndex||0,o=e.geometryIndex||0,i=e.segmentIndex||0,a=e.properties,u;switch(t.type){case"FeatureCollection":r<0&&(r=t.features.length+r),a=a||t.features[r].properties,u=t.features[r].geometry;break;case"Feature":a=a||t.properties,u=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":u=t;break;default:throw new Error("geojson is invalid")}if(u===null)return null;var s=u.coordinates;switch(u.type){case"Point":case"MultiPoint":return null;case"LineString":return i<0&&(i=s.length+i-1),N([s[i],s[i+1]],a,e);case"Polygon":return o<0&&(o=s.length+o),i<0&&(i=s[o].length+i-1),N([s[o][i],s[o][i+1]],a,e);case"MultiLineString":return n<0&&(n=s.length+n),i<0&&(i=s[n].length+i-1),N([s[n][i],s[n][i+1]],a,e);case"MultiPolygon":return n<0&&(n=s.length+n),o<0&&(o=s[n].length+o),i<0&&(i=s[n][o].length-i-1),N([s[n][o][i],s[n][o][i+1]],a,e)}throw new Error("geojson is invalid")}function dt(t,e){if(e=e||{},!Oe(e))throw new Error("options is invalid");var r=e.featureIndex||0,n=e.multiFeatureIndex||0,o=e.geometryIndex||0,i=e.coordIndex||0,a=e.properties,u;switch(t.type){case"FeatureCollection":r<0&&(r=t.features.length+r),a=a||t.features[r].properties,u=t.features[r].geometry;break;case"Feature":a=a||t.properties,u=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":u=t;break;default:throw new Error("geojson is invalid")}if(u===null)return null;var s=u.coordinates;switch(u.type){case"Point":return z(s,a,e);case"MultiPoint":return n<0&&(n=s.length+n),z(s[n],a,e);case"LineString":return i<0&&(i=s.length+i),z(s[i],a,e);case"Polygon":return o<0&&(o=s.length+o),i<0&&(i=s[o].length+i),z(s[o][i],a,e);case"MultiLineString":return n<0&&(n=s.length+n),i<0&&(i=s[n].length+i),z(s[n][i],a,e);case"MultiPolygon":return n<0&&(n=s.length+n),o<0&&(o=s[n].length+o),i<0&&(i=s[n][o].length-i),z(s[n][o][i],a,e)}throw new Error("geojson is invalid")}const yt=Object.freeze(Object.defineProperty({__proto__:null,coordAll:lt,coordEach:le,coordReduce:at,featureEach:xe,featureReduce:st,findPoint:dt,findSegment:pt,flattenEach:H,flattenReduce:ct,geomEach:Qe,geomReduce:ft,lineEach:Lr,lineReduce:vt,propEach:Ir,propReduce:ut,segmentEach:_r,segmentReduce:ht},Symbol.toStringTag,{value:"Module"}));function tr(t){if(!t)throw new Error("geojson is required");var e=[];return H(t,function(r){gt(r,e)}),K(e)}function gt(t,e){var r=[],n=t.geometry;if(n!==null){switch(n.type){case"Polygon":r=te(n);break;case"LineString":r=[te(n)]}r.forEach(function(o){var i=mt(o,t.properties);i.forEach(function(a){a.id=e.length,e.push(a)})})}}function mt(t,e){var r=[];return t.reduce(function(n,o){var i=N([n,o],e);return i.bbox=Et(n,o),r.push(i),o}),r}function Et(t,e){var r=t[0],n=t[1],o=e[0],i=e[1],a=r<o?r:o,u=n<i?n:i,s=r>o?r:o,l=n>i?n:i;return[a,u,s,l]}var xt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function We(t){var e=t.default;if(typeof e=="function"){var r=function(){return e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(n){var o=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(r,n,o.get?o:{enumerable:!0,get:function(){return t[n]}})}),r}var Ke={exports:{}},Or={exports:{}};(function(t,e){(function(r,n){t.exports=n()})(xt,function(){function r(f,c,h,p,g){(function y(E,w,M,P,O){for(;P>M;){if(P-M>600){var _=P-M+1,C=w-M+1,Z=Math.log(_),ee=.5*Math.exp(2*Z/3),ie=.5*Math.sqrt(Z*ee*(_-ee)/_)*(C-_/2<0?-1:1),oe=Math.max(M,Math.floor(w-C*ee/_+ie)),Ur=Math.min(P,Math.floor(w+(_-C)*ee/_+ie));y(E,w,oe,Ur,O)}var ge=E[w],fe=M,B=P;for(n(E,M,w),O(E[P],ge)>0&&n(E,M,P);fe<B;){for(n(E,fe,B),fe++,B--;O(E[fe],ge)<0;)fe++;for(;O(E[B],ge)>0;)B--}O(E[M],ge)===0?n(E,M,B):n(E,++B,P),B<=w&&(M=B+1),w<=B&&(P=B-1)}})(f,c,h||0,p||f.length-1,g||o)}function n(f,c,h){var p=f[c];f[c]=f[h],f[h]=p}function o(f,c){return f<c?-1:f>c?1:0}var i=function(f){f===void 0&&(f=9),this._maxEntries=Math.max(4,f),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function a(f,c,h){if(!h)return c.indexOf(f);for(var p=0;p<c.length;p++)if(h(f,c[p]))return p;return-1}function u(f,c){s(f,0,f.children.length,c,f)}function s(f,c,h,p,g){g||(g=I(null)),g.minX=1/0,g.minY=1/0,g.maxX=-1/0,g.maxY=-1/0;for(var y=c;y<h;y++){var E=f.children[y];l(g,f.leaf?p(E):E)}return g}function l(f,c){return f.minX=Math.min(f.minX,c.minX),f.minY=Math.min(f.minY,c.minY),f.maxX=Math.max(f.maxX,c.maxX),f.maxY=Math.max(f.maxY,c.maxY),f}function v(f,c){return f.minX-c.minX}function d(f,c){return f.minY-c.minY}function x(f){return(f.maxX-f.minX)*(f.maxY-f.minY)}function m(f){return f.maxX-f.minX+(f.maxY-f.minY)}function b(f,c){return f.minX<=c.minX&&f.minY<=c.minY&&c.maxX<=f.maxX&&c.maxY<=f.maxY}function S(f,c){return c.minX<=f.maxX&&c.minY<=f.maxY&&c.maxX>=f.minX&&c.maxY>=f.minY}function I(f){return{children:f,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function L(f,c,h,p,g){for(var y=[c,h];y.length;)if(!((h=y.pop())-(c=y.pop())<=p)){var E=c+Math.ceil((h-c)/p/2)*p;r(f,E,c,h,g),y.push(c,E,E,h)}}return i.prototype.all=function(){return this._all(this.data,[])},i.prototype.search=function(f){var c=this.data,h=[];if(!S(f,c))return h;for(var p=this.toBBox,g=[];c;){for(var y=0;y<c.children.length;y++){var E=c.children[y],w=c.leaf?p(E):E;S(f,w)&&(c.leaf?h.push(E):b(f,w)?this._all(E,h):g.push(E))}c=g.pop()}return h},i.prototype.collides=function(f){var c=this.data;if(!S(f,c))return!1;for(var h=[];c;){for(var p=0;p<c.children.length;p++){var g=c.children[p],y=c.leaf?this.toBBox(g):g;if(S(f,y)){if(c.leaf||b(f,y))return!0;h.push(g)}}c=h.pop()}return!1},i.prototype.load=function(f){if(!f||!f.length)return this;if(f.length<this._minEntries){for(var c=0;c<f.length;c++)this.insert(f[c]);return this}var h=this._build(f.slice(),0,f.length-1,0);if(this.data.children.length)if(this.data.height===h.height)this._splitRoot(this.data,h);else{if(this.data.height<h.height){var p=this.data;this.data=h,h=p}this._insert(h,this.data.height-h.height-1,!0)}else this.data=h;return this},i.prototype.insert=function(f){return f&&this._insert(f,this.data.height-1),this},i.prototype.clear=function(){return this.data=I([]),this},i.prototype.remove=function(f,c){if(!f)return this;for(var h,p,g,y=this.data,E=this.toBBox(f),w=[],M=[];y||w.length;){if(y||(y=w.pop(),p=w[w.length-1],h=M.pop(),g=!0),y.leaf){var P=a(f,y.children,c);if(P!==-1)return y.children.splice(P,1),w.push(y),this._condense(w),this}g||y.leaf||!b(y,E)?p?(h++,y=p.children[h],g=!1):y=null:(w.push(y),M.push(h),h=0,p=y,y=y.children[0])}return this},i.prototype.toBBox=function(f){return f},i.prototype.compareMinX=function(f,c){return f.minX-c.minX},i.prototype.compareMinY=function(f,c){return f.minY-c.minY},i.prototype.toJSON=function(){return this.data},i.prototype.fromJSON=function(f){return this.data=f,this},i.prototype._all=function(f,c){for(var h=[];f;)f.leaf?c.push.apply(c,f.children):h.push.apply(h,f.children),f=h.pop();return c},i.prototype._build=function(f,c,h,p){var g,y=h-c+1,E=this._maxEntries;if(y<=E)return u(g=I(f.slice(c,h+1)),this.toBBox),g;p||(p=Math.ceil(Math.log(y)/Math.log(E)),E=Math.ceil(y/Math.pow(E,p-1))),(g=I([])).leaf=!1,g.height=p;var w=Math.ceil(y/E),M=w*Math.ceil(Math.sqrt(E));L(f,c,h,M,this.compareMinX);for(var P=c;P<=h;P+=M){var O=Math.min(P+M-1,h);L(f,P,O,w,this.compareMinY);for(var _=P;_<=O;_+=w){var C=Math.min(_+w-1,O);g.children.push(this._build(f,_,C,p-1))}}return u(g,this.toBBox),g},i.prototype._chooseSubtree=function(f,c,h,p){for(;p.push(c),!c.leaf&&p.length-1!==h;){for(var g=1/0,y=1/0,E=void 0,w=0;w<c.children.length;w++){var M=c.children[w],P=x(M),O=(_=f,C=M,(Math.max(C.maxX,_.maxX)-Math.min(C.minX,_.minX))*(Math.max(C.maxY,_.maxY)-Math.min(C.minY,_.minY))-P);O<y?(y=O,g=P<g?P:g,E=M):O===y&&P<g&&(g=P,E=M)}c=E||c.children[0]}var _,C;return c},i.prototype._insert=function(f,c,h){var p=h?f:this.toBBox(f),g=[],y=this._chooseSubtree(p,this.data,c,g);for(y.children.push(f),l(y,p);c>=0&&g[c].children.length>this._maxEntries;)this._split(g,c),c--;this._adjustParentBBoxes(p,g,c)},i.prototype._split=function(f,c){var h=f[c],p=h.children.length,g=this._minEntries;this._chooseSplitAxis(h,g,p);var y=this._chooseSplitIndex(h,g,p),E=I(h.children.splice(y,h.children.length-y));E.height=h.height,E.leaf=h.leaf,u(h,this.toBBox),u(E,this.toBBox),c?f[c-1].children.push(E):this._splitRoot(h,E)},i.prototype._splitRoot=function(f,c){this.data=I([f,c]),this.data.height=f.height+1,this.data.leaf=!1,u(this.data,this.toBBox)},i.prototype._chooseSplitIndex=function(f,c,h){for(var p,g,y,E,w,M,P,O=1/0,_=1/0,C=c;C<=h-c;C++){var Z=s(f,0,C,this.toBBox),ee=s(f,C,h,this.toBBox),ie=(g=Z,y=ee,E=void 0,w=void 0,M=void 0,P=void 0,E=Math.max(g.minX,y.minX),w=Math.max(g.minY,y.minY),M=Math.min(g.maxX,y.maxX),P=Math.min(g.maxY,y.maxY),Math.max(0,M-E)*Math.max(0,P-w)),oe=x(Z)+x(ee);ie<O?(O=ie,p=C,_=oe<_?oe:_):ie===O&&oe<_&&(_=oe,p=C)}return p||h-c},i.prototype._chooseSplitAxis=function(f,c,h){var p=f.leaf?this.compareMinX:v,g=f.leaf?this.compareMinY:d;this._allDistMargin(f,c,h,p)<this._allDistMargin(f,c,h,g)&&f.children.sort(p)},i.prototype._allDistMargin=function(f,c,h,p){f.children.sort(p);for(var g=this.toBBox,y=s(f,0,c,g),E=s(f,h-c,h,g),w=m(y)+m(E),M=c;M<h-c;M++){var P=f.children[M];l(y,f.leaf?g(P):P),w+=m(y)}for(var O=h-c-1;O>=c;O--){var _=f.children[O];l(E,f.leaf?g(_):_),w+=m(E)}return w},i.prototype._adjustParentBBoxes=function(f,c,h){for(var p=h;p>=0;p--)l(c[p],f)},i.prototype._condense=function(f){for(var c=f.length-1,h=void 0;c>=0;c--)f[c].children.length===0?c>0?(h=f[c-1].children).splice(h.indexOf(f[c]),1):this.clear():u(f[c],this.toBBox)},i})})(Or);const wt=We(nt),bt=We(yt);function we(t){var e=[1/0,1/0,-1/0,-1/0];return le(t,function(r){e[0]>r[0]&&(e[0]=r[0]),e[1]>r[1]&&(e[1]=r[1]),e[2]<r[0]&&(e[2]=r[0]),e[3]<r[1]&&(e[3]=r[1])}),e}we.default=we;const St=Object.freeze(Object.defineProperty({__proto__:null,default:we},Symbol.toStringTag,{value:"Module"})),Pt=We(St);var U=Or.exports,Cr=wt,Tr=bt,ae=Pt.default,Mt=Tr.featureEach;Tr.coordEach;Cr.polygon;var nr=Cr.featureCollection;function kr(t){var e=new U(t);return e.insert=function(r){if(r.type!=="Feature")throw new Error("invalid feature");return r.bbox=r.bbox?r.bbox:ae(r),U.prototype.insert.call(this,r)},e.load=function(r){var n=[];return Array.isArray(r)?r.forEach(function(o){if(o.type!=="Feature")throw new Error("invalid features");o.bbox=o.bbox?o.bbox:ae(o),n.push(o)}):Mt(r,function(o){if(o.type!=="Feature")throw new Error("invalid features");o.bbox=o.bbox?o.bbox:ae(o),n.push(o)}),U.prototype.load.call(this,n)},e.remove=function(r,n){if(r.type!=="Feature")throw new Error("invalid feature");return r.bbox=r.bbox?r.bbox:ae(r),U.prototype.remove.call(this,r,n)},e.clear=function(){return U.prototype.clear.call(this)},e.search=function(r){var n=U.prototype.search.call(this,this.toBBox(r));return nr(n)},e.collides=function(r){return U.prototype.collides.call(this,this.toBBox(r))},e.all=function(){var r=U.prototype.all.call(this);return nr(r)},e.toJSON=function(){return U.prototype.toJSON.call(this)},e.fromJSON=function(r){return U.prototype.fromJSON.call(this,r)},e.toBBox=function(r){var n;if(r.bbox)n=r.bbox;else if(Array.isArray(r)&&r.length===4)n=r;else if(Array.isArray(r)&&r.length===6)n=[r[0],r[1],r[3],r[4]];else if(r.type==="Feature")n=ae(r);else if(r.type==="FeatureCollection")n=ae(r);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}Ke.exports=kr;Ke.exports.default=kr;function Ce(t,e){var r={},n=[];if(t.type==="LineString"&&(t=R(t)),e.type==="LineString"&&(e=R(e)),t.type==="Feature"&&e.type==="Feature"&&t.geometry!==null&&e.geometry!==null&&t.geometry.type==="LineString"&&e.geometry.type==="LineString"&&t.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var o=ir(t,e);return o&&n.push(o),K(n)}var i=Ke.exports();return i.load(tr(e)),xe(tr(t),function(a){xe(i.search(a),function(u){var s=ir(a,u);if(s){var l=te(s).join(",");r[l]||(r[l]=!0,n.push(s))}})}),K(n)}function ir(t,e){var r=te(t),n=te(e);if(r.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var o=r[0][0],i=r[0][1],a=r[1][0],u=r[1][1],s=n[0][0],l=n[0][1],v=n[1][0],d=n[1][1],x=(d-l)*(a-o)-(v-s)*(u-i),m=(v-s)*(i-l)-(d-l)*(o-s),b=(a-o)*(i-l)-(u-i)*(o-s);if(x===0)return m===0&&b===0,null;var S=m/x,I=b/x;if(S>=0&&S<=1&&I>=0&&I<=1){var L=o+S*(a-o),f=i+S*(u-i);return z([L,f])}return null}function pe(t,e,r){if(r===void 0&&(r={}),!t)throw new Error("point is required");if(!e)throw new Error("polygon is required");var n=it(t),o=ne(e),i=o.type,a=e.bbox,u=o.coordinates;if(a&&It(n,a)===!1)return!1;i==="Polygon"&&(u=[u]);for(var s=!1,l=0;l<u.length&&!s;l++)if(or(n,u[l][0],r.ignoreBoundary)){for(var v=!1,d=1;d<u[l].length&&!v;)or(n,u[l][d],!r.ignoreBoundary)&&(v=!0),d++;v||(s=!0)}return s}function or(t,e,r){var n=!1;e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]&&(e=e.slice(0,e.length-1));for(var o=0,i=e.length-1;o<e.length;i=o++){var a=e[o][0],u=e[o][1],s=e[i][0],l=e[i][1],v=t[1]*(a-s)+u*(s-t[0])+l*(t[0]-a)===0&&(a-t[0])*(s-t[0])<=0&&(u-t[1])*(l-t[1])<=0;if(v)return!r;var d=u>t[1]!=l>t[1]&&t[0]<(s-a)*(t[1]-u)/(l-u)+a;d&&(n=!n)}return n}function It(t,e){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]>=t[0]&&e[3]>=t[1]}function Fe(t,e){e===void 0&&(e={});var r=ne(t);switch(!e.properties&&t.type==="Feature"&&(e.properties=t.properties),r.type){case"Polygon":return _t(r,e);case"MultiPolygon":return Lt(r,e);default:throw new Error("invalid poly")}}function _t(t,e){e===void 0&&(e={});var r=ne(t),n=r.coordinates,o=e.properties?e.properties:t.type==="Feature"?t.properties:{};return Ar(n,o)}function Lt(t,e){e===void 0&&(e={});var r=ne(t),n=r.coordinates,o=e.properties?e.properties:t.type==="Feature"?t.properties:{},i=[];return n.forEach(function(a){i.push(Ar(a,o))}),K(i)}function Ar(t,e){return t.length>1?_e(t,e):N(t[0],e)}function Nr(t,e){var r=!0;return H(t,function(n){H(e,function(o){if(r===!1)return!1;r=Ot(n.geometry,o.geometry)})}),r}function Ot(t,e){switch(t.type){case"Point":switch(e.type){case"Point":return!At(t.coordinates,e.coordinates);case"LineString":return!ar(e,t);case"Polygon":return!pe(t,e)}break;case"LineString":switch(e.type){case"Point":return!ar(t,e);case"LineString":return!Ct(t,e);case"Polygon":return!ur(e,t)}break;case"Polygon":switch(e.type){case"Point":return!pe(e,t);case"LineString":return!ur(t,e);case"Polygon":return!Tt(e,t)}}return!1}function ar(t,e){for(var r=0;r<t.coordinates.length-1;r++)if(kt(t.coordinates[r],t.coordinates[r+1],e.coordinates))return!0;return!1}function Ct(t,e){var r=Ce(t,e);return r.features.length>0}function ur(t,e){for(var r=0,n=e.coordinates;r<n.length;r++){var o=n[r];if(pe(o,t))return!0}var i=Ce(e,Fe(t));return i.features.length>0}function Tt(t,e){for(var r=0,n=t.coordinates[0];r<n.length;r++){var o=n[r];if(pe(o,e))return!0}for(var i=0,a=e.coordinates[0];i<a.length;i++){var u=a[i];if(pe(u,t))return!0}var s=Ce(Fe(t),Fe(e));return s.features.length>0}function kt(t,e,r){var n=r[0]-t[0],o=r[1]-t[1],i=e[0]-t[0],a=e[1]-t[1],u=n*a-o*i;return u!==0?!1:Math.abs(i)>=Math.abs(a)?i>0?t[0]<=r[0]&&r[0]<=e[0]:e[0]<=r[0]&&r[0]<=t[0]:a>0?t[1]<=r[1]&&r[1]<=e[1]:e[1]<=r[1]&&r[1]<=t[1]}function At(t,e){return t[0]===e[0]&&t[1]===e[1]}function be(t){var e=t[0],r=t[1];return[r[0]-e[0],r[1]-e[1]]}function Be(t,e){return t[0]*e[1]-e[0]*t[1]}function Nt(t,e){return[t[0]+e[0],t[1]+e[1]]}function Rt(t,e){return[t[0]-e[0],t[1]-e[1]]}function Ft(t,e){return[t*e[0],t*e[1]]}function Bt(t,e){var r=t[0],n=be(t),o=e[0],i=be(e),a=Be(n,i),u=Rt(o,r),s=Be(u,i),l=s/a,v=Nt(r,Ft(l,n));return v}function Dt(t,e){var r=be(t),n=be(e);return Be(r,n)===0}function Yt(t,e){return Dt(t,e)?!1:Bt(t,e)}function sr(t,e,r){if(r=r||{},!Oe(r))throw new Error("options is invalid");var n=r.units;if(!t)throw new Error("geojson is required");if(e==null||isNaN(e))throw new Error("distance is required");var o=ot(t),i=t.properties;switch(o){case"LineString":return lr(t,e,n);case"MultiLineString":var a=[];return H(t,function(u){a.push(lr(u,e,n).geometry.coordinates)}),_e(a,i);default:throw new Error("geometry "+o+" is not supported")}}function lr(t,e,r){var n=[],o=Pr(e,r),i=te(t),a=[];return i.forEach(function(u,s){if(s!==i.length-1){var l=Gt(u,i[s+1],o);if(n.push(l),s>0){var v=n[s-1],d=Yt(l,v);d!==!1&&(v[1]=d,l[0]=d),a.push(v[0]),s===i.length-2&&(a.push(l[0]),a.push(l[1]))}i.length===2&&(a.push(l[0]),a.push(l[1]))}}),N(a,t.properties)}function Gt(t,e,r){var n=Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])),o=t[0]+r*(e[1]-t[1])/n,i=e[0]+r*(e[1]-t[1])/n,a=t[1]+r*(t[0]-e[0])/n,u=e[1]+r*(t[0]-e[0])/n;return[[o,a],[i,u]]}function Vt(t){if(!t)throw new Error("geojson is required");switch(t.type){case"Feature":return Rr(t);case"FeatureCollection":return Ut(t);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return He(t);default:throw new Error("unknown GeoJSON type")}}function Rr(t){var e={type:"Feature"};return Object.keys(t).forEach(function(r){switch(r){case"type":case"properties":case"geometry":return;default:e[r]=t[r]}}),e.properties=Fr(t.properties),e.geometry=He(t.geometry),e}function Fr(t){var e={};return t&&Object.keys(t).forEach(function(r){var n=t[r];typeof n=="object"?n===null?e[r]=null:Array.isArray(n)?e[r]=n.map(function(o){return o}):e[r]=Fr(n):e[r]=n}),e}function Ut(t){var e={type:"FeatureCollection"};return Object.keys(t).forEach(function(r){switch(r){case"type":case"features":return;default:e[r]=t[r]}}),e.features=t.features.map(function(r){return Rr(r)}),e}function He(t){var e={type:t.type};return t.bbox&&(e.bbox=t.bbox),t.type==="GeometryCollection"?(e.geometries=t.geometries.map(function(r){return He(r)}),e):(e.coordinates=Br(t.coordinates),e)}function Br(t){var e=t;return typeof e[0]!="object"?e.slice():e.map(function(r){return Br(r)})}function Xt(t,e){e===void 0&&(e={});var r,n,o,i=e.properties,a=(r=e.autoComplete)!==null&&r!==void 0?r:!0,u=(n=e.orderCoords)!==null&&n!==void 0?n:!0,s=(o=e.mutate)!==null&&o!==void 0?o:!1;switch(s||(t=Vt(t)),t.type){case"FeatureCollection":var l=[];return t.features.forEach(function(v){l.push(te(fr(v,{},a,u)))}),Le(l,i);default:return fr(t,i,a,u)}}function fr(t,e,r,n){e=e||(t.type==="Feature"?t.properties:{});var o=ne(t),i=o.coordinates,a=o.type;if(!i.length)throw new Error("line must contain coordinates");switch(a){case"LineString":return r&&(i=cr(i)),se([i],e);case"MultiLineString":var u=[],s=0;return i.forEach(function(l){if(r&&(l=cr(l)),n){var v=zt(we(N(l)));v>s?(u.unshift(l),s=v):u.push(l)}else u.push(l)}),se(u,e);default:throw new Error("geometry type "+a+" is not supported")}}function cr(t){var e=t[0],r=e[0],n=e[1],o=t[t.length-1],i=o[0],a=o[1];return(r!==i||n!==a)&&t.push(e),t}function zt(t){var e=t[0],r=t[1],n=t[2],o=t[3];return Math.abs(e-n)*Math.abs(r-o)}/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function $t(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(l){return function(v){return s([l,v])}}function s(l){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(i=l[0]&2?o.return:l[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,l[1])).done)return i;switch(o=0,i&&(l=[l[0]&2,i.value]),l[0]){case 0:case 1:i=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,o=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){r.label=l[1];break}if(l[0]===6&&r.label<i[1]){r.label=i[1],i=l;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(l);break}i[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(v){l=[6,v],o=0}finally{n=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}var j=function(){function t(e,r){this.next=null,this.key=e,this.data=r,this.left=null,this.right=null}return t}();function qt(t,e){return t>e?1:t<e?-1:0}function J(t,e,r){for(var n=new j(null,null),o=n,i=n;;){var a=r(t,e.key);if(a<0){if(e.left===null)break;if(r(t,e.left.key)<0){var u=e.left;if(e.left=u.right,u.right=e,e=u,e.left===null)break}i.left=e,i=e,e=e.left}else if(a>0){if(e.right===null)break;if(r(t,e.right.key)>0){var u=e.right;if(e.right=u.left,u.left=e,e=u,e.right===null)break}o.right=e,o=e,e=e.right}else break}return o.right=e.left,i.left=e.right,e.left=n.right,e.right=n.left,e}function Ne(t,e,r,n){var o=new j(t,e);if(r===null)return o.left=o.right=null,o;r=J(t,r,n);var i=n(t,r.key);return i<0?(o.left=r.left,o.right=r,r.left=null):i>=0&&(o.right=r.right,o.left=r,r.right=null),o}function hr(t,e,r){var n=null,o=null;if(e){e=J(t,e,r);var i=r(e.key,t);i===0?(n=e.left,o=e.right):i<0?(o=e.right,e.right=null,n=e):(n=e.left,e.left=null,o=e)}return{left:n,right:o}}function Zt(t,e,r){return e===null?t:(t===null||(e=J(t.key,e,r),e.left=t),e)}function De(t,e,r,n,o){if(t){n(""+e+(r?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 ")+o(t)+`
`);var i=e+(r?"    ":"\u2502   ");t.left&&De(t.left,i,!1,n,o),t.right&&De(t.right,i,!0,n,o)}}var je=function(){function t(e){e===void 0&&(e=qt),this._root=null,this._size=0,this._comparator=e}return t.prototype.insert=function(e,r){return this._size++,this._root=Ne(e,r,this._root,this._comparator)},t.prototype.add=function(e,r){var n=new j(e,r);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var o=this._comparator,i=J(e,this._root,o),a=o(e,i.key);return a===0?this._root=i:(a<0?(n.left=i.left,n.right=i,i.left=null):a>0&&(n.right=i.right,n.left=i,i.right=null),this._size++,this._root=n),this._root},t.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},t.prototype._remove=function(e,r,n){var o;if(r===null)return null;r=J(e,r,n);var i=n(e,r.key);return i===0?(r.left===null?o=r.right:(o=J(e,r.left,n),o.right=r.right),this._size--,o):r},t.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=J(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},t.prototype.findStatic=function(e){for(var r=this._root,n=this._comparator;r;){var o=n(e,r.key);if(o===0)return r;o<0?r=r.left:r=r.right}return null},t.prototype.find=function(e){return this._root&&(this._root=J(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},t.prototype.contains=function(e){for(var r=this._root,n=this._comparator;r;){var o=n(e,r.key);if(o===0)return!0;o<0?r=r.left:r=r.right}return!1},t.prototype.forEach=function(e,r){for(var n=this._root,o=[],i=!1;!i;)n!==null?(o.push(n),n=n.left):o.length!==0?(n=o.pop(),e.call(r,n),n=n.right):i=!0;return this},t.prototype.range=function(e,r,n,o){for(var i=[],a=this._comparator,u=this._root,s;i.length!==0||u;)if(u)i.push(u),u=u.left;else{if(u=i.pop(),s=a(u.key,r),s>0)break;if(a(u.key,e)>=0&&n.call(o,u))return this;u=u.right}return this},t.prototype.keys=function(){var e=[];return this.forEach(function(r){var n=r.key;return e.push(n)}),e},t.prototype.values=function(){var e=[];return this.forEach(function(r){var n=r.data;return e.push(n)}),e},t.prototype.min=function(){return this._root?this.minNode(this._root).key:null},t.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},t.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},t.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},t.prototype.at=function(e){for(var r=this._root,n=!1,o=0,i=[];!n;)if(r)i.push(r),r=r.left;else if(i.length>0){if(r=i.pop(),o===e)return r;o++,r=r.right}else n=!0;return null},t.prototype.next=function(e){var r=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var o=this._comparator;r;){var i=o(e.key,r.key);if(i===0)break;i<0?(n=r,r=r.left):r=r.right}return n},t.prototype.prev=function(e){var r=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var o=this._comparator;r;){var i=o(e.key,r.key);if(i===0)break;i<0?r=r.left:(n=r,r=r.right)}return n},t.prototype.clear=function(){return this._root=null,this._size=0,this},t.prototype.toList=function(){return Qt(this._root)},t.prototype.load=function(e,r,n){r===void 0&&(r=[]),n===void 0&&(n=!1);var o=e.length,i=this._comparator;if(n&&Ve(e,r,0,o-1,i),this._root===null)this._root=Ye(e,r,0,o),this._size=o;else{var a=Wt(this.toList(),Jt(e,r),i);o=this._size+o,this._root=Ge({head:a},0,o)}return this},t.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),t.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var r=[];return De(this._root,"",!0,function(n){return r.push(n)},e),r.join("")},t.prototype.update=function(e,r,n){var o=this._comparator,i=hr(e,this._root,o),a=i.left,u=i.right;o(e,r)<0?u=Ne(r,n,u,o):a=Ne(r,n,a,o),this._root=Zt(a,u,o)},t.prototype.split=function(e){return hr(e,this._root,this._comparator)},t.prototype[Symbol.iterator]=function(){var e;return $t(this,function(r){switch(r.label){case 0:e=this.minNode(),r.label=1;case 1:return e?[4,e]:[3,3];case 2:return r.sent(),e=this.next(e),[3,1];case 3:return[2]}})},t}();function Ye(t,e,r,n){var o=n-r;if(o>0){var i=r+Math.floor(o/2),a=t[i],u=e[i],s=new j(a,u);return s.left=Ye(t,e,r,i),s.right=Ye(t,e,i+1,n),s}return null}function Jt(t,e){for(var r=new j(null,null),n=r,o=0;o<t.length;o++)n=n.next=new j(t[o],e[o]);return n.next=null,r.next}function Qt(t){for(var e=t,r=[],n=!1,o=new j(null,null),i=o;!n;)e?(r.push(e),e=e.left):r.length>0?(e=i=i.next=r.pop(),e=e.right):n=!0;return i.next=null,o.next}function Ge(t,e,r){var n=r-e;if(n>0){var o=e+Math.floor(n/2),i=Ge(t,e,o),a=t.head;return a.left=i,t.head=t.head.next,a.right=Ge(t,o+1,r),a}return null}function Wt(t,e,r){for(var n=new j(null,null),o=n,i=t,a=e;i!==null&&a!==null;)r(i.key,a.key)<0?(o.next=i,i=i.next):(o.next=a,a=a.next),o=o.next;return i!==null?o.next=i:a!==null&&(o.next=a),n.next}function Ve(t,e,r,n,o){if(!(r>=n)){for(var i=t[r+n>>1],a=r-1,u=n+1;;){do a++;while(o(t[a],i)<0);do u--;while(o(t[u],i)>0);if(a>=u)break;var s=t[a];t[a]=t[u],t[u]=s,s=e[a],e[a]=e[u],e[u]=s}Ve(t,e,r,u,o),Ve(t,e,u+1,n,o)}}function F(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function vr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function A(t,e,r){return e&&vr(t.prototype,e),r&&vr(t,r),t}var ce=function(e,r){return e.ll.x<=r.x&&r.x<=e.ur.x&&e.ll.y<=r.y&&r.y<=e.ur.y},Ue=function(e,r){if(r.ur.x<e.ll.x||e.ur.x<r.ll.x||r.ur.y<e.ll.y||e.ur.y<r.ll.y)return null;var n=e.ll.x<r.ll.x?r.ll.x:e.ll.x,o=e.ur.x<r.ur.x?e.ur.x:r.ur.x,i=e.ll.y<r.ll.y?r.ll.y:e.ll.y,a=e.ur.y<r.ur.y?e.ur.y:r.ur.y;return{ll:{x:n,y:i},ur:{x:o,y:a}}},Q=Number.EPSILON;Q===void 0&&(Q=Math.pow(2,-52));var Kt=Q*Q,Xe=function(e,r){if(-Q<e&&e<Q&&-Q<r&&r<Q)return 0;var n=e-r;return n*n<Kt*e*r?0:e<r?-1:1},Ht=function(){function t(){F(this,t),this.reset()}return A(t,[{key:"reset",value:function(){this.xRounder=new pr,this.yRounder=new pr}},{key:"round",value:function(r,n){return{x:this.xRounder.round(r),y:this.yRounder.round(n)}}}]),t}(),pr=function(){function t(){F(this,t),this.tree=new je,this.round(0)}return A(t,[{key:"round",value:function(r){var n=this.tree.add(r),o=this.tree.prev(n);if(o!==null&&Xe(n.key,o.key)===0)return this.tree.remove(r),o.key;var i=this.tree.next(n);return i!==null&&Xe(n.key,i.key)===0?(this.tree.remove(r),i.key):r}}]),t}(),de=new Ht,ve=function(e,r){return e.x*r.y-e.y*r.x},Dr=function(e,r){return e.x*r.x+e.y*r.y},dr=function(e,r,n){var o={x:r.x-e.x,y:r.y-e.y},i={x:n.x-e.x,y:n.y-e.y},a=ve(o,i);return Xe(a,0)},Se=function(e){return Math.sqrt(Dr(e,e))},jt=function(e,r,n){var o={x:r.x-e.x,y:r.y-e.y},i={x:n.x-e.x,y:n.y-e.y};return ve(i,o)/Se(i)/Se(o)},en=function(e,r,n){var o={x:r.x-e.x,y:r.y-e.y},i={x:n.x-e.x,y:n.y-e.y};return Dr(i,o)/Se(i)/Se(o)},yr=function(e,r,n){return r.y===0?null:{x:e.x+r.x/r.y*(n-e.y),y:n}},gr=function(e,r,n){return r.x===0?null:{x:n,y:e.y+r.y/r.x*(n-e.x)}},rn=function(e,r,n,o){if(r.x===0)return gr(n,o,e.x);if(o.x===0)return gr(e,r,n.x);if(r.y===0)return yr(n,o,e.y);if(o.y===0)return yr(e,r,n.y);var i=ve(r,o);if(i==0)return null;var a={x:n.x-e.x,y:n.y-e.y},u=ve(a,r)/i,s=ve(a,o)/i,l=e.x+s*r.x,v=n.x+u*o.x,d=e.y+s*r.y,x=n.y+u*o.y,m=(l+v)/2,b=(d+x)/2;return{x:m,y:b}},X=function(){A(t,null,[{key:"compare",value:function(r,n){var o=t.comparePoints(r.point,n.point);return o!==0?o:(r.point!==n.point&&r.link(n),r.isLeft!==n.isLeft?r.isLeft?1:-1:Pe.compare(r.segment,n.segment))}},{key:"comparePoints",value:function(r,n){return r.x<n.x?-1:r.x>n.x?1:r.y<n.y?-1:r.y>n.y?1:0}}]);function t(e,r){F(this,t),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=r}return A(t,[{key:"link",value:function(r){if(r.point===this.point)throw new Error("Tried to link already linked events");for(var n=r.point.events,o=0,i=n.length;o<i;o++){var a=n[o];this.point.events.push(a),a.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var r=this.point.events.length,n=0;n<r;n++){var o=this.point.events[n];if(o.segment.consumedBy===void 0)for(var i=n+1;i<r;i++){var a=this.point.events[i];a.consumedBy===void 0&&o.otherSE.point.events===a.otherSE.point.events&&o.segment.consume(a.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var r=[],n=0,o=this.point.events.length;n<o;n++){var i=this.point.events[n];i!==this&&!i.segment.ringOut&&i.segment.isInResult()&&r.push(i)}return r}},{key:"getLeftmostComparator",value:function(r){var n=this,o=new Map,i=function(u){var s=u.otherSE;o.set(u,{sine:jt(n.point,r.point,s.point),cosine:en(n.point,r.point,s.point)})};return function(a,u){o.has(a)||i(a),o.has(u)||i(u);var s=o.get(a),l=s.sine,v=s.cosine,d=o.get(u),x=d.sine,m=d.cosine;return l>=0&&x>=0?v<m?1:v>m?-1:0:l<0&&x<0?v<m?-1:v>m?1:0:x<l?-1:x>l?1:0}}}]),t}(),tn=0,Pe=function(){A(t,null,[{key:"compare",value:function(r,n){var o=r.leftSE.point.x,i=n.leftSE.point.x,a=r.rightSE.point.x,u=n.rightSE.point.x;if(u<o)return 1;if(a<i)return-1;var s=r.leftSE.point.y,l=n.leftSE.point.y,v=r.rightSE.point.y,d=n.rightSE.point.y;if(o<i){if(l<s&&l<v)return 1;if(l>s&&l>v)return-1;var x=r.comparePoint(n.leftSE.point);if(x<0)return 1;if(x>0)return-1;var m=n.comparePoint(r.rightSE.point);return m!==0?m:-1}if(o>i){if(s<l&&s<d)return-1;if(s>l&&s>d)return 1;var b=n.comparePoint(r.leftSE.point);if(b!==0)return b;var S=r.comparePoint(n.rightSE.point);return S<0?1:S>0?-1:1}if(s<l)return-1;if(s>l)return 1;if(a<u){var I=n.comparePoint(r.rightSE.point);if(I!==0)return I}if(a>u){var L=r.comparePoint(n.rightSE.point);if(L<0)return 1;if(L>0)return-1}if(a!==u){var f=v-s,c=a-o,h=d-l,p=u-i;if(f>c&&h<p)return 1;if(f<c&&h>p)return-1}return a>u?1:a<u||v<d?-1:v>d?1:r.id<n.id?-1:r.id>n.id?1:0}}]);function t(e,r,n,o){F(this,t),this.id=++tn,this.leftSE=e,e.segment=this,e.otherSE=r,this.rightSE=r,r.segment=this,r.otherSE=e,this.rings=n,this.windings=o}return A(t,[{key:"replaceRightSE",value:function(r){this.rightSE=r,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var r=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:r<n?r:n},ur:{x:this.rightSE.point.x,y:r>n?r:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(r){return r.x===this.leftSE.point.x&&r.y===this.leftSE.point.y||r.x===this.rightSE.point.x&&r.y===this.rightSE.point.y}},{key:"comparePoint",value:function(r){if(this.isAnEndpoint(r))return 0;var n=this.leftSE.point,o=this.rightSE.point,i=this.vector();if(n.x===o.x)return r.x===n.x?0:r.x<n.x?1:-1;var a=(r.y-n.y)/i.y,u=n.x+a*i.x;if(r.x===u)return 0;var s=(r.x-n.x)/i.x,l=n.y+s*i.y;return r.y===l?0:r.y<l?-1:1}},{key:"getIntersection",value:function(r){var n=this.bbox(),o=r.bbox(),i=Ue(n,o);if(i===null)return null;var a=this.leftSE.point,u=this.rightSE.point,s=r.leftSE.point,l=r.rightSE.point,v=ce(n,s)&&this.comparePoint(s)===0,d=ce(o,a)&&r.comparePoint(a)===0,x=ce(n,l)&&this.comparePoint(l)===0,m=ce(o,u)&&r.comparePoint(u)===0;if(d&&v)return m&&!x?u:!m&&x?l:null;if(d)return x&&a.x===l.x&&a.y===l.y?null:a;if(v)return m&&u.x===s.x&&u.y===s.y?null:s;if(m&&x)return null;if(m)return u;if(x)return l;var b=rn(a,this.vector(),s,r.vector());return b===null||!ce(i,b)?null:de.round(b.x,b.y)}},{key:"split",value:function(r){var n=[],o=r.events!==void 0,i=new X(r,!0),a=new X(r,!1),u=this.rightSE;this.replaceRightSE(a),n.push(a),n.push(i);var s=new t(i,u,this.rings.slice(),this.windings.slice());return X.comparePoints(s.leftSE.point,s.rightSE.point)>0&&s.swapEvents(),X.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),o&&(i.checkForConsuming(),a.checkForConsuming()),n}},{key:"swapEvents",value:function(){var r=this.rightSE;this.rightSE=this.leftSE,this.leftSE=r,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,o=this.windings.length;n<o;n++)this.windings[n]*=-1}},{key:"consume",value:function(r){for(var n=this,o=r;n.consumedBy;)n=n.consumedBy;for(;o.consumedBy;)o=o.consumedBy;var i=t.compare(n,o);if(i!==0){if(i>0){var a=n;n=o,o=a}if(n.prev===o){var u=n;n=o,o=u}for(var s=0,l=o.rings.length;s<l;s++){var v=o.rings[s],d=o.windings[s],x=n.rings.indexOf(v);x===-1?(n.rings.push(v),n.windings.push(d)):n.windings[x]+=d}o.rings=null,o.windings=null,o.consumedBy=n,o.leftSE.consumedBy=n.leftSE,o.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var r=this.prev.consumedBy||this.prev;this._beforeState=r.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var r=this.beforeState();this._afterState={rings:r.rings.slice(0),windings:r.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,o=this._afterState.windings,i=this._afterState.multiPolys,a=0,u=this.rings.length;a<u;a++){var s=this.rings[a],l=this.windings[a],v=n.indexOf(s);v===-1?(n.push(s),o.push(l)):o[v]+=l}for(var d=[],x=[],m=0,b=n.length;m<b;m++)if(o[m]!==0){var S=n[m],I=S.poly;if(x.indexOf(I)===-1)if(S.isExterior)d.push(I);else{x.indexOf(I)===-1&&x.push(I);var L=d.indexOf(S.poly);L!==-1&&d.splice(L,1)}}for(var f=0,c=d.length;f<c;f++){var h=d[f].multiPoly;i.indexOf(h)===-1&&i.push(h)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var r=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(D.type){case"union":{var o=r.length===0,i=n.length===0;this._isInResult=o!==i;break}case"intersection":{var a,u;r.length<n.length?(a=r.length,u=n.length):(a=n.length,u=r.length),this._isInResult=u===D.numMultiPolys&&a<u;break}case"xor":{var s=Math.abs(r.length-n.length);this._isInResult=s%2===1;break}case"difference":{var l=function(d){return d.length===1&&d[0].isSubject};this._isInResult=l(r)!==l(n);break}default:throw new Error("Unrecognized operation type found ".concat(D.type))}return this._isInResult}}],[{key:"fromRing",value:function(r,n,o){var i,a,u,s=X.comparePoints(r,n);if(s<0)i=r,a=n,u=1;else if(s>0)i=n,a=r,u=-1;else throw new Error("Tried to create degenerate segment at [".concat(r.x,", ").concat(r.y,"]"));var l=new X(i,!0),v=new X(a,!1);return new t(l,v,[o],[u])}}]),t}(),mr=function(){function t(e,r,n){if(F(this,t),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=r,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var o=de.round(e[0][0],e[0][1]);this.bbox={ll:{x:o.x,y:o.y},ur:{x:o.x,y:o.y}};for(var i=o,a=1,u=e.length;a<u;a++){if(typeof e[a][0]!="number"||typeof e[a][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var s=de.round(e[a][0],e[a][1]);s.x===i.x&&s.y===i.y||(this.segments.push(Pe.fromRing(i,s,this)),s.x<this.bbox.ll.x&&(this.bbox.ll.x=s.x),s.y<this.bbox.ll.y&&(this.bbox.ll.y=s.y),s.x>this.bbox.ur.x&&(this.bbox.ur.x=s.x),s.y>this.bbox.ur.y&&(this.bbox.ur.y=s.y),i=s)}(o.x!==i.x||o.y!==i.y)&&this.segments.push(Pe.fromRing(i,o,this))}return A(t,[{key:"getSweepEvents",value:function(){for(var r=[],n=0,o=this.segments.length;n<o;n++){var i=this.segments[n];r.push(i.leftSE),r.push(i.rightSE)}return r}}]),t}(),nn=function(){function t(e,r){if(F(this,t),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new mr(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,o=e.length;n<o;n++){var i=new mr(e[n],this,!1);i.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=i.bbox.ll.x),i.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=i.bbox.ll.y),i.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=i.bbox.ur.x),i.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=i.bbox.ur.y),this.interiorRings.push(i)}this.multiPoly=r}return A(t,[{key:"getSweepEvents",value:function(){for(var r=this.exteriorRing.getSweepEvents(),n=0,o=this.interiorRings.length;n<o;n++)for(var i=this.interiorRings[n].getSweepEvents(),a=0,u=i.length;a<u;a++)r.push(i[a]);return r}}]),t}(),Er=function(){function t(e,r){if(F(this,t),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,o=e.length;n<o;n++){var i=new nn(e[n],this);i.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=i.bbox.ll.x),i.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=i.bbox.ll.y),i.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=i.bbox.ur.x),i.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=i.bbox.ur.y),this.polys.push(i)}this.isSubject=r}return A(t,[{key:"getSweepEvents",value:function(){for(var r=[],n=0,o=this.polys.length;n<o;n++)for(var i=this.polys[n].getSweepEvents(),a=0,u=i.length;a<u;a++)r.push(i[a]);return r}}]),t}(),on=function(){A(t,null,[{key:"factory",value:function(r){for(var n=[],o=0,i=r.length;o<i;o++){var a=r[o];if(!(!a.isInResult()||a.ringOut)){for(var u=null,s=a.leftSE,l=a.rightSE,v=[s],d=s.point,x=[];u=s,s=l,v.push(s),s.point!==d;)for(;;){var m=s.getAvailableLinkedEvents();if(m.length===0){var b=v[0].point,S=v[v.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(b.x,",")+" ".concat(b.y,"]. Last matching segment found ends at")+" [".concat(S.x,", ").concat(S.y,"]."))}if(m.length===1){l=m[0].otherSE;break}for(var I=null,L=0,f=x.length;L<f;L++)if(x[L].point===s.point){I=L;break}if(I!==null){var c=x.splice(I)[0],h=v.splice(c.index);h.unshift(h[0].otherSE),n.push(new t(h.reverse()));continue}x.push({index:v.length,point:s.point});var p=s.getLeftmostComparator(u);l=m.sort(p)[0].otherSE;break}n.push(new t(v))}}return n}}]);function t(e){F(this,t),this.events=e;for(var r=0,n=e.length;r<n;r++)e[r].segment.ringOut=this;this.poly=null}return A(t,[{key:"getGeom",value:function(){for(var r=this.events[0].point,n=[r],o=1,i=this.events.length-1;o<i;o++){var a=this.events[o].point,u=this.events[o+1].point;dr(a,r,u)!==0&&(n.push(a),r=a)}if(n.length===1)return null;var s=n[0],l=n[1];dr(s,r,l)===0&&n.shift(),n.push(n[0]);for(var v=this.isExteriorRing()?1:-1,d=this.isExteriorRing()?0:n.length-1,x=this.isExteriorRing()?n.length:-1,m=[],b=d;b!=x;b+=v)m.push([n[b].x,n[b].y]);return m}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var r=this.enclosingRing();this._isExteriorRing=r?!r.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var r=this.events[0],n=1,o=this.events.length;n<o;n++){var i=this.events[n];X.compare(r,i)>0&&(r=i)}for(var a=r.segment.prevInResult(),u=a?a.prevInResult():null;;){if(!a)return null;if(!u)return a.ringOut;if(u.ringOut!==a.ringOut)return u.ringOut.enclosingRing()!==a.ringOut?a.ringOut:a.ringOut.enclosingRing();a=u.prevInResult(),u=a?a.prevInResult():null}}}]),t}(),xr=function(){function t(e){F(this,t),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return A(t,[{key:"addInterior",value:function(r){this.interiorRings.push(r),r.poly=this}},{key:"getGeom",value:function(){var r=[this.exteriorRing.getGeom()];if(r[0]===null)return null;for(var n=0,o=this.interiorRings.length;n<o;n++){var i=this.interiorRings[n].getGeom();i!==null&&r.push(i)}return r}}]),t}(),an=function(){function t(e){F(this,t),this.rings=e,this.polys=this._composePolys(e)}return A(t,[{key:"getGeom",value:function(){for(var r=[],n=0,o=this.polys.length;n<o;n++){var i=this.polys[n].getGeom();i!==null&&r.push(i)}return r}},{key:"_composePolys",value:function(r){for(var n=[],o=0,i=r.length;o<i;o++){var a=r[o];if(!a.poly)if(a.isExteriorRing())n.push(new xr(a));else{var u=a.enclosingRing();u.poly||n.push(new xr(u)),u.poly.addInterior(a)}}return n}}]),t}(),un=function(){function t(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Pe.compare;F(this,t),this.queue=e,this.tree=new je(r),this.segments=[]}return A(t,[{key:"process",value:function(r){var n=r.segment,o=[];if(r.consumedBy)return r.isLeft?this.queue.remove(r.otherSE):this.tree.remove(n),o;var i=r.isLeft?this.tree.insert(n):this.tree.find(n);if(!i)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var a=i,u=i,s=void 0,l=void 0;s===void 0;)a=this.tree.prev(a),a===null?s=null:a.key.consumedBy===void 0&&(s=a.key);for(;l===void 0;)u=this.tree.next(u),u===null?l=null:u.key.consumedBy===void 0&&(l=u.key);if(r.isLeft){var v=null;if(s){var d=s.getIntersection(n);if(d!==null&&(n.isAnEndpoint(d)||(v=d),!s.isAnEndpoint(d)))for(var x=this._splitSafely(s,d),m=0,b=x.length;m<b;m++)o.push(x[m])}var S=null;if(l){var I=l.getIntersection(n);if(I!==null&&(n.isAnEndpoint(I)||(S=I),!l.isAnEndpoint(I)))for(var L=this._splitSafely(l,I),f=0,c=L.length;f<c;f++)o.push(L[f])}if(v!==null||S!==null){var h=null;if(v===null)h=S;else if(S===null)h=v;else{var p=X.comparePoints(v,S);h=p<=0?v:S}this.queue.remove(n.rightSE),o.push(n.rightSE);for(var g=n.split(h),y=0,E=g.length;y<E;y++)o.push(g[y])}o.length>0?(this.tree.remove(n),o.push(r)):(this.segments.push(n),n.prev=s)}else{if(s&&l){var w=s.getIntersection(l);if(w!==null){if(!s.isAnEndpoint(w))for(var M=this._splitSafely(s,w),P=0,O=M.length;P<O;P++)o.push(M[P]);if(!l.isAnEndpoint(w))for(var _=this._splitSafely(l,w),C=0,Z=_.length;C<Z;C++)o.push(_[C])}}this.tree.remove(n)}return o}},{key:"_splitSafely",value:function(r,n){this.tree.remove(r);var o=r.rightSE;this.queue.remove(o);var i=r.split(n);return i.push(o),r.consumedBy===void 0&&this.tree.insert(r),i}}]),t}(),wr=typeof process<"u"&&process.env.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,sn=typeof process<"u"&&process.env.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,ln=function(){function t(){F(this,t)}return A(t,[{key:"run",value:function(r,n,o){D.type=r,de.reset();for(var i=[new Er(n,!0)],a=0,u=o.length;a<u;a++)i.push(new Er(o[a],!1));if(D.numMultiPolys=i.length,D.type==="difference")for(var s=i[0],l=1;l<i.length;)Ue(i[l].bbox,s.bbox)!==null?l++:i.splice(l,1);if(D.type==="intersection"){for(var v=0,d=i.length;v<d;v++)for(var x=i[v],m=v+1,b=i.length;m<b;m++)if(Ue(x.bbox,i[m].bbox)===null)return[]}for(var S=new je(X.compare),I=0,L=i.length;I<L;I++)for(var f=i[I].getSweepEvents(),c=0,h=f.length;c<h;c++)if(S.insert(f[c]),S.size>wr)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var p=new un(S),g=S.size,y=S.pop();y;){var E=y.key;if(S.size===g){var w=E.segment;throw new Error("Unable to pop() ".concat(E.isLeft?"left":"right"," SweepEvent ")+"[".concat(E.point.x,", ").concat(E.point.y,"] from segment #").concat(w.id," ")+"[".concat(w.leftSE.point.x,", ").concat(w.leftSE.point.y,"] -> ")+"[".concat(w.rightSE.point.x,", ").concat(w.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(S.size>wr)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(p.segments.length>sn)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var M=p.process(E),P=0,O=M.length;P<O;P++){var _=M[P];_.consumedBy===void 0&&S.insert(_)}g=S.size,y=S.pop()}de.reset();var C=on.factory(p.segments),Z=new an(C);return Z.getGeom()}}]),t}(),D=new ln,fn=function(e){for(var r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];return D.run("union",e,n)},cn=function(e){for(var r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];return D.run("intersection",e,n)},hn=function(e){for(var r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];return D.run("xor",e,n)},vn=function(e){for(var r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];return D.run("difference",e,n)},pn={union:fn,intersection:cn,xor:hn,difference:vn};function dn(t,e){var r=ne(t),n=ne(e),o=t.properties||{},i=pn.difference(r.coordinates,n.coordinates);return i.length===0?null:i.length===1?se(i[0],o):Le(i,o)}const Yr="split_polygon",Gr=`${Yr}__passing_draw_line_string`,me="splitPolygon_highlight",yn="#222",Te={};Te.onSetup=function(t){var o;const{highlightColor:e}=t||{};let r=this.getSelected().filter(i=>i.type==="Polygon"||i.type==="MultiPolygon").map(i=>i.toGeoJSON());const n=this._ctx.api;return setTimeout(()=>{this.changeMode(Gr,{onDraw:i=>{var u;let a=[];r.forEach(s=>{if(Nr(s,i))throw new Error("Line must be outside of Polygon");{let l=gn(s.geometry,i.geometry);l.id=s.id,n.add(l),a.push(l)}}),this.fireUpdate(a),(u=r==null?void 0:r[0])!=null&&u.id&&n.setFeatureProperty(r[0].id,me,void 0)},onCancel:()=>{var i;(i=r==null?void 0:r[0])!=null&&i.id&&n.setFeatureProperty(r[0].id,me,void 0)}})},0),(o=r==null?void 0:r[0])!=null&&o.id&&n.setFeatureProperty(r[0].id,me,e!=null?e:yn),{main:r}};Te.toDisplayFeatures=function(t,e,r){r(e)};Te.fireUpdate=function(t){this.map.fire(Me.UPDATE,{action:"SplitPolygon",features:t})};function gn(t,e,r){const n="kilometers";var i,a,u,s,l,v,d,x=[],m=[],b=null;if(t.type!="Polygon"&&t.type!="MultiPolygon"||e.type!="LineString"||(u=Ce(t,e),u.features.length==0)||Nr(e,t))return b;for(m[0]=sr(e,.001,{units:n}),m[1]=sr(e,-.001,{units:n}),i=0;i<=1;i++){for(s=i,x=[],a=0;a<e.coordinates.length;a++)x.push(e.coordinates[a]);for(a=m[s].geometry.coordinates.length-1;a>=0;a--)x.push(m[s].geometry.coordinates[a]);x.push(e.coordinates[0]),l=N(x),v=Xt(l),d=dn(t,v)}return d}const ue=`user_${me}`,mn=t=>t.map(e=>e.id.endsWith("inactive")?{...e,filter:[...e.filter,["!has",ue]]}:e).concat([{id:"splitpolygon-fill-active",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["has",ue]],paint:{"fill-color":["get",ue],"fill-outline-color":["get",ue],"fill-opacity":.1}},{id:"splitpolygon-stroke-active",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["has",ue]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["get",ue],"line-dasharray":[.2,2],"line-width":2}}]);function ke(t){const e=t.featureTarget;return!e||!e.properties?!1:e.properties.meta===Ie.VERTEX}function er(t){return t.keyCode===27}function rr(t){return t.keyCode===13}const q={};q.onSetup=function(){const t=this.newFeature({type:$.FEATURE,properties:{},geometry:{type:$.POINT,coordinates:[]}});return this.addFeature(t),this.clearSelectedFeatures(),this.updateUIClasses({mouse:V.ADD}),this.activateUIButton(qe.POINT),this.setActionableState({trash:!0}),{point:t}};q.stopDrawingAndRemove=function(t){this.deleteFeature([t.point.id],{silent:!0}),this.changeMode(k.SIMPLE_SELECT)};q.onTap=q.onClick=function(t,e){this.updateUIClasses({mouse:V.MOVE}),t.point.updateCoordinate("",e.lngLat.lng,e.lngLat.lat),this.map.fire(Me.CREATE,{features:[t.point.toGeoJSON()]}),this.changeMode(k.SIMPLE_SELECT,{featureIds:[t.point.id]})};q.onStop=function(t){this.activateUIButton(),t.point.getCoordinate().length||this.deleteFeature([t.point.id],{silent:!0})};q.toDisplayFeatures=function(t,e,r){const n=e.properties.id===t.point.id;if(e.properties.active=n?W.ACTIVE:W.INACTIVE,!n)return r(e)};q.onTrash=q.stopDrawingAndRemove;q.onKeyUp=function(t,e){if(er(e)||rr(e))return this.stopDrawingAndRemove(t,e)};const{onSetup:En,onClick:xn,...wn}=q;({...wn});function ze(t,e){return t.lngLat?t.lngLat.lng===e[0]&&t.lngLat.lat===e[1]:!1}const ye={enable(t){setTimeout(()=>{!t.map||!t.map.doubleClickZoom||!t._ctx||!t._ctx.store||!t._ctx.store.getInitialConfigValue||!t._ctx.store.getInitialConfigValue("doubleClickZoom")||t.map.doubleClickZoom.enable()},0)},disable(t){setTimeout(()=>{!t.map||!t.map.doubleClickZoom||t.map.doubleClickZoom.disable()},0)}};function $e(t,e,r,n){return{type:$.FEATURE,properties:{meta:Ie.VERTEX,parent:t,coord_path:r,active:n?W.ACTIVE:W.INACTIVE},geometry:{type:$.POINT,coordinates:e}}}const Y={};Y.onSetup=function(t){t=t||{};const e=t.featureId;let r,n,o="forward";if(e){if(r=this.getFeature(e),!r)throw new Error("Could not find a feature with the provided featureId");let i=t.from;if(i&&i.type==="Feature"&&i.geometry&&i.geometry.type==="Point"&&(i=i.geometry),i&&i.type==="Point"&&i.coordinates&&i.coordinates.length===2&&(i=i.coordinates),!i||!Array.isArray(i))throw new Error("Please use the `from` property to indicate which point to continue the line from");const a=r.coordinates.length-1;if(r.coordinates[a][0]===i[0]&&r.coordinates[a][1]===i[1])n=a+1,r.addCoordinate(n,...r.coordinates[a]);else if(r.coordinates[0][0]===i[0]&&r.coordinates[0][1]===i[1])o="backwards",n=0,r.addCoordinate(n,...r.coordinates[0]);else throw new Error("`from` should match the point at either the start or the end of the provided LineString")}else r=this.newFeature({type:$.FEATURE,properties:{},geometry:{type:$.LINE_STRING,coordinates:[]}}),n=0,this.addFeature(r);return this.clearSelectedFeatures(),ye.disable(this),this.updateUIClasses({mouse:V.ADD}),this.activateUIButton(qe.LINE),this.setActionableState({trash:!0}),{line:r,currentVertexPosition:n,direction:o}};Y.clickAnywhere=function(t,e){if(t.currentVertexPosition>0&&ze(e,t.line.coordinates[t.currentVertexPosition-1])||t.direction==="backwards"&&ze(e,t.line.coordinates[t.currentVertexPosition+1]))return this.changeMode(k.SIMPLE_SELECT,{featureIds:[t.line.id]});this.updateUIClasses({mouse:V.ADD}),t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),t.direction==="forward"?(t.currentVertexPosition++,t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat)):t.line.addCoordinate(0,e.lngLat.lng,e.lngLat.lat)};Y.clickOnVertex=function(t){return this.changeMode(k.SIMPLE_SELECT,{featureIds:[t.line.id]})};Y.onMouseMove=function(t,e){t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),ke(e)&&this.updateUIClasses({mouse:V.POINTER})};Y.onTap=Y.onClick=function(t,e){if(ke(e))return this.clickOnVertex(t,e);this.clickAnywhere(t,e)};Y.onKeyUp=function(t,e){rr(e)?this.changeMode(k.SIMPLE_SELECT,{featureIds:[t.line.id]}):er(e)&&(this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(k.SIMPLE_SELECT))};Y.onStop=function(t){ye.enable(this),this.activateUIButton(),this.getFeature(t.line.id)!==void 0&&(t.line.removeCoordinate(`${t.currentVertexPosition}`),t.line.isValid()?this.map.fire(Me.CREATE,{features:[t.line.toGeoJSON()]}):(this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(k.SIMPLE_SELECT,{},{silent:!0})))};Y.onTrash=function(t){this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(k.SIMPLE_SELECT)};Y.toDisplayFeatures=function(t,e,r){const n=e.properties.id===t.line.id;if(e.properties.active=n?W.ACTIVE:W.INACTIVE,!n)return r(e);e.geometry.coordinates.length<2||(e.properties.meta=Ie.FEATURE,r($e(t.line.id,e.geometry.coordinates[t.direction==="forward"?e.geometry.coordinates.length-2:1],`${t.direction==="forward"?e.geometry.coordinates.length-2:1}`,!1)),r(e))};const{onSetup:bn,onMouseMove:Sn,...Pn}=Y,Ae={originOnSetup:bn,originOnMouseMove:Sn,...Pn};Ae.onSetup=function(t){const e=this.originOnSetup(),{onDraw:r,onCancel:n}=t;return e.onDraw=r,e.onCancel=n,e};Ae.onMouseMove=function(t,e){this.updateUIClasses({mouse:V.ADD}),this.originOnMouseMove(t,e)};Ae.onStop=function(t){const e=t.line;if(this.updateUIClasses({mouse:V.NONE}),ye.enable(this),this.activateUIButton(),this.getFeature(e.id)===void 0){typeof t.onCancel=="function"&&t.onCancel();return}else e.removeCoordinate(`${t.currentVertexPosition}`);e.isValid()&&(typeof t.onDraw=="function"?t.onDraw(e.toGeoJSON()):this.map.fire("draw.passing-create",{features:[e.toGeoJSON()]})),this.deleteFeature([e.id],{silent:!0}),this.changeMode(k.SIMPLE_SELECT,{},{silent:!0})};const G={};G.onSetup=function(){const t=this.newFeature({type:$.FEATURE,properties:{},geometry:{type:$.POLYGON,coordinates:[[]]}});return this.addFeature(t),this.clearSelectedFeatures(),ye.disable(this),this.updateUIClasses({mouse:V.ADD}),this.activateUIButton(qe.POLYGON),this.setActionableState({trash:!0}),{polygon:t,currentVertexPosition:0}};G.clickAnywhere=function(t,e){if(t.currentVertexPosition>0&&ze(e,t.polygon.coordinates[0][t.currentVertexPosition-1]))return this.changeMode(k.SIMPLE_SELECT,{featureIds:[t.polygon.id]});this.updateUIClasses({mouse:V.ADD}),t.polygon.updateCoordinate(`0.${t.currentVertexPosition}`,e.lngLat.lng,e.lngLat.lat),t.currentVertexPosition++,t.polygon.updateCoordinate(`0.${t.currentVertexPosition}`,e.lngLat.lng,e.lngLat.lat)};G.clickOnVertex=function(t){return this.changeMode(k.SIMPLE_SELECT,{featureIds:[t.polygon.id]})};G.onMouseMove=function(t,e){t.polygon.updateCoordinate(`0.${t.currentVertexPosition}`,e.lngLat.lng,e.lngLat.lat),ke(e)&&this.updateUIClasses({mouse:V.POINTER})};G.onTap=G.onClick=function(t,e){return ke(e)?this.clickOnVertex(t,e):this.clickAnywhere(t,e)};G.onKeyUp=function(t,e){er(e)?(this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(k.SIMPLE_SELECT)):rr(e)&&this.changeMode(k.SIMPLE_SELECT,{featureIds:[t.polygon.id]})};G.onStop=function(t){this.updateUIClasses({mouse:V.NONE}),ye.enable(this),this.activateUIButton(),this.getFeature(t.polygon.id)!==void 0&&(t.polygon.removeCoordinate(`0.${t.currentVertexPosition}`),t.polygon.isValid()?this.map.fire(Me.CREATE,{features:[t.polygon.toGeoJSON()]}):(this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(k.SIMPLE_SELECT,{},{silent:!0})))};G.toDisplayFeatures=function(t,e,r){const n=e.properties.id===t.polygon.id;if(e.properties.active=n?W.ACTIVE:W.INACTIVE,!n)return r(e);if(e.geometry.coordinates.length===0)return;const o=e.geometry.coordinates[0].length;if(!(o<3)){if(e.properties.meta=Ie.FEATURE,r($e(t.polygon.id,e.geometry.coordinates[0][0],"0.0",!1)),o>3){const i=e.geometry.coordinates[0].length-3;r($e(t.polygon.id,e.geometry.coordinates[0][i],`0.${i}`,!1))}if(o<=4){const i=[[e.geometry.coordinates[0][0][0],e.geometry.coordinates[0][0][1]],[e.geometry.coordinates[0][1][0],e.geometry.coordinates[0][1][1]]];if(r({type:$.FEATURE,properties:e.properties,geometry:{coordinates:i,type:$.LINE_STRING}}),o===3)return}return r(e)}};G.onTrash=function(t){this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(k.SIMPLE_SELECT)};const{onSetup:Mn,onMouseMove:In,..._n}=G;({..._n});function Ln(t){return{...t,[Gr]:Ae,[Yr]:Te}}let he,re,Vr;const On=()=>{try{re==null||re.changeMode("split_polygon")}catch(t){alert(t.message),console.error(t)}};class Cn{constructor(e){let r=this;r.draw=e.draw,r.buttons=e.buttons||[],r.onAddOrig=e.draw.onAdd,r.onRemoveOrig=e.draw.onRemove}onAdd(e){let r=this;return r.map=e,r.elContainer=r.onAddOrig(e),r.buttons.forEach(n=>{r.addButton(n)}),r.elContainer}onRemove(e){let r=this;r.buttons.forEach(n=>{r.removeButton(n)}),r.onRemoveOrig(e)}addButton(e){let r=this;var n=document.createElement("button");n.className="mapbox-gl-draw_ctrl-draw-btn",e.classes instanceof Array&&e.classes.forEach(o=>{n.classList.add(o)}),n.addEventListener(e.on,e.action),r.elContainer.appendChild(n),e.elButton=n}removeButton(e){e.elButton.removeEventListener(e.on,e.action),e.elButton.remove()}}mapboxgl.getRTLTextPluginStatus()==="unavailable"&&mapboxgl.setRTLTextPlugin("https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js",t=>{t&&console.error(t)},!0);he=new mapboxgl.Map({container:"map",style:"https://map.ir/vector/styles/main/mapir-xyz-light-style.json",center:[51.3857,35.6102],zoom:7.78,pitch:0,interactive:!0,hash:!0,attributionControl:!0,customAttribution:"\xA9 Map \xA9 Openstreetmap",transformRequest:t=>({url:t,headers:{"x-api-key":"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImp0aSI6ImRiZWU0YWU4OTk4OTA3MmQ3OTFmMjQ4ZDE5N2VhZTgwZWU2NTUyYjhlYjczOWI2NDdlY2YyYzIzNWRiYThiMzIzOTM5MDkzZDM0NTY2MmU3In0.eyJhdWQiOiI5NDMyIiwianRpIjoiZGJlZTRhZTg5OTg5MDcyZDc5MWYyNDhkMTk3ZWFlODBlZTY1NTJiOGViNzM5YjY0N2VjZjJjMjM1ZGJhOGIzMjM5MzkwOTNkMzQ1NjYyZTciLCJpYXQiOjE1OTA4MjU0NzIsIm5iZiI6MTU5MDgyNTQ3MiwiZXhwIjoxNTkzNDE3NDcyLCJzdWIiOiIiLCJzY29wZXMiOlsiYmFzaWMiXX0.M_z4xJlJRuYrh8RFe9UrW89Y_XBzpPth4yk3hlT-goBm8o3x8DGCrSqgskFfmJTUD2wC2qSoVZzQKB67sm-swtD5fkxZO7C0lBCMAU92IYZwCdYehIOtZbP5L1Lfg3C6pxd0r7gQOdzcAZj9TStnKBQPK3jSvzkiHIQhb6I0sViOS_8JceSNs9ZlVelQ3gs77xM2ksWDM6vmqIndzsS-5hUd-9qdRDTLHnhdbS4_UBwNDza47Iqd5vZkBgmQ_oDZ7dVyBuMHiQFg28V6zhtsf3fijP0UhePCj4GM89g3tzYBOmuapVBobbX395FWpnNC3bYg7zDaVHcllSUYDjGc1A","Mapir-SDK":"reactjs"}})});re=new MapboxDraw({modes:{...Ln(MapboxDraw.modes)},styles:[...mn(Xr)],userProperties:!0});window.draw=re;Vr=new Cn({draw:re,buttons:[{on:"click",action:On,classes:["split-icon"]}]});he.once("load",()=>{he.resize(),he.addControl(Vr,"top-right"),re.set({type:"FeatureCollection",features:[{type:"Feature",properties:{},id:"example-id",geometry:{coordinates:[[[[52,35],[53,35],[53,36],[52,36],[52,35]]],[[[50,35],[51,35],[51,36],[50,36],[50,35]],[[50.2,35.2],[50.8,35.2],[50.8,35.8],[50.2,35.8],[50.2,35.2]]]],type:"MultiPolygon"}}]}),he.on("draw.update",function(t){console.log("\u{1F680} ~ file: index.js ~ line 158 ~ e",t)})});
