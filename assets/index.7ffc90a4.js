import zr from"https://unpkg.com/@mapbox/mapbox-gl-draw@1.3.0/src/lib/theme.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function r(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=r(i);fetch(i.href,o)}})();const V={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},Ze={POLYGON:"polygon",LINE:"line_string",POINT:"point"},T={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},A={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},Me={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},_e={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},Q={ACTIVE:"true",INACTIVE:"false"};var k=63710088e-1,Je={centimeters:k*100,centimetres:k*100,degrees:k/111325,feet:k*3.28084,inches:k*39.37,kilometers:k/1e3,kilometres:k/1e3,meters:k,metres:k,miles:k/1609.344,millimeters:k*1e3,millimetres:k*1e3,nauticalmiles:k/1852,radians:1,yards:k*1.0936},$r={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/k,yards:1.0936133},Re={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function F(t,e,r){r===void 0&&(r={});var n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=e||{},n.geometry=t,n}function qr(t,e,r){switch(t){case"Point":return $(e).geometry;case"LineString":return R(e).geometry;case"Polygon":return se(e).geometry;case"MultiPoint":return Pr(e).geometry;case"MultiLineString":return Ie(e).geometry;case"MultiPolygon":return Le(e).geometry;default:throw new Error(t+" is invalid")}}function $(t,e,r){if(r===void 0&&(r={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ee(t[0])||!Ee(t[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:t};return F(n,e,r)}function Zr(t,e,r){return r===void 0&&(r={}),K(t.map(function(n){return $(n,e)}),r)}function se(t,e,r){r===void 0&&(r={});for(var n=0,i=t;n<i.length;n++){var o=i[n];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<o[o.length-1].length;a++)if(o[o.length-1][a]!==o[0][a])throw new Error("First and last Position are not equivalent.")}var u={type:"Polygon",coordinates:t};return F(u,e,r)}function Jr(t,e,r){return r===void 0&&(r={}),K(t.map(function(n){return se(n,e)}),r)}function R(t,e,r){if(r===void 0&&(r={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:t};return F(n,e,r)}function Wr(t,e,r){return r===void 0&&(r={}),K(t.map(function(n){return R(n,e)}),r)}function K(t,e){e===void 0&&(e={});var r={type:"FeatureCollection"};return e.id&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.features=t,r}function Ie(t,e,r){r===void 0&&(r={});var n={type:"MultiLineString",coordinates:t};return F(n,e,r)}function Pr(t,e,r){r===void 0&&(r={});var n={type:"MultiPoint",coordinates:t};return F(n,e,r)}function Le(t,e,r){r===void 0&&(r={});var n={type:"MultiPolygon",coordinates:t};return F(n,e,r)}function Qr(t,e,r){r===void 0&&(r={});var n={type:"GeometryCollection",geometries:t};return F(n,e,r)}function Kr(t,e){if(e===void 0&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,e||0);return Math.round(t*r)/r}function Mr(t,e){e===void 0&&(e="kilometers");var r=Je[e];if(!r)throw new Error(e+" units is invalid");return t*r}function We(t,e){e===void 0&&(e="kilometers");var r=Je[e];if(!r)throw new Error(e+" units is invalid");return t/r}function _r(t,e){return Ir(We(t,e))}function Hr(t){var e=t%360;return e<0&&(e+=360),e}function Ir(t){var e=t%(2*Math.PI);return e*180/Math.PI}function jr(t){var e=t%360;return e*Math.PI/180}function et(t,e,r){if(e===void 0&&(e="kilometers"),r===void 0&&(r="kilometers"),!(t>=0))throw new Error("length must be a positive number");return Mr(We(t,e),r)}function rt(t,e,r){if(e===void 0&&(e="meters"),r===void 0&&(r="kilometers"),!(t>=0))throw new Error("area must be a positive number");var n=Re[e];if(!n)throw new Error("invalid original units");var i=Re[r];if(!i)throw new Error("invalid final units");return t/n*i}function Ee(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}function Oe(t){return!!t&&t.constructor===Object}function tt(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(function(e){if(!Ee(e))throw new Error("bbox must only contain numbers")})}function nt(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}const it=Object.freeze(Object.defineProperty({__proto__:null,earthRadius:k,factors:Je,unitsFactors:$r,areaFactors:Re,feature:F,geometry:qr,point:$,points:Zr,polygon:se,polygons:Jr,lineString:R,lineStrings:Wr,featureCollection:K,multiLineString:Ie,multiPoint:Pr,multiPolygon:Le,geometryCollection:Qr,round:Kr,radiansToLength:Mr,lengthToRadians:We,lengthToDegrees:_r,bearingToAzimuth:Hr,radiansToDegrees:Ir,degreesToRadians:jr,convertLength:et,convertArea:rt,isNumber:Ee,isObject:Oe,validateBBox:tt,validateId:nt},Symbol.toStringTag,{value:"Module"}));function ot(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return t.geometry.coordinates;if(t.type==="Point")return t.coordinates}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function te(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function ne(t){return t.type==="Feature"?t.geometry:t}function at(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}function le(t,e,r){if(t!==null)for(var n,i,o,a,u,s,l,v=0,d=0,x,E=t.type,b=E==="FeatureCollection",S=E==="Feature",_=b?t.features.length:1,L=0;L<_;L++){l=b?t.features[L].geometry:S?t.geometry:t,x=l?l.type==="GeometryCollection":!1,u=x?l.geometries.length:1;for(var f=0;f<u;f++){var h=0,c=0;if(a=x?l.geometries[f]:l,a!==null){s=a.coordinates;var p=a.type;switch(v=r&&(p==="Polygon"||p==="MultiPolygon")?1:0,p){case null:break;case"Point":if(e(s,d,L,h,c)===!1)return!1;d++,h++;break;case"LineString":case"MultiPoint":for(n=0;n<s.length;n++){if(e(s[n],d,L,h,c)===!1)return!1;d++,p==="MultiPoint"&&h++}p==="LineString"&&h++;break;case"Polygon":case"MultiLineString":for(n=0;n<s.length;n++){for(i=0;i<s[n].length-v;i++){if(e(s[n][i],d,L,h,c)===!1)return!1;d++}p==="MultiLineString"&&h++,p==="Polygon"&&c++}p==="Polygon"&&h++;break;case"MultiPolygon":for(n=0;n<s.length;n++){for(c=0,i=0;i<s[n].length;i++){for(o=0;o<s[n][i].length-v;o++){if(e(s[n][i][o],d,L,h,c)===!1)return!1;d++}c++}h++}break;case"GeometryCollection":for(n=0;n<a.geometries.length;n++)if(le(a.geometries[n],e,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function ut(t,e,r,n){var i=r;return le(t,function(o,a,u,s,l){a===0&&r===void 0?i=o:i=e(i,o,a,u,s,l)},n),i}function Lr(t,e){var r;switch(t.type){case"FeatureCollection":for(r=0;r<t.features.length&&e(t.features[r].properties,r)!==!1;r++);break;case"Feature":e(t.properties,0);break}}function st(t,e,r){var n=r;return Lr(t,function(i,o){o===0&&r===void 0?n=i:n=e(n,i,o)}),n}function xe(t,e){if(t.type==="Feature")e(t,0);else if(t.type==="FeatureCollection")for(var r=0;r<t.features.length&&e(t.features[r],r)!==!1;r++);}function lt(t,e,r){var n=r;return xe(t,function(i,o){o===0&&r===void 0?n=i:n=e(n,i,o)}),n}function ft(t){var e=[];return le(t,function(r){e.push(r)}),e}function Qe(t,e){var r,n,i,o,a,u,s,l,v,d,x=0,E=t.type==="FeatureCollection",b=t.type==="Feature",S=E?t.features.length:1;for(r=0;r<S;r++){for(u=E?t.features[r].geometry:b?t.geometry:t,l=E?t.features[r].properties:b?t.properties:{},v=E?t.features[r].bbox:b?t.bbox:void 0,d=E?t.features[r].id:b?t.id:void 0,s=u?u.type==="GeometryCollection":!1,a=s?u.geometries.length:1,i=0;i<a;i++){if(o=s?u.geometries[i]:u,o===null){if(e(null,x,l,v,d)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,x,l,v,d)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(e(o.geometries[n],x,l,v,d)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}x++}}function ht(t,e,r){var n=r;return Qe(t,function(i,o,a,u,s){o===0&&r===void 0?n=i:n=e(n,i,o,a,u,s)}),n}function H(t,e){Qe(t,function(r,n,i,o,a){var u=r===null?null:r.type;switch(u){case null:case"Point":case"LineString":case"Polygon":return e(F(r,i,{bbox:o,id:a}),n,0)===!1?!1:void 0}var s;switch(u){case"MultiPoint":s="Point";break;case"MultiLineString":s="LineString";break;case"MultiPolygon":s="Polygon";break}for(var l=0;l<r.coordinates.length;l++){var v=r.coordinates[l],d={type:s,coordinates:v};if(e(F(d,i),n,l)===!1)return!1}})}function ct(t,e,r){var n=r;return H(t,function(i,o,a){o===0&&a===0&&r===void 0?n=i:n=e(n,i,o,a)}),n}function Or(t,e){H(t,function(r,n,i){var o=0;if(!!r.geometry){var a=r.geometry.type;if(!(a==="Point"||a==="MultiPoint")){var u,s=0,l=0,v=0;if(le(r,function(d,x,E,b,S){if(u===void 0||n>s||b>l||S>v){u=d,s=n,l=b,v=S,o=0;return}var _=R([u,d],r.properties);if(e(_,n,i,S,o)===!1)return!1;o++,u=d})===!1)return!1}}})}function vt(t,e,r){var n=r,i=!1;return Or(t,function(o,a,u,s,l){i===!1&&r===void 0?n=o:n=e(n,o,a,u,s,l),i=!0}),n}function Cr(t,e){if(!t)throw new Error("geojson is required");H(t,function(r,n,i){if(r.geometry!==null){var o=r.geometry.type,a=r.geometry.coordinates;switch(o){case"LineString":if(e(r,n,i,0,0)===!1)return!1;break;case"Polygon":for(var u=0;u<a.length;u++)if(e(R(a[u],r.properties),n,i,u)===!1)return!1;break}}})}function dt(t,e,r){var n=r;return Cr(t,function(i,o,a,u){o===0&&r===void 0?n=i:n=e(n,i,o,a,u)}),n}function pt(t,e){if(e=e||{},!Oe(e))throw new Error("options is invalid");var r=e.featureIndex||0,n=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.segmentIndex||0,a=e.properties,u;switch(t.type){case"FeatureCollection":r<0&&(r=t.features.length+r),a=a||t.features[r].properties,u=t.features[r].geometry;break;case"Feature":a=a||t.properties,u=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":u=t;break;default:throw new Error("geojson is invalid")}if(u===null)return null;var s=u.coordinates;switch(u.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=s.length+o-1),R([s[o],s[o+1]],a,e);case"Polygon":return i<0&&(i=s.length+i),o<0&&(o=s[i].length+o-1),R([s[i][o],s[i][o+1]],a,e);case"MultiLineString":return n<0&&(n=s.length+n),o<0&&(o=s[n].length+o-1),R([s[n][o],s[n][o+1]],a,e);case"MultiPolygon":return n<0&&(n=s.length+n),i<0&&(i=s[n].length+i),o<0&&(o=s[n][i].length-o-1),R([s[n][i][o],s[n][i][o+1]],a,e)}throw new Error("geojson is invalid")}function yt(t,e){if(e=e||{},!Oe(e))throw new Error("options is invalid");var r=e.featureIndex||0,n=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.coordIndex||0,a=e.properties,u;switch(t.type){case"FeatureCollection":r<0&&(r=t.features.length+r),a=a||t.features[r].properties,u=t.features[r].geometry;break;case"Feature":a=a||t.properties,u=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":u=t;break;default:throw new Error("geojson is invalid")}if(u===null)return null;var s=u.coordinates;switch(u.type){case"Point":return $(s,a,e);case"MultiPoint":return n<0&&(n=s.length+n),$(s[n],a,e);case"LineString":return o<0&&(o=s.length+o),$(s[o],a,e);case"Polygon":return i<0&&(i=s.length+i),o<0&&(o=s[i].length+o),$(s[i][o],a,e);case"MultiLineString":return n<0&&(n=s.length+n),o<0&&(o=s[n].length+o),$(s[n][o],a,e);case"MultiPolygon":return n<0&&(n=s.length+n),i<0&&(i=s[n].length+i),o<0&&(o=s[n][i].length-o),$(s[n][i][o],a,e)}throw new Error("geojson is invalid")}const gt=Object.freeze(Object.defineProperty({__proto__:null,coordAll:ft,coordEach:le,coordReduce:ut,featureEach:xe,featureReduce:lt,findPoint:yt,findSegment:pt,flattenEach:H,flattenReduce:ct,geomEach:Qe,geomReduce:ht,lineEach:Cr,lineReduce:dt,propEach:Lr,propReduce:st,segmentEach:Or,segmentReduce:vt},Symbol.toStringTag,{value:"Module"}));function ir(t){if(!t)throw new Error("geojson is required");var e=[];return H(t,function(r){mt(r,e)}),K(e)}function mt(t,e){var r=[],n=t.geometry;if(n!==null){switch(n.type){case"Polygon":r=te(n);break;case"LineString":r=[te(n)]}r.forEach(function(i){var o=Et(i,t.properties);o.forEach(function(a){a.id=e.length,e.push(a)})})}}function Et(t,e){var r=[];return t.reduce(function(n,i){var o=R([n,i],e);return o.bbox=xt(n,i),r.push(o),i}),r}function xt(t,e){var r=t[0],n=t[1],i=e[0],o=e[1],a=r<i?r:i,u=n<o?n:o,s=r>i?r:i,l=n>o?n:o;return[a,u,s,l]}var wt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ke(t){var e=t.default;if(typeof e=="function"){var r=function(){return e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(n){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(r,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}),r}var He={exports:{}},kr={exports:{}};(function(t,e){(function(r,n){t.exports=n()})(wt,function(){function r(f,h,c,p,g){(function y(m,w,M,P,O){for(;P>M;){if(P-M>600){var I=P-M+1,C=w-M+1,Z=Math.log(I),ee=.5*Math.exp(2*Z/3),ie=.5*Math.sqrt(Z*ee*(I-ee)/I)*(C-I/2<0?-1:1),oe=Math.max(M,Math.floor(w-C*ee/I+ie)),Xr=Math.min(P,Math.floor(w+(I-C)*ee/I+ie));y(m,w,oe,Xr,O)}var ge=m[w],fe=M,Y=P;for(n(m,M,w),O(m[P],ge)>0&&n(m,M,P);fe<Y;){for(n(m,fe,Y),fe++,Y--;O(m[fe],ge)<0;)fe++;for(;O(m[Y],ge)>0;)Y--}O(m[M],ge)===0?n(m,M,Y):n(m,++Y,P),Y<=w&&(M=Y+1),w<=Y&&(P=Y-1)}})(f,h,c||0,p||f.length-1,g||i)}function n(f,h,c){var p=f[h];f[h]=f[c],f[c]=p}function i(f,h){return f<h?-1:f>h?1:0}var o=function(f){f===void 0&&(f=9),this._maxEntries=Math.max(4,f),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function a(f,h,c){if(!c)return h.indexOf(f);for(var p=0;p<h.length;p++)if(c(f,h[p]))return p;return-1}function u(f,h){s(f,0,f.children.length,h,f)}function s(f,h,c,p,g){g||(g=_(null)),g.minX=1/0,g.minY=1/0,g.maxX=-1/0,g.maxY=-1/0;for(var y=h;y<c;y++){var m=f.children[y];l(g,f.leaf?p(m):m)}return g}function l(f,h){return f.minX=Math.min(f.minX,h.minX),f.minY=Math.min(f.minY,h.minY),f.maxX=Math.max(f.maxX,h.maxX),f.maxY=Math.max(f.maxY,h.maxY),f}function v(f,h){return f.minX-h.minX}function d(f,h){return f.minY-h.minY}function x(f){return(f.maxX-f.minX)*(f.maxY-f.minY)}function E(f){return f.maxX-f.minX+(f.maxY-f.minY)}function b(f,h){return f.minX<=h.minX&&f.minY<=h.minY&&h.maxX<=f.maxX&&h.maxY<=f.maxY}function S(f,h){return h.minX<=f.maxX&&h.minY<=f.maxY&&h.maxX>=f.minX&&h.maxY>=f.minY}function _(f){return{children:f,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function L(f,h,c,p,g){for(var y=[h,c];y.length;)if(!((c=y.pop())-(h=y.pop())<=p)){var m=h+Math.ceil((c-h)/p/2)*p;r(f,m,h,c,g),y.push(h,m,m,c)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(f){var h=this.data,c=[];if(!S(f,h))return c;for(var p=this.toBBox,g=[];h;){for(var y=0;y<h.children.length;y++){var m=h.children[y],w=h.leaf?p(m):m;S(f,w)&&(h.leaf?c.push(m):b(f,w)?this._all(m,c):g.push(m))}h=g.pop()}return c},o.prototype.collides=function(f){var h=this.data;if(!S(f,h))return!1;for(var c=[];h;){for(var p=0;p<h.children.length;p++){var g=h.children[p],y=h.leaf?this.toBBox(g):g;if(S(f,y)){if(h.leaf||b(f,y))return!0;c.push(g)}}h=c.pop()}return!1},o.prototype.load=function(f){if(!f||!f.length)return this;if(f.length<this._minEntries){for(var h=0;h<f.length;h++)this.insert(f[h]);return this}var c=this._build(f.slice(),0,f.length-1,0);if(this.data.children.length)if(this.data.height===c.height)this._splitRoot(this.data,c);else{if(this.data.height<c.height){var p=this.data;this.data=c,c=p}this._insert(c,this.data.height-c.height-1,!0)}else this.data=c;return this},o.prototype.insert=function(f){return f&&this._insert(f,this.data.height-1),this},o.prototype.clear=function(){return this.data=_([]),this},o.prototype.remove=function(f,h){if(!f)return this;for(var c,p,g,y=this.data,m=this.toBBox(f),w=[],M=[];y||w.length;){if(y||(y=w.pop(),p=w[w.length-1],c=M.pop(),g=!0),y.leaf){var P=a(f,y.children,h);if(P!==-1)return y.children.splice(P,1),w.push(y),this._condense(w),this}g||y.leaf||!b(y,m)?p?(c++,y=p.children[c],g=!1):y=null:(w.push(y),M.push(c),c=0,p=y,y=y.children[0])}return this},o.prototype.toBBox=function(f){return f},o.prototype.compareMinX=function(f,h){return f.minX-h.minX},o.prototype.compareMinY=function(f,h){return f.minY-h.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(f){return this.data=f,this},o.prototype._all=function(f,h){for(var c=[];f;)f.leaf?h.push.apply(h,f.children):c.push.apply(c,f.children),f=c.pop();return h},o.prototype._build=function(f,h,c,p){var g,y=c-h+1,m=this._maxEntries;if(y<=m)return u(g=_(f.slice(h,c+1)),this.toBBox),g;p||(p=Math.ceil(Math.log(y)/Math.log(m)),m=Math.ceil(y/Math.pow(m,p-1))),(g=_([])).leaf=!1,g.height=p;var w=Math.ceil(y/m),M=w*Math.ceil(Math.sqrt(m));L(f,h,c,M,this.compareMinX);for(var P=h;P<=c;P+=M){var O=Math.min(P+M-1,c);L(f,P,O,w,this.compareMinY);for(var I=P;I<=O;I+=w){var C=Math.min(I+w-1,O);g.children.push(this._build(f,I,C,p-1))}}return u(g,this.toBBox),g},o.prototype._chooseSubtree=function(f,h,c,p){for(;p.push(h),!h.leaf&&p.length-1!==c;){for(var g=1/0,y=1/0,m=void 0,w=0;w<h.children.length;w++){var M=h.children[w],P=x(M),O=(I=f,C=M,(Math.max(C.maxX,I.maxX)-Math.min(C.minX,I.minX))*(Math.max(C.maxY,I.maxY)-Math.min(C.minY,I.minY))-P);O<y?(y=O,g=P<g?P:g,m=M):O===y&&P<g&&(g=P,m=M)}h=m||h.children[0]}var I,C;return h},o.prototype._insert=function(f,h,c){var p=c?f:this.toBBox(f),g=[],y=this._chooseSubtree(p,this.data,h,g);for(y.children.push(f),l(y,p);h>=0&&g[h].children.length>this._maxEntries;)this._split(g,h),h--;this._adjustParentBBoxes(p,g,h)},o.prototype._split=function(f,h){var c=f[h],p=c.children.length,g=this._minEntries;this._chooseSplitAxis(c,g,p);var y=this._chooseSplitIndex(c,g,p),m=_(c.children.splice(y,c.children.length-y));m.height=c.height,m.leaf=c.leaf,u(c,this.toBBox),u(m,this.toBBox),h?f[h-1].children.push(m):this._splitRoot(c,m)},o.prototype._splitRoot=function(f,h){this.data=_([f,h]),this.data.height=f.height+1,this.data.leaf=!1,u(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(f,h,c){for(var p,g,y,m,w,M,P,O=1/0,I=1/0,C=h;C<=c-h;C++){var Z=s(f,0,C,this.toBBox),ee=s(f,C,c,this.toBBox),ie=(g=Z,y=ee,m=void 0,w=void 0,M=void 0,P=void 0,m=Math.max(g.minX,y.minX),w=Math.max(g.minY,y.minY),M=Math.min(g.maxX,y.maxX),P=Math.min(g.maxY,y.maxY),Math.max(0,M-m)*Math.max(0,P-w)),oe=x(Z)+x(ee);ie<O?(O=ie,p=C,I=oe<I?oe:I):ie===O&&oe<I&&(I=oe,p=C)}return p||c-h},o.prototype._chooseSplitAxis=function(f,h,c){var p=f.leaf?this.compareMinX:v,g=f.leaf?this.compareMinY:d;this._allDistMargin(f,h,c,p)<this._allDistMargin(f,h,c,g)&&f.children.sort(p)},o.prototype._allDistMargin=function(f,h,c,p){f.children.sort(p);for(var g=this.toBBox,y=s(f,0,h,g),m=s(f,c-h,c,g),w=E(y)+E(m),M=h;M<c-h;M++){var P=f.children[M];l(y,f.leaf?g(P):P),w+=E(y)}for(var O=c-h-1;O>=h;O--){var I=f.children[O];l(m,f.leaf?g(I):I),w+=E(m)}return w},o.prototype._adjustParentBBoxes=function(f,h,c){for(var p=c;p>=0;p--)l(h[p],f)},o.prototype._condense=function(f){for(var h=f.length-1,c=void 0;h>=0;h--)f[h].children.length===0?h>0?(c=f[h-1].children).splice(c.indexOf(f[h]),1):this.clear():u(f[h],this.toBBox)},o})})(kr);const bt=Ke(it),St=Ke(gt);function we(t){var e=[1/0,1/0,-1/0,-1/0];return le(t,function(r){e[0]>r[0]&&(e[0]=r[0]),e[1]>r[1]&&(e[1]=r[1]),e[2]<r[0]&&(e[2]=r[0]),e[3]<r[1]&&(e[3]=r[1])}),e}we.default=we;const Pt=Object.freeze(Object.defineProperty({__proto__:null,default:we},Symbol.toStringTag,{value:"Module"})),Mt=Ke(Pt);var X=kr.exports,Tr=bt,Ar=St,ae=Mt.default,_t=Ar.featureEach;Ar.coordEach;Tr.polygon;var or=Tr.featureCollection;function Nr(t){var e=new X(t);return e.insert=function(r){if(r.type!=="Feature")throw new Error("invalid feature");return r.bbox=r.bbox?r.bbox:ae(r),X.prototype.insert.call(this,r)},e.load=function(r){var n=[];return Array.isArray(r)?r.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:ae(i),n.push(i)}):_t(r,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:ae(i),n.push(i)}),X.prototype.load.call(this,n)},e.remove=function(r,n){if(r.type!=="Feature")throw new Error("invalid feature");return r.bbox=r.bbox?r.bbox:ae(r),X.prototype.remove.call(this,r,n)},e.clear=function(){return X.prototype.clear.call(this)},e.search=function(r){var n=X.prototype.search.call(this,this.toBBox(r));return or(n)},e.collides=function(r){return X.prototype.collides.call(this,this.toBBox(r))},e.all=function(){var r=X.prototype.all.call(this);return or(r)},e.toJSON=function(){return X.prototype.toJSON.call(this)},e.fromJSON=function(r){return X.prototype.fromJSON.call(this,r)},e.toBBox=function(r){var n;if(r.bbox)n=r.bbox;else if(Array.isArray(r)&&r.length===4)n=r;else if(Array.isArray(r)&&r.length===6)n=[r[0],r[1],r[3],r[4]];else if(r.type==="Feature")n=ae(r);else if(r.type==="FeatureCollection")n=ae(r);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}He.exports=Nr;He.exports.default=Nr;function Ce(t,e){var r={},n=[];if(t.type==="LineString"&&(t=F(t)),e.type==="LineString"&&(e=F(e)),t.type==="Feature"&&e.type==="Feature"&&t.geometry!==null&&e.geometry!==null&&t.geometry.type==="LineString"&&e.geometry.type==="LineString"&&t.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=ar(t,e);return i&&n.push(i),K(n)}var o=He.exports();return o.load(ir(e)),xe(ir(t),function(a){xe(o.search(a),function(u){var s=ar(a,u);if(s){var l=te(s).join(",");r[l]||(r[l]=!0,n.push(s))}})}),K(n)}function ar(t,e){var r=te(t),n=te(e);if(r.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=r[0][0],o=r[0][1],a=r[1][0],u=r[1][1],s=n[0][0],l=n[0][1],v=n[1][0],d=n[1][1],x=(d-l)*(a-i)-(v-s)*(u-o),E=(v-s)*(o-l)-(d-l)*(i-s),b=(a-i)*(o-l)-(u-o)*(i-s);if(x===0)return E===0&&b===0,null;var S=E/x,_=b/x;if(S>=0&&S<=1&&_>=0&&_<=1){var L=i+S*(a-i),f=o+S*(u-o);return $([L,f])}return null}function de(t,e,r){if(r===void 0&&(r={}),!t)throw new Error("point is required");if(!e)throw new Error("polygon is required");var n=ot(t),i=ne(e),o=i.type,a=e.bbox,u=i.coordinates;if(a&&It(n,a)===!1)return!1;o==="Polygon"&&(u=[u]);for(var s=!1,l=0;l<u.length&&!s;l++)if(ur(n,u[l][0],r.ignoreBoundary)){for(var v=!1,d=1;d<u[l].length&&!v;)ur(n,u[l][d],!r.ignoreBoundary)&&(v=!0),d++;v||(s=!0)}return s}function ur(t,e,r){var n=!1;e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]&&(e=e.slice(0,e.length-1));for(var i=0,o=e.length-1;i<e.length;o=i++){var a=e[i][0],u=e[i][1],s=e[o][0],l=e[o][1],v=t[1]*(a-s)+u*(s-t[0])+l*(t[0]-a)===0&&(a-t[0])*(s-t[0])<=0&&(u-t[1])*(l-t[1])<=0;if(v)return!r;var d=u>t[1]!=l>t[1]&&t[0]<(s-a)*(t[1]-u)/(l-u)+a;d&&(n=!n)}return n}function It(t,e){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]>=t[0]&&e[3]>=t[1]}function Fe(t,e){e===void 0&&(e={});var r=ne(t);switch(!e.properties&&t.type==="Feature"&&(e.properties=t.properties),r.type){case"Polygon":return Lt(r,e);case"MultiPolygon":return Ot(r,e);default:throw new Error("invalid poly")}}function Lt(t,e){e===void 0&&(e={});var r=ne(t),n=r.coordinates,i=e.properties?e.properties:t.type==="Feature"?t.properties:{};return Rr(n,i)}function Ot(t,e){e===void 0&&(e={});var r=ne(t),n=r.coordinates,i=e.properties?e.properties:t.type==="Feature"?t.properties:{},o=[];return n.forEach(function(a){o.push(Rr(a,i))}),K(o)}function Rr(t,e){return t.length>1?Ie(t,e):R(t[0],e)}function Fr(t,e){var r=!0;return H(t,function(n){H(e,function(i){if(r===!1)return!1;r=Ct(n.geometry,i.geometry)})}),r}function Ct(t,e){switch(t.type){case"Point":switch(e.type){case"Point":return!Nt(t.coordinates,e.coordinates);case"LineString":return!sr(e,t);case"Polygon":return!de(t,e)}break;case"LineString":switch(e.type){case"Point":return!sr(t,e);case"LineString":return!kt(t,e);case"Polygon":return!lr(e,t)}break;case"Polygon":switch(e.type){case"Point":return!de(e,t);case"LineString":return!lr(t,e);case"Polygon":return!Tt(e,t)}}return!1}function sr(t,e){for(var r=0;r<t.coordinates.length-1;r++)if(At(t.coordinates[r],t.coordinates[r+1],e.coordinates))return!0;return!1}function kt(t,e){var r=Ce(t,e);return r.features.length>0}function lr(t,e){for(var r=0,n=e.coordinates;r<n.length;r++){var i=n[r];if(de(i,t))return!0}var o=Ce(e,Fe(t));return o.features.length>0}function Tt(t,e){for(var r=0,n=t.coordinates[0];r<n.length;r++){var i=n[r];if(de(i,e))return!0}for(var o=0,a=e.coordinates[0];o<a.length;o++){var u=a[o];if(de(u,t))return!0}var s=Ce(Fe(t),Fe(e));return s.features.length>0}function At(t,e,r){var n=r[0]-t[0],i=r[1]-t[1],o=e[0]-t[0],a=e[1]-t[1],u=n*a-i*o;return u!==0?!1:Math.abs(o)>=Math.abs(a)?o>0?t[0]<=r[0]&&r[0]<=e[0]:e[0]<=r[0]&&r[0]<=t[0]:a>0?t[1]<=r[1]&&r[1]<=e[1]:e[1]<=r[1]&&r[1]<=t[1]}function Nt(t,e){return t[0]===e[0]&&t[1]===e[1]}function be(t){var e=t[0],r=t[1];return[r[0]-e[0],r[1]-e[1]]}function Be(t,e){return t[0]*e[1]-e[0]*t[1]}function Rt(t,e){return[t[0]+e[0],t[1]+e[1]]}function Ft(t,e){return[t[0]-e[0],t[1]-e[1]]}function Bt(t,e){return[t*e[0],t*e[1]]}function Yt(t,e){var r=t[0],n=be(t),i=e[0],o=be(e),a=Be(n,o),u=Ft(i,r),s=Be(u,o),l=s/a,v=Rt(r,Bt(l,n));return v}function Dt(t,e){var r=be(t),n=be(e);return Be(r,n)===0}function Gt(t,e){return Dt(t,e)?!1:Yt(t,e)}function fr(t,e,r){if(r=r||{},!Oe(r))throw new Error("options is invalid");var n=r.units;if(!t)throw new Error("geojson is required");if(e==null||isNaN(e))throw new Error("distance is required");var i=at(t),o=t.properties;switch(i){case"LineString":return hr(t,e,n);case"MultiLineString":var a=[];return H(t,function(u){a.push(hr(u,e,n).geometry.coordinates)}),Ie(a,o);default:throw new Error("geometry "+i+" is not supported")}}function hr(t,e,r){var n=[],i=_r(e,r),o=te(t),a=[];return o.forEach(function(u,s){if(s!==o.length-1){var l=Ut(u,o[s+1],i);if(n.push(l),s>0){var v=n[s-1],d=Gt(l,v);d!==!1&&(v[1]=d,l[0]=d),a.push(v[0]),s===o.length-2&&(a.push(l[0]),a.push(l[1]))}o.length===2&&(a.push(l[0]),a.push(l[1]))}}),R(a,t.properties)}function Ut(t,e,r){var n=Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])),i=t[0]+r*(e[1]-t[1])/n,o=e[0]+r*(e[1]-t[1])/n,a=t[1]+r*(t[0]-e[0])/n,u=e[1]+r*(t[0]-e[0])/n;return[[i,a],[o,u]]}function Vt(t){if(!t)throw new Error("geojson is required");switch(t.type){case"Feature":return Br(t);case"FeatureCollection":return Xt(t);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return je(t);default:throw new Error("unknown GeoJSON type")}}function Br(t){var e={type:"Feature"};return Object.keys(t).forEach(function(r){switch(r){case"type":case"properties":case"geometry":return;default:e[r]=t[r]}}),e.properties=Yr(t.properties),e.geometry=je(t.geometry),e}function Yr(t){var e={};return t&&Object.keys(t).forEach(function(r){var n=t[r];typeof n=="object"?n===null?e[r]=null:Array.isArray(n)?e[r]=n.map(function(i){return i}):e[r]=Yr(n):e[r]=n}),e}function Xt(t){var e={type:"FeatureCollection"};return Object.keys(t).forEach(function(r){switch(r){case"type":case"features":return;default:e[r]=t[r]}}),e.features=t.features.map(function(r){return Br(r)}),e}function je(t){var e={type:t.type};return t.bbox&&(e.bbox=t.bbox),t.type==="GeometryCollection"?(e.geometries=t.geometries.map(function(r){return je(r)}),e):(e.coordinates=Dr(t.coordinates),e)}function Dr(t){var e=t;return typeof e[0]!="object"?e.slice():e.map(function(r){return Dr(r)})}function zt(t,e){e===void 0&&(e={});var r,n,i,o=e.properties,a=(r=e.autoComplete)!==null&&r!==void 0?r:!0,u=(n=e.orderCoords)!==null&&n!==void 0?n:!0,s=(i=e.mutate)!==null&&i!==void 0?i:!1;switch(s||(t=Vt(t)),t.type){case"FeatureCollection":var l=[];return t.features.forEach(function(v){l.push(te(cr(v,{},a,u)))}),Le(l,o);default:return cr(t,o,a,u)}}function cr(t,e,r,n){e=e||(t.type==="Feature"?t.properties:{});var i=ne(t),o=i.coordinates,a=i.type;if(!o.length)throw new Error("line must contain coordinates");switch(a){case"LineString":return r&&(o=vr(o)),se([o],e);case"MultiLineString":var u=[],s=0;return o.forEach(function(l){if(r&&(l=vr(l)),n){var v=$t(we(R(l)));v>s?(u.unshift(l),s=v):u.push(l)}else u.push(l)}),se(u,e);default:throw new Error("geometry type "+a+" is not supported")}}function vr(t){var e=t[0],r=e[0],n=e[1],i=t[t.length-1],o=i[0],a=i[1];return(r!==o||n!==a)&&t.push(e),t}function $t(t){var e=t[0],r=t[1],n=t[2],i=t[3];return Math.abs(e-n)*Math.abs(r-i)}/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function qt(t,e){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,a;return a={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(l){return function(v){return s([l,v])}}function s(l){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,i=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){r.label=l[1];break}if(l[0]===6&&r.label<o[1]){r.label=o[1],o=l;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(l);break}o[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(v){l=[6,v],i=0}finally{n=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}var j=function(){function t(e,r){this.next=null,this.key=e,this.data=r,this.left=null,this.right=null}return t}();function Zt(t,e){return t>e?1:t<e?-1:0}function J(t,e,r){for(var n=new j(null,null),i=n,o=n;;){var a=r(t,e.key);if(a<0){if(e.left===null)break;if(r(t,e.left.key)<0){var u=e.left;if(e.left=u.right,u.right=e,e=u,e.left===null)break}o.left=e,o=e,e=e.left}else if(a>0){if(e.right===null)break;if(r(t,e.right.key)>0){var u=e.right;if(e.right=u.left,u.left=e,e=u,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=n.right,e.right=n.left,e}function Ne(t,e,r,n){var i=new j(t,e);if(r===null)return i.left=i.right=null,i;r=J(t,r,n);var o=n(t,r.key);return o<0?(i.left=r.left,i.right=r,r.left=null):o>=0&&(i.right=r.right,i.left=r,r.right=null),i}function dr(t,e,r){var n=null,i=null;if(e){e=J(t,e,r);var o=r(e.key,t);o===0?(n=e.left,i=e.right):o<0?(i=e.right,e.right=null,n=e):(n=e.left,e.left=null,i=e)}return{left:n,right:i}}function Jt(t,e,r){return e===null?t:(t===null||(e=J(t.key,e,r),e.left=t),e)}function Ye(t,e,r,n,i){if(t){n(""+e+(r?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 ")+i(t)+`
`);var o=e+(r?"    ":"\u2502   ");t.left&&Ye(t.left,o,!1,n,i),t.right&&Ye(t.right,o,!0,n,i)}}var er=function(){function t(e){e===void 0&&(e=Zt),this._root=null,this._size=0,this._comparator=e}return t.prototype.insert=function(e,r){return this._size++,this._root=Ne(e,r,this._root,this._comparator)},t.prototype.add=function(e,r){var n=new j(e,r);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,o=J(e,this._root,i),a=i(e,o.key);return a===0?this._root=o:(a<0?(n.left=o.left,n.right=o,o.left=null):a>0&&(n.right=o.right,n.left=o,o.right=null),this._size++,this._root=n),this._root},t.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},t.prototype._remove=function(e,r,n){var i;if(r===null)return null;r=J(e,r,n);var o=n(e,r.key);return o===0?(r.left===null?i=r.right:(i=J(e,r.left,n),i.right=r.right),this._size--,i):r},t.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=J(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},t.prototype.findStatic=function(e){for(var r=this._root,n=this._comparator;r;){var i=n(e,r.key);if(i===0)return r;i<0?r=r.left:r=r.right}return null},t.prototype.find=function(e){return this._root&&(this._root=J(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},t.prototype.contains=function(e){for(var r=this._root,n=this._comparator;r;){var i=n(e,r.key);if(i===0)return!0;i<0?r=r.left:r=r.right}return!1},t.prototype.forEach=function(e,r){for(var n=this._root,i=[],o=!1;!o;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),e.call(r,n),n=n.right):o=!0;return this},t.prototype.range=function(e,r,n,i){for(var o=[],a=this._comparator,u=this._root,s;o.length!==0||u;)if(u)o.push(u),u=u.left;else{if(u=o.pop(),s=a(u.key,r),s>0)break;if(a(u.key,e)>=0&&n.call(i,u))return this;u=u.right}return this},t.prototype.keys=function(){var e=[];return this.forEach(function(r){var n=r.key;return e.push(n)}),e},t.prototype.values=function(){var e=[];return this.forEach(function(r){var n=r.data;return e.push(n)}),e},t.prototype.min=function(){return this._root?this.minNode(this._root).key:null},t.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},t.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},t.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},t.prototype.at=function(e){for(var r=this._root,n=!1,i=0,o=[];!n;)if(r)o.push(r),r=r.left;else if(o.length>0){if(r=o.pop(),i===e)return r;i++,r=r.right}else n=!0;return null},t.prototype.next=function(e){var r=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var i=this._comparator;r;){var o=i(e.key,r.key);if(o===0)break;o<0?(n=r,r=r.left):r=r.right}return n},t.prototype.prev=function(e){var r=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var i=this._comparator;r;){var o=i(e.key,r.key);if(o===0)break;o<0?r=r.left:(n=r,r=r.right)}return n},t.prototype.clear=function(){return this._root=null,this._size=0,this},t.prototype.toList=function(){return Qt(this._root)},t.prototype.load=function(e,r,n){r===void 0&&(r=[]),n===void 0&&(n=!1);var i=e.length,o=this._comparator;if(n&&Ue(e,r,0,i-1,o),this._root===null)this._root=De(e,r,0,i),this._size=i;else{var a=Kt(this.toList(),Wt(e,r),o);i=this._size+i,this._root=Ge({head:a},0,i)}return this},t.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),t.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var r=[];return Ye(this._root,"",!0,function(n){return r.push(n)},e),r.join("")},t.prototype.update=function(e,r,n){var i=this._comparator,o=dr(e,this._root,i),a=o.left,u=o.right;i(e,r)<0?u=Ne(r,n,u,i):a=Ne(r,n,a,i),this._root=Jt(a,u,i)},t.prototype.split=function(e){return dr(e,this._root,this._comparator)},t.prototype[Symbol.iterator]=function(){var e;return qt(this,function(r){switch(r.label){case 0:e=this.minNode(),r.label=1;case 1:return e?[4,e]:[3,3];case 2:return r.sent(),e=this.next(e),[3,1];case 3:return[2]}})},t}();function De(t,e,r,n){var i=n-r;if(i>0){var o=r+Math.floor(i/2),a=t[o],u=e[o],s=new j(a,u);return s.left=De(t,e,r,o),s.right=De(t,e,o+1,n),s}return null}function Wt(t,e){for(var r=new j(null,null),n=r,i=0;i<t.length;i++)n=n.next=new j(t[i],e[i]);return n.next=null,r.next}function Qt(t){for(var e=t,r=[],n=!1,i=new j(null,null),o=i;!n;)e?(r.push(e),e=e.left):r.length>0?(e=o=o.next=r.pop(),e=e.right):n=!0;return o.next=null,i.next}function Ge(t,e,r){var n=r-e;if(n>0){var i=e+Math.floor(n/2),o=Ge(t,e,i),a=t.head;return a.left=o,t.head=t.head.next,a.right=Ge(t,i+1,r),a}return null}function Kt(t,e,r){for(var n=new j(null,null),i=n,o=t,a=e;o!==null&&a!==null;)r(o.key,a.key)<0?(i.next=o,o=o.next):(i.next=a,a=a.next),i=i.next;return o!==null?i.next=o:a!==null&&(i.next=a),n.next}function Ue(t,e,r,n,i){if(!(r>=n)){for(var o=t[r+n>>1],a=r-1,u=n+1;;){do a++;while(i(t[a],o)<0);do u--;while(i(t[u],o)>0);if(a>=u)break;var s=t[a];t[a]=t[u],t[u]=s,s=e[a],e[a]=e[u],e[u]=s}Ue(t,e,r,u,i),Ue(t,e,u+1,n,i)}}function B(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function pr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function N(t,e,r){return e&&pr(t.prototype,e),r&&pr(t,r),t}var he=function(e,r){return e.ll.x<=r.x&&r.x<=e.ur.x&&e.ll.y<=r.y&&r.y<=e.ur.y},Ve=function(e,r){if(r.ur.x<e.ll.x||e.ur.x<r.ll.x||r.ur.y<e.ll.y||e.ur.y<r.ll.y)return null;var n=e.ll.x<r.ll.x?r.ll.x:e.ll.x,i=e.ur.x<r.ur.x?e.ur.x:r.ur.x,o=e.ll.y<r.ll.y?r.ll.y:e.ll.y,a=e.ur.y<r.ur.y?e.ur.y:r.ur.y;return{ll:{x:n,y:o},ur:{x:i,y:a}}},W=Number.EPSILON;W===void 0&&(W=Math.pow(2,-52));var Ht=W*W,Xe=function(e,r){if(-W<e&&e<W&&-W<r&&r<W)return 0;var n=e-r;return n*n<Ht*e*r?0:e<r?-1:1},jt=function(){function t(){B(this,t),this.reset()}return N(t,[{key:"reset",value:function(){this.xRounder=new yr,this.yRounder=new yr}},{key:"round",value:function(r,n){return{x:this.xRounder.round(r),y:this.yRounder.round(n)}}}]),t}(),yr=function(){function t(){B(this,t),this.tree=new er,this.round(0)}return N(t,[{key:"round",value:function(r){var n=this.tree.add(r),i=this.tree.prev(n);if(i!==null&&Xe(n.key,i.key)===0)return this.tree.remove(r),i.key;var o=this.tree.next(n);return o!==null&&Xe(n.key,o.key)===0?(this.tree.remove(r),o.key):r}}]),t}(),pe=new jt,ve=function(e,r){return e.x*r.y-e.y*r.x},Gr=function(e,r){return e.x*r.x+e.y*r.y},gr=function(e,r,n){var i={x:r.x-e.x,y:r.y-e.y},o={x:n.x-e.x,y:n.y-e.y},a=ve(i,o);return Xe(a,0)},Se=function(e){return Math.sqrt(Gr(e,e))},en=function(e,r,n){var i={x:r.x-e.x,y:r.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return ve(o,i)/Se(o)/Se(i)},rn=function(e,r,n){var i={x:r.x-e.x,y:r.y-e.y},o={x:n.x-e.x,y:n.y-e.y};return Gr(o,i)/Se(o)/Se(i)},mr=function(e,r,n){return r.y===0?null:{x:e.x+r.x/r.y*(n-e.y),y:n}},Er=function(e,r,n){return r.x===0?null:{x:n,y:e.y+r.y/r.x*(n-e.x)}},tn=function(e,r,n,i){if(r.x===0)return Er(n,i,e.x);if(i.x===0)return Er(e,r,n.x);if(r.y===0)return mr(n,i,e.y);if(i.y===0)return mr(e,r,n.y);var o=ve(r,i);if(o==0)return null;var a={x:n.x-e.x,y:n.y-e.y},u=ve(a,r)/o,s=ve(a,i)/o,l=e.x+s*r.x,v=n.x+u*i.x,d=e.y+s*r.y,x=n.y+u*i.y,E=(l+v)/2,b=(d+x)/2;return{x:E,y:b}},z=function(){N(t,null,[{key:"compare",value:function(r,n){var i=t.comparePoints(r.point,n.point);return i!==0?i:(r.point!==n.point&&r.link(n),r.isLeft!==n.isLeft?r.isLeft?1:-1:Pe.compare(r.segment,n.segment))}},{key:"comparePoints",value:function(r,n){return r.x<n.x?-1:r.x>n.x?1:r.y<n.y?-1:r.y>n.y?1:0}}]);function t(e,r){B(this,t),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=r}return N(t,[{key:"link",value:function(r){if(r.point===this.point)throw new Error("Tried to link already linked events");for(var n=r.point.events,i=0,o=n.length;i<o;i++){var a=n[i];this.point.events.push(a),a.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var r=this.point.events.length,n=0;n<r;n++){var i=this.point.events[n];if(i.segment.consumedBy===void 0)for(var o=n+1;o<r;o++){var a=this.point.events[o];a.consumedBy===void 0&&i.otherSE.point.events===a.otherSE.point.events&&i.segment.consume(a.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var r=[],n=0,i=this.point.events.length;n<i;n++){var o=this.point.events[n];o!==this&&!o.segment.ringOut&&o.segment.isInResult()&&r.push(o)}return r}},{key:"getLeftmostComparator",value:function(r){var n=this,i=new Map,o=function(u){var s=u.otherSE;i.set(u,{sine:en(n.point,r.point,s.point),cosine:rn(n.point,r.point,s.point)})};return function(a,u){i.has(a)||o(a),i.has(u)||o(u);var s=i.get(a),l=s.sine,v=s.cosine,d=i.get(u),x=d.sine,E=d.cosine;return l>=0&&x>=0?v<E?1:v>E?-1:0:l<0&&x<0?v<E?-1:v>E?1:0:x<l?-1:x>l?1:0}}}]),t}(),nn=0,Pe=function(){N(t,null,[{key:"compare",value:function(r,n){var i=r.leftSE.point.x,o=n.leftSE.point.x,a=r.rightSE.point.x,u=n.rightSE.point.x;if(u<i)return 1;if(a<o)return-1;var s=r.leftSE.point.y,l=n.leftSE.point.y,v=r.rightSE.point.y,d=n.rightSE.point.y;if(i<o){if(l<s&&l<v)return 1;if(l>s&&l>v)return-1;var x=r.comparePoint(n.leftSE.point);if(x<0)return 1;if(x>0)return-1;var E=n.comparePoint(r.rightSE.point);return E!==0?E:-1}if(i>o){if(s<l&&s<d)return-1;if(s>l&&s>d)return 1;var b=n.comparePoint(r.leftSE.point);if(b!==0)return b;var S=r.comparePoint(n.rightSE.point);return S<0?1:S>0?-1:1}if(s<l)return-1;if(s>l)return 1;if(a<u){var _=n.comparePoint(r.rightSE.point);if(_!==0)return _}if(a>u){var L=r.comparePoint(n.rightSE.point);if(L<0)return 1;if(L>0)return-1}if(a!==u){var f=v-s,h=a-i,c=d-l,p=u-o;if(f>h&&c<p)return 1;if(f<h&&c>p)return-1}return a>u?1:a<u||v<d?-1:v>d?1:r.id<n.id?-1:r.id>n.id?1:0}}]);function t(e,r,n,i){B(this,t),this.id=++nn,this.leftSE=e,e.segment=this,e.otherSE=r,this.rightSE=r,r.segment=this,r.otherSE=e,this.rings=n,this.windings=i}return N(t,[{key:"replaceRightSE",value:function(r){this.rightSE=r,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var r=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:r<n?r:n},ur:{x:this.rightSE.point.x,y:r>n?r:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(r){return r.x===this.leftSE.point.x&&r.y===this.leftSE.point.y||r.x===this.rightSE.point.x&&r.y===this.rightSE.point.y}},{key:"comparePoint",value:function(r){if(this.isAnEndpoint(r))return 0;var n=this.leftSE.point,i=this.rightSE.point,o=this.vector();if(n.x===i.x)return r.x===n.x?0:r.x<n.x?1:-1;var a=(r.y-n.y)/o.y,u=n.x+a*o.x;if(r.x===u)return 0;var s=(r.x-n.x)/o.x,l=n.y+s*o.y;return r.y===l?0:r.y<l?-1:1}},{key:"getIntersection",value:function(r){var n=this.bbox(),i=r.bbox(),o=Ve(n,i);if(o===null)return null;var a=this.leftSE.point,u=this.rightSE.point,s=r.leftSE.point,l=r.rightSE.point,v=he(n,s)&&this.comparePoint(s)===0,d=he(i,a)&&r.comparePoint(a)===0,x=he(n,l)&&this.comparePoint(l)===0,E=he(i,u)&&r.comparePoint(u)===0;if(d&&v)return E&&!x?u:!E&&x?l:null;if(d)return x&&a.x===l.x&&a.y===l.y?null:a;if(v)return E&&u.x===s.x&&u.y===s.y?null:s;if(E&&x)return null;if(E)return u;if(x)return l;var b=tn(a,this.vector(),s,r.vector());return b===null||!he(o,b)?null:pe.round(b.x,b.y)}},{key:"split",value:function(r){var n=[],i=r.events!==void 0,o=new z(r,!0),a=new z(r,!1),u=this.rightSE;this.replaceRightSE(a),n.push(a),n.push(o);var s=new t(o,u,this.rings.slice(),this.windings.slice());return z.comparePoints(s.leftSE.point,s.rightSE.point)>0&&s.swapEvents(),z.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(o.checkForConsuming(),a.checkForConsuming()),n}},{key:"swapEvents",value:function(){var r=this.rightSE;this.rightSE=this.leftSE,this.leftSE=r,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,i=this.windings.length;n<i;n++)this.windings[n]*=-1}},{key:"consume",value:function(r){for(var n=this,i=r;n.consumedBy;)n=n.consumedBy;for(;i.consumedBy;)i=i.consumedBy;var o=t.compare(n,i);if(o!==0){if(o>0){var a=n;n=i,i=a}if(n.prev===i){var u=n;n=i,i=u}for(var s=0,l=i.rings.length;s<l;s++){var v=i.rings[s],d=i.windings[s],x=n.rings.indexOf(v);x===-1?(n.rings.push(v),n.windings.push(d)):n.windings[x]+=d}i.rings=null,i.windings=null,i.consumedBy=n,i.leftSE.consumedBy=n.leftSE,i.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var r=this.prev.consumedBy||this.prev;this._beforeState=r.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var r=this.beforeState();this._afterState={rings:r.rings.slice(0),windings:r.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,i=this._afterState.windings,o=this._afterState.multiPolys,a=0,u=this.rings.length;a<u;a++){var s=this.rings[a],l=this.windings[a],v=n.indexOf(s);v===-1?(n.push(s),i.push(l)):i[v]+=l}for(var d=[],x=[],E=0,b=n.length;E<b;E++)if(i[E]!==0){var S=n[E],_=S.poly;if(x.indexOf(_)===-1)if(S.isExterior)d.push(_);else{x.indexOf(_)===-1&&x.push(_);var L=d.indexOf(S.poly);L!==-1&&d.splice(L,1)}}for(var f=0,h=d.length;f<h;f++){var c=d[f].multiPoly;o.indexOf(c)===-1&&o.push(c)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var r=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(D.type){case"union":{var i=r.length===0,o=n.length===0;this._isInResult=i!==o;break}case"intersection":{var a,u;r.length<n.length?(a=r.length,u=n.length):(a=n.length,u=r.length),this._isInResult=u===D.numMultiPolys&&a<u;break}case"xor":{var s=Math.abs(r.length-n.length);this._isInResult=s%2===1;break}case"difference":{var l=function(d){return d.length===1&&d[0].isSubject};this._isInResult=l(r)!==l(n);break}default:throw new Error("Unrecognized operation type found ".concat(D.type))}return this._isInResult}}],[{key:"fromRing",value:function(r,n,i){var o,a,u,s=z.comparePoints(r,n);if(s<0)o=r,a=n,u=1;else if(s>0)o=n,a=r,u=-1;else throw new Error("Tried to create degenerate segment at [".concat(r.x,", ").concat(r.y,"]"));var l=new z(o,!0),v=new z(a,!1);return new t(l,v,[i],[u])}}]),t}(),xr=function(){function t(e,r,n){if(B(this,t),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=r,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=pe.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var o=i,a=1,u=e.length;a<u;a++){if(typeof e[a][0]!="number"||typeof e[a][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var s=pe.round(e[a][0],e[a][1]);s.x===o.x&&s.y===o.y||(this.segments.push(Pe.fromRing(o,s,this)),s.x<this.bbox.ll.x&&(this.bbox.ll.x=s.x),s.y<this.bbox.ll.y&&(this.bbox.ll.y=s.y),s.x>this.bbox.ur.x&&(this.bbox.ur.x=s.x),s.y>this.bbox.ur.y&&(this.bbox.ur.y=s.y),o=s)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(Pe.fromRing(o,i,this))}return N(t,[{key:"getSweepEvents",value:function(){for(var r=[],n=0,i=this.segments.length;n<i;n++){var o=this.segments[n];r.push(o.leftSE),r.push(o.rightSE)}return r}}]),t}(),on=function(){function t(e,r){if(B(this,t),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new xr(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,i=e.length;n<i;n++){var o=new xr(e[n],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=r}return N(t,[{key:"getSweepEvents",value:function(){for(var r=this.exteriorRing.getSweepEvents(),n=0,i=this.interiorRings.length;n<i;n++)for(var o=this.interiorRings[n].getSweepEvents(),a=0,u=o.length;a<u;a++)r.push(o[a]);return r}}]),t}(),wr=function(){function t(e,r){if(B(this,t),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,i=e.length;n<i;n++){var o=new on(e[n],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=r}return N(t,[{key:"getSweepEvents",value:function(){for(var r=[],n=0,i=this.polys.length;n<i;n++)for(var o=this.polys[n].getSweepEvents(),a=0,u=o.length;a<u;a++)r.push(o[a]);return r}}]),t}(),an=function(){N(t,null,[{key:"factory",value:function(r){for(var n=[],i=0,o=r.length;i<o;i++){var a=r[i];if(!(!a.isInResult()||a.ringOut)){for(var u=null,s=a.leftSE,l=a.rightSE,v=[s],d=s.point,x=[];u=s,s=l,v.push(s),s.point!==d;)for(;;){var E=s.getAvailableLinkedEvents();if(E.length===0){var b=v[0].point,S=v[v.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(b.x,",")+" ".concat(b.y,"]. Last matching segment found ends at")+" [".concat(S.x,", ").concat(S.y,"]."))}if(E.length===1){l=E[0].otherSE;break}for(var _=null,L=0,f=x.length;L<f;L++)if(x[L].point===s.point){_=L;break}if(_!==null){var h=x.splice(_)[0],c=v.splice(h.index);c.unshift(c[0].otherSE),n.push(new t(c.reverse()));continue}x.push({index:v.length,point:s.point});var p=s.getLeftmostComparator(u);l=E.sort(p)[0].otherSE;break}n.push(new t(v))}}return n}}]);function t(e){B(this,t),this.events=e;for(var r=0,n=e.length;r<n;r++)e[r].segment.ringOut=this;this.poly=null}return N(t,[{key:"getGeom",value:function(){for(var r=this.events[0].point,n=[r],i=1,o=this.events.length-1;i<o;i++){var a=this.events[i].point,u=this.events[i+1].point;gr(a,r,u)!==0&&(n.push(a),r=a)}if(n.length===1)return null;var s=n[0],l=n[1];gr(s,r,l)===0&&n.shift(),n.push(n[0]);for(var v=this.isExteriorRing()?1:-1,d=this.isExteriorRing()?0:n.length-1,x=this.isExteriorRing()?n.length:-1,E=[],b=d;b!=x;b+=v)E.push([n[b].x,n[b].y]);return E}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var r=this.enclosingRing();this._isExteriorRing=r?!r.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var r=this.events[0],n=1,i=this.events.length;n<i;n++){var o=this.events[n];z.compare(r,o)>0&&(r=o)}for(var a=r.segment.prevInResult(),u=a?a.prevInResult():null;;){if(!a)return null;if(!u)return a.ringOut;if(u.ringOut!==a.ringOut)return u.ringOut.enclosingRing()!==a.ringOut?a.ringOut:a.ringOut.enclosingRing();a=u.prevInResult(),u=a?a.prevInResult():null}}}]),t}(),br=function(){function t(e){B(this,t),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return N(t,[{key:"addInterior",value:function(r){this.interiorRings.push(r),r.poly=this}},{key:"getGeom",value:function(){var r=[this.exteriorRing.getGeom()];if(r[0]===null)return null;for(var n=0,i=this.interiorRings.length;n<i;n++){var o=this.interiorRings[n].getGeom();o!==null&&r.push(o)}return r}}]),t}(),un=function(){function t(e){B(this,t),this.rings=e,this.polys=this._composePolys(e)}return N(t,[{key:"getGeom",value:function(){for(var r=[],n=0,i=this.polys.length;n<i;n++){var o=this.polys[n].getGeom();o!==null&&r.push(o)}return r}},{key:"_composePolys",value:function(r){for(var n=[],i=0,o=r.length;i<o;i++){var a=r[i];if(!a.poly)if(a.isExteriorRing())n.push(new br(a));else{var u=a.enclosingRing();u.poly||n.push(new br(u)),u.poly.addInterior(a)}}return n}}]),t}(),sn=function(){function t(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Pe.compare;B(this,t),this.queue=e,this.tree=new er(r),this.segments=[]}return N(t,[{key:"process",value:function(r){var n=r.segment,i=[];if(r.consumedBy)return r.isLeft?this.queue.remove(r.otherSE):this.tree.remove(n),i;var o=r.isLeft?this.tree.insert(n):this.tree.find(n);if(!o)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var a=o,u=o,s=void 0,l=void 0;s===void 0;)a=this.tree.prev(a),a===null?s=null:a.key.consumedBy===void 0&&(s=a.key);for(;l===void 0;)u=this.tree.next(u),u===null?l=null:u.key.consumedBy===void 0&&(l=u.key);if(r.isLeft){var v=null;if(s){var d=s.getIntersection(n);if(d!==null&&(n.isAnEndpoint(d)||(v=d),!s.isAnEndpoint(d)))for(var x=this._splitSafely(s,d),E=0,b=x.length;E<b;E++)i.push(x[E])}var S=null;if(l){var _=l.getIntersection(n);if(_!==null&&(n.isAnEndpoint(_)||(S=_),!l.isAnEndpoint(_)))for(var L=this._splitSafely(l,_),f=0,h=L.length;f<h;f++)i.push(L[f])}if(v!==null||S!==null){var c=null;if(v===null)c=S;else if(S===null)c=v;else{var p=z.comparePoints(v,S);c=p<=0?v:S}this.queue.remove(n.rightSE),i.push(n.rightSE);for(var g=n.split(c),y=0,m=g.length;y<m;y++)i.push(g[y])}i.length>0?(this.tree.remove(n),i.push(r)):(this.segments.push(n),n.prev=s)}else{if(s&&l){var w=s.getIntersection(l);if(w!==null){if(!s.isAnEndpoint(w))for(var M=this._splitSafely(s,w),P=0,O=M.length;P<O;P++)i.push(M[P]);if(!l.isAnEndpoint(w))for(var I=this._splitSafely(l,w),C=0,Z=I.length;C<Z;C++)i.push(I[C])}}this.tree.remove(n)}return i}},{key:"_splitSafely",value:function(r,n){this.tree.remove(r);var i=r.rightSE;this.queue.remove(i);var o=r.split(n);return o.push(i),r.consumedBy===void 0&&this.tree.insert(r),o}}]),t}(),Sr=typeof process<"u"&&process.env.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,ln=typeof process<"u"&&process.env.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,fn=function(){function t(){B(this,t)}return N(t,[{key:"run",value:function(r,n,i){D.type=r,pe.reset();for(var o=[new wr(n,!0)],a=0,u=i.length;a<u;a++)o.push(new wr(i[a],!1));if(D.numMultiPolys=o.length,D.type==="difference")for(var s=o[0],l=1;l<o.length;)Ve(o[l].bbox,s.bbox)!==null?l++:o.splice(l,1);if(D.type==="intersection"){for(var v=0,d=o.length;v<d;v++)for(var x=o[v],E=v+1,b=o.length;E<b;E++)if(Ve(x.bbox,o[E].bbox)===null)return[]}for(var S=new er(z.compare),_=0,L=o.length;_<L;_++)for(var f=o[_].getSweepEvents(),h=0,c=f.length;h<c;h++)if(S.insert(f[h]),S.size>Sr)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var p=new sn(S),g=S.size,y=S.pop();y;){var m=y.key;if(S.size===g){var w=m.segment;throw new Error("Unable to pop() ".concat(m.isLeft?"left":"right"," SweepEvent ")+"[".concat(m.point.x,", ").concat(m.point.y,"] from segment #").concat(w.id," ")+"[".concat(w.leftSE.point.x,", ").concat(w.leftSE.point.y,"] -> ")+"[".concat(w.rightSE.point.x,", ").concat(w.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(S.size>Sr)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(p.segments.length>ln)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var M=p.process(m),P=0,O=M.length;P<O;P++){var I=M[P];I.consumedBy===void 0&&S.insert(I)}g=S.size,y=S.pop()}pe.reset();var C=an.factory(p.segments),Z=new un(C);return Z.getGeom()}}]),t}(),D=new fn,hn=function(e){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return D.run("union",e,n)},cn=function(e){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return D.run("intersection",e,n)},vn=function(e){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return D.run("xor",e,n)},dn=function(e){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return D.run("difference",e,n)},pn={union:hn,intersection:cn,xor:vn,difference:dn};function yn(t,e){var r=ne(t),n=ne(e),i=t.properties||{},o=pn.difference(r.coordinates,n.coordinates);return o.length===0?null:o.length===1?se(o[0],i):Le(o,i)}const rr="split_polygon",Ur=`${rr}__passing_draw_line_string`,me=`${rr}_highlight`,ze={highlightColor:"#222",lineWidth:.001,lineWidthUnit:"kilometers"},ke={};ke.onSetup=function(t){var a;const{highlightColor:e,lineWidth:r,lineWidthUnit:n}=t||{},i=this.getSelected().filter(u=>u.type===T.POLYGON||u.type===T.MULTI_POLYGON).map(u=>u.toGeoJSON()),o=this._ctx.api;return setTimeout(()=>{this.changeMode(Ur,{onDraw:u=>{var l;const s=[];i.forEach(v=>{if(Fr(v,u))throw new Error("Line must be outside of Polygon");{const d=gn(v.geometry,u.geometry,{line_width:r,line_width_unit:n});d.id=v.id,o.add(d),s.push(d)}}),this.fireUpdate(s),(l=i==null?void 0:i[0])!=null&&l.id&&o.setFeatureProperty(i[0].id,me,void 0)},onCancel:()=>{var u;(u=i==null?void 0:i[0])!=null&&u.id&&o.setFeatureProperty(i[0].id,me,void 0)}})},0),(a=i==null?void 0:i[0])!=null&&a.id&&o.setFeatureProperty(i[0].id,me,e||ze.highlightColor),{main:i}};ke.toDisplayFeatures=function(t,e,r){r(e)};ke.fireUpdate=function(t){this.map.fire(Me.UPDATE,{action:"SplitPolygon",features:t})};function gn(t,e,r){const{line_width:n=ze.line_width,line_width_unit:i=ze.line_width_unit}=r||{},o=[],a=null;let u,s,l,v,d,x,E;if(t.type!=T.POLYGON&&t.type!=T.MULTI_POLYGON||e.type!=T.LINE_STRING||Fr(e,t)||(l=Ce(t,e),l.features.length===0))return a;for(o[0]=fr(e,n,{units:i}),o[1]=fr(e,-n,{units:i}),u=0;u<=1;u++){v=u;const b=[];for(s=0;s<e.coordinates.length;s++)b.push(e.coordinates[s]);for(s=o[v].geometry.coordinates.length-1;s>=0;s--)b.push(o[v].geometry.coordinates[s]);b.push(e.coordinates[0]),d=R(b),x=zt(d),E=yn(t,x)}return E}const ue=`user_${me}`,mn=t=>t.map(e=>e.id.endsWith("inactive")?{...e,filter:[...e.filter,["!has",ue]]}:e).concat([{id:"splitpolygon-fill-active",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["has",ue]],paint:{"fill-color":["get",ue],"fill-outline-color":["get",ue],"fill-opacity":.1}},{id:"splitpolygon-stroke-active",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["has",ue]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["get",ue],"line-dasharray":[.2,2],"line-width":2}}]);function Te(t){const e=t.featureTarget;return!e||!e.properties?!1:e.properties.meta===_e.VERTEX}function tr(t){return t.keyCode===27}function nr(t){return t.keyCode===13}const q={};q.onSetup=function(){const t=this.newFeature({type:T.FEATURE,properties:{},geometry:{type:T.POINT,coordinates:[]}});return this.addFeature(t),this.clearSelectedFeatures(),this.updateUIClasses({mouse:V.ADD}),this.activateUIButton(Ze.POINT),this.setActionableState({trash:!0}),{point:t}};q.stopDrawingAndRemove=function(t){this.deleteFeature([t.point.id],{silent:!0}),this.changeMode(A.SIMPLE_SELECT)};q.onTap=q.onClick=function(t,e){this.updateUIClasses({mouse:V.MOVE}),t.point.updateCoordinate("",e.lngLat.lng,e.lngLat.lat),this.map.fire(Me.CREATE,{features:[t.point.toGeoJSON()]}),this.changeMode(A.SIMPLE_SELECT,{featureIds:[t.point.id]})};q.onStop=function(t){this.activateUIButton(),t.point.getCoordinate().length||this.deleteFeature([t.point.id],{silent:!0})};q.toDisplayFeatures=function(t,e,r){const n=e.properties.id===t.point.id;if(e.properties.active=n?Q.ACTIVE:Q.INACTIVE,!n)return r(e)};q.onTrash=q.stopDrawingAndRemove;q.onKeyUp=function(t,e){if(tr(e)||nr(e))return this.stopDrawingAndRemove(t,e)};const{onSetup:En,onClick:xn,...wn}=q;({...wn});function $e(t,e){return t.lngLat?t.lngLat.lng===e[0]&&t.lngLat.lat===e[1]:!1}const ye={enable(t){setTimeout(()=>{!t.map||!t.map.doubleClickZoom||!t._ctx||!t._ctx.store||!t._ctx.store.getInitialConfigValue||!t._ctx.store.getInitialConfigValue("doubleClickZoom")||t.map.doubleClickZoom.enable()},0)},disable(t){setTimeout(()=>{!t.map||!t.map.doubleClickZoom||t.map.doubleClickZoom.disable()},0)}};function qe(t,e,r,n){return{type:T.FEATURE,properties:{meta:_e.VERTEX,parent:t,coord_path:r,active:n?Q.ACTIVE:Q.INACTIVE},geometry:{type:T.POINT,coordinates:e}}}const G={};G.onSetup=function(t){t=t||{};const e=t.featureId;let r,n,i="forward";if(e){if(r=this.getFeature(e),!r)throw new Error("Could not find a feature with the provided featureId");let o=t.from;if(o&&o.type==="Feature"&&o.geometry&&o.geometry.type==="Point"&&(o=o.geometry),o&&o.type==="Point"&&o.coordinates&&o.coordinates.length===2&&(o=o.coordinates),!o||!Array.isArray(o))throw new Error("Please use the `from` property to indicate which point to continue the line from");const a=r.coordinates.length-1;if(r.coordinates[a][0]===o[0]&&r.coordinates[a][1]===o[1])n=a+1,r.addCoordinate(n,...r.coordinates[a]);else if(r.coordinates[0][0]===o[0]&&r.coordinates[0][1]===o[1])i="backwards",n=0,r.addCoordinate(n,...r.coordinates[0]);else throw new Error("`from` should match the point at either the start or the end of the provided LineString")}else r=this.newFeature({type:T.FEATURE,properties:{},geometry:{type:T.LINE_STRING,coordinates:[]}}),n=0,this.addFeature(r);return this.clearSelectedFeatures(),ye.disable(this),this.updateUIClasses({mouse:V.ADD}),this.activateUIButton(Ze.LINE),this.setActionableState({trash:!0}),{line:r,currentVertexPosition:n,direction:i}};G.clickAnywhere=function(t,e){if(t.currentVertexPosition>0&&$e(e,t.line.coordinates[t.currentVertexPosition-1])||t.direction==="backwards"&&$e(e,t.line.coordinates[t.currentVertexPosition+1]))return this.changeMode(A.SIMPLE_SELECT,{featureIds:[t.line.id]});this.updateUIClasses({mouse:V.ADD}),t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),t.direction==="forward"?(t.currentVertexPosition++,t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat)):t.line.addCoordinate(0,e.lngLat.lng,e.lngLat.lat)};G.clickOnVertex=function(t){return this.changeMode(A.SIMPLE_SELECT,{featureIds:[t.line.id]})};G.onMouseMove=function(t,e){t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),Te(e)&&this.updateUIClasses({mouse:V.POINTER})};G.onTap=G.onClick=function(t,e){if(Te(e))return this.clickOnVertex(t,e);this.clickAnywhere(t,e)};G.onKeyUp=function(t,e){nr(e)?this.changeMode(A.SIMPLE_SELECT,{featureIds:[t.line.id]}):tr(e)&&(this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(A.SIMPLE_SELECT))};G.onStop=function(t){ye.enable(this),this.activateUIButton(),this.getFeature(t.line.id)!==void 0&&(t.line.removeCoordinate(`${t.currentVertexPosition}`),t.line.isValid()?this.map.fire(Me.CREATE,{features:[t.line.toGeoJSON()]}):(this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(A.SIMPLE_SELECT,{},{silent:!0})))};G.onTrash=function(t){this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(A.SIMPLE_SELECT)};G.toDisplayFeatures=function(t,e,r){const n=e.properties.id===t.line.id;if(e.properties.active=n?Q.ACTIVE:Q.INACTIVE,!n)return r(e);e.geometry.coordinates.length<2||(e.properties.meta=_e.FEATURE,r(qe(t.line.id,e.geometry.coordinates[t.direction==="forward"?e.geometry.coordinates.length-2:1],`${t.direction==="forward"?e.geometry.coordinates.length-2:1}`,!1)),r(e))};const{onSetup:bn,onMouseMove:Sn,...Pn}=G,Ae={originOnSetup:bn,originOnMouseMove:Sn,...Pn};Ae.onSetup=function(t){const e=this.originOnSetup(),{onDraw:r,onCancel:n}=t;return e.onDraw=r,e.onCancel=n,e};Ae.onMouseMove=function(t,e){this.updateUIClasses({mouse:V.ADD}),this.originOnMouseMove(t,e)};Ae.onStop=function(t){const e=t.line;if(this.updateUIClasses({mouse:V.NONE}),ye.enable(this),this.activateUIButton(),this.getFeature(e.id)===void 0){typeof t.onCancel=="function"&&t.onCancel();return}else e.removeCoordinate(`${t.currentVertexPosition}`);e.isValid()&&(typeof t.onDraw=="function"?t.onDraw(e.toGeoJSON()):this.map.fire("draw.passing-create",{features:[e.toGeoJSON()]})),this.deleteFeature([e.id],{silent:!0}),this.changeMode(A.SIMPLE_SELECT,{},{silent:!0})};const U={};U.onSetup=function(){const t=this.newFeature({type:T.FEATURE,properties:{},geometry:{type:T.POLYGON,coordinates:[[]]}});return this.addFeature(t),this.clearSelectedFeatures(),ye.disable(this),this.updateUIClasses({mouse:V.ADD}),this.activateUIButton(Ze.POLYGON),this.setActionableState({trash:!0}),{polygon:t,currentVertexPosition:0}};U.clickAnywhere=function(t,e){if(t.currentVertexPosition>0&&$e(e,t.polygon.coordinates[0][t.currentVertexPosition-1]))return this.changeMode(A.SIMPLE_SELECT,{featureIds:[t.polygon.id]});this.updateUIClasses({mouse:V.ADD}),t.polygon.updateCoordinate(`0.${t.currentVertexPosition}`,e.lngLat.lng,e.lngLat.lat),t.currentVertexPosition++,t.polygon.updateCoordinate(`0.${t.currentVertexPosition}`,e.lngLat.lng,e.lngLat.lat)};U.clickOnVertex=function(t){return this.changeMode(A.SIMPLE_SELECT,{featureIds:[t.polygon.id]})};U.onMouseMove=function(t,e){t.polygon.updateCoordinate(`0.${t.currentVertexPosition}`,e.lngLat.lng,e.lngLat.lat),Te(e)&&this.updateUIClasses({mouse:V.POINTER})};U.onTap=U.onClick=function(t,e){return Te(e)?this.clickOnVertex(t,e):this.clickAnywhere(t,e)};U.onKeyUp=function(t,e){tr(e)?(this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(A.SIMPLE_SELECT)):nr(e)&&this.changeMode(A.SIMPLE_SELECT,{featureIds:[t.polygon.id]})};U.onStop=function(t){this.updateUIClasses({mouse:V.NONE}),ye.enable(this),this.activateUIButton(),this.getFeature(t.polygon.id)!==void 0&&(t.polygon.removeCoordinate(`0.${t.currentVertexPosition}`),t.polygon.isValid()?this.map.fire(Me.CREATE,{features:[t.polygon.toGeoJSON()]}):(this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(A.SIMPLE_SELECT,{},{silent:!0})))};U.toDisplayFeatures=function(t,e,r){const n=e.properties.id===t.polygon.id;if(e.properties.active=n?Q.ACTIVE:Q.INACTIVE,!n)return r(e);if(e.geometry.coordinates.length===0)return;const i=e.geometry.coordinates[0].length;if(!(i<3)){if(e.properties.meta=_e.FEATURE,r(qe(t.polygon.id,e.geometry.coordinates[0][0],"0.0",!1)),i>3){const o=e.geometry.coordinates[0].length-3;r(qe(t.polygon.id,e.geometry.coordinates[0][o],`0.${o}`,!1))}if(i<=4){const o=[[e.geometry.coordinates[0][0][0],e.geometry.coordinates[0][0][1]],[e.geometry.coordinates[0][1][0],e.geometry.coordinates[0][1][1]]];if(r({type:T.FEATURE,properties:e.properties,geometry:{coordinates:o,type:T.LINE_STRING}}),i===3)return}return r(e)}};U.onTrash=function(t){this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(A.SIMPLE_SELECT)};const{onSetup:Mn,onMouseMove:_n,...In}=U;({...In});function Ln(t){return{...t,[Ur]:Ae,[rr]:ke}}let ce,re,Vr;const On=()=>{try{re==null||re.changeMode("split_polygon",{highlightColor:"#222",lineWidth:.001,lineWidthUnit:"kilometers"})}catch(t){alert(t.message),console.error(t)}};class Cn{constructor(e){let r=this;r.draw=e.draw,r.buttons=e.buttons||[],r.onAddOrig=e.draw.onAdd,r.onRemoveOrig=e.draw.onRemove}onAdd(e){let r=this;return r.map=e,r.elContainer=r.onAddOrig(e),r.buttons.forEach(n=>{r.addButton(n)}),r.elContainer}onRemove(e){let r=this;r.buttons.forEach(n=>{r.removeButton(n)}),r.onRemoveOrig(e)}addButton(e){let r=this;var n=document.createElement("button");n.className="mapbox-gl-draw_ctrl-draw-btn",e.classes instanceof Array&&e.classes.forEach(i=>{n.classList.add(i)}),n.addEventListener(e.on,e.action),r.elContainer.appendChild(n),e.elButton=n}removeButton(e){e.elButton.removeEventListener(e.on,e.action),e.elButton.remove()}}mapboxgl.getRTLTextPluginStatus()==="unavailable"&&mapboxgl.setRTLTextPlugin("https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js",t=>{t&&console.error(t)},!0);ce=new mapboxgl.Map({container:"map",style:"https://map.ir/vector/styles/main/mapir-xyz-light-style.json",center:[51.3857,35.6102],zoom:7.78,pitch:0,interactive:!0,hash:!0,attributionControl:!0,customAttribution:"\xA9 Map \xA9 Openstreetmap",transformRequest:t=>({url:t,headers:{"x-api-key":"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImp0aSI6ImRiZWU0YWU4OTk4OTA3MmQ3OTFmMjQ4ZDE5N2VhZTgwZWU2NTUyYjhlYjczOWI2NDdlY2YyYzIzNWRiYThiMzIzOTM5MDkzZDM0NTY2MmU3In0.eyJhdWQiOiI5NDMyIiwianRpIjoiZGJlZTRhZTg5OTg5MDcyZDc5MWYyNDhkMTk3ZWFlODBlZTY1NTJiOGViNzM5YjY0N2VjZjJjMjM1ZGJhOGIzMjM5MzkwOTNkMzQ1NjYyZTciLCJpYXQiOjE1OTA4MjU0NzIsIm5iZiI6MTU5MDgyNTQ3MiwiZXhwIjoxNTkzNDE3NDcyLCJzdWIiOiIiLCJzY29wZXMiOlsiYmFzaWMiXX0.M_z4xJlJRuYrh8RFe9UrW89Y_XBzpPth4yk3hlT-goBm8o3x8DGCrSqgskFfmJTUD2wC2qSoVZzQKB67sm-swtD5fkxZO7C0lBCMAU92IYZwCdYehIOtZbP5L1Lfg3C6pxd0r7gQOdzcAZj9TStnKBQPK3jSvzkiHIQhb6I0sViOS_8JceSNs9ZlVelQ3gs77xM2ksWDM6vmqIndzsS-5hUd-9qdRDTLHnhdbS4_UBwNDza47Iqd5vZkBgmQ_oDZ7dVyBuMHiQFg28V6zhtsf3fijP0UhePCj4GM89g3tzYBOmuapVBobbX395FWpnNC3bYg7zDaVHcllSUYDjGc1A","Mapir-SDK":"reactjs"}})});re=new MapboxDraw({modes:{...Ln(MapboxDraw.modes)},styles:[...mn(zr)],userProperties:!0});window.draw=re;Vr=new Cn({draw:re,buttons:[{on:"click",action:On,classes:["split-icon"]}]});ce.once("load",()=>{ce.resize(),ce.addControl(Vr,"top-right"),re.set({type:"FeatureCollection",features:[{type:"Feature",properties:{},id:"example-id",geometry:{coordinates:[[[[52,35],[53,35],[53,36],[52,36],[52,35]]],[[[50,35],[51,35],[51,36],[50,36],[50,35]],[[50.2,35.2],[50.8,35.2],[50.8,35.8],[50.2,35.8],[50.2,35.2]]]],type:"MultiPolygon"}}]}),ce.on("draw.update",function(t){console.log("\u{1F680} ~ file: index.js ~ line 158 ~ e",t)})});
