import wr from"https://unpkg.com/@mapbox/mapbox-gl-draw@1.3.0/src/lib/theme.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerpolicy&&(i.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?i.credentials="include":o.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(o){if(o.ep)return;o.ep=!0;const i=t(o);fetch(o.href,i)}})();const xe={enable(r){setTimeout(()=>{!r.map||!r.map.doubleClickZoom||!r._ctx||!r._ctx.store||!r._ctx.store.getInitialConfigValue||!r._ctx.store.getInitialConfigValue("doubleClickZoom")||r.map.doubleClickZoom.enable()},0)},disable(r){setTimeout(()=>{!r.map||!r.map.doubleClickZoom||r.map.doubleClickZoom.disable()},0)}},Y={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},ht={POLYGON:"polygon",LINE:"line_string",POINT:"point"},N={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},A={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},ze={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},qe={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},ae={ACTIVE:"true",INACTIVE:"false"};function Ze(r){const e=r.featureTarget;return!e||!e.properties?!1:e.properties.meta===qe.VERTEX}function Je(r){return r.keyCode===27}function vt(r){return r.keyCode===13}const ye="select_feature",Ce=`${ye}_highlight`,Er={highlightColor:"#222"},ve={};ve.onSetup=function(r){const{selectHighlightColor:e,onSelect:t,onCancel:n}=r,o={};o.hoveredFeatureID=null,o.selectedFeatureID=null,o.onSelect=t,o.onCancel=n,o.api=this._ctx.api;const{selectHighlightColor:i=Er.highlightColor}=this._ctx.options;return o.options={selectHighlightColor:e||i},o};ve.onMouseMove=function(r,e){const{api:t}=r,{featureTarget:n}=e;if(n){this.updateUIClasses({mouse:Y.POINTER});const o=n.properties.id;r.hoveredFeatureID!==null&&r.hoveredFeatureID!==o&&t.setFeatureProperty(r.hoveredFeatureID,Ce,void 0),r.hoveredFeatureID=o,t.setFeatureProperty(r.hoveredFeatureID,Ce,r.options.selectHighlightColor)}else r.hoveredFeatureID&&t.setFeatureProperty(r.hoveredFeatureID,Ce,void 0),r.hoveredFeatureID=null};ve.onClick=function(r,e){r.selectedFeatureID=r.hoveredFeatureID,this.onStop(r,e)};ve.toDisplayFeatures=function(r,e,t){t(e)};ve.onKeyUp=function(r,e){Je(e)&&this.changeMode(A.SIMPLE_SELECT)};ve.onStop=function(r){this.updateUIClasses({mouse:Y.NONE}),xe.enable(this),this.activateUIButton(),r.selectedFeatureID?(typeof r.onSelect=="function"?r.onSelect(r.selectedFeatureID):this.map.fire("draw.select_mode.select",{featureID:r.selectedFeatureID}),r.selectedFeatureID=null,this.changeMode(A.SIMPLE_SELECT,{},{silent:!0})):typeof r.onCancel=="function"&&r.onCancel(),r.hoveredFeatureID&&(this._ctx.api.setFeatureProperty(r.hoveredFeatureID,Ce,void 0),r.hoveredFeatureID=null)};const ee=`user_${Ce}`,xr=r=>r.concat([{id:`${ye}-fill`,type:"fill",filter:["all",["==","$type","Polygon"],["has",ee]],paint:{"fill-color":["get",ee],"fill-outline-color":["get",ee],"fill-opacity":.2}},{id:`${ye}-stroke`,type:"line",filter:["all",["==","$type","Polygon"],["has",ee]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["get",ee],"line-dasharray":[.2,2],"line-width":2}},{id:`${ye}-line`,type:"line",filter:["all",["==","$type","LineString"],["has",ee]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["get",ee],"line-dasharray":[.2,2],"line-width":2}},{id:`${ye}-point`,type:"circle",filter:["all",["==","$type","Point"],["has",ee]],paint:{"circle-color":["get",ee],"circle-radius":3}}]);function Ht(r){return{...r,[ye]:ve}}function Kt(r){if(!r)throw new Error("geojson is required");switch(r.type){case"Feature":return jt(r);case"FeatureCollection":return br(r);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return pt(r);default:throw new Error("unknown GeoJSON type")}}function jt(r){var e={type:"Feature"};return Object.keys(r).forEach(function(t){switch(t){case"type":case"properties":case"geometry":return;default:e[t]=r[t]}}),e.properties=er(r.properties),e.geometry=pt(r.geometry),e}function er(r){var e={};return r&&Object.keys(r).forEach(function(t){var n=r[t];typeof n=="object"?n===null?e[t]=null:Array.isArray(n)?e[t]=n.map(function(o){return o}):e[t]=er(n):e[t]=n}),e}function br(r){var e={type:"FeatureCollection"};return Object.keys(r).forEach(function(t){switch(t){case"type":case"features":return;default:e[t]=r[t]}}),e.features=r.features.map(function(t){return jt(t)}),e}function pt(r){var e={type:r.type};return r.bbox&&(e.bbox=r.bbox),r.type==="GeometryCollection"?(e.geometries=r.geometries.map(function(t){return pt(t)}),e):(e.coordinates=tr(r.coordinates),e)}function tr(r){var e=r;return typeof e[0]!="object"?e.slice():e.map(function(t){return tr(t)})}var T=63710088e-1,dt={centimeters:T*100,centimetres:T*100,degrees:T/111325,feet:T*3.28084,inches:T*39.37,kilometers:T/1e3,kilometres:T/1e3,meters:T,metres:T,miles:T/1609.344,millimeters:T*1e3,millimetres:T*1e3,nauticalmiles:T/1852,radians:1,yards:T*1.0936},Pr={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/T,yards:1.0936133},et={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function V(r,e,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function Sr(r,e,t){switch(r){case"Point":return K(e).geometry;case"LineString":return B(e).geometry;case"Polygon":return me(e).geometry;case"MultiPoint":return rr(e).geometry;case"MultiLineString":return We(e).geometry;case"MultiPolygon":return Qe(e).geometry;default:throw new Error(r+" is invalid")}}function K(r,e,t){if(t===void 0&&(t={}),!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ye(r[0])||!Ye(r[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:r};return V(n,e,t)}function Mr(r,e,t){return t===void 0&&(t={}),re(r.map(function(n){return K(n,e)}),t)}function me(r,e,t){t===void 0&&(t={});for(var n=0,o=r;n<o.length;n++){var i=o[n];if(i.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<i[i.length-1].length;a++)if(i[i.length-1][a]!==i[0][a])throw new Error("First and last Position are not equivalent.")}var u={type:"Polygon",coordinates:r};return V(u,e,t)}function Ir(r,e,t){return t===void 0&&(t={}),re(r.map(function(n){return me(n,e)}),t)}function B(r,e,t){if(t===void 0&&(t={}),r.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:r};return V(n,e,t)}function Cr(r,e,t){return t===void 0&&(t={}),re(r.map(function(n){return B(n,e)}),t)}function re(r,e){e===void 0&&(e={});var t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function We(r,e,t){t===void 0&&(t={});var n={type:"MultiLineString",coordinates:r};return V(n,e,t)}function rr(r,e,t){t===void 0&&(t={});var n={type:"MultiPoint",coordinates:r};return V(n,e,t)}function Qe(r,e,t){t===void 0&&(t={});var n={type:"MultiPolygon",coordinates:r};return V(n,e,t)}function _r(r,e,t){t===void 0&&(t={});var n={type:"GeometryCollection",geometries:r};return V(n,e,t)}function Lr(r,e){if(e===void 0&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,e||0);return Math.round(r*t)/t}function nr(r,e){e===void 0&&(e="kilometers");var t=dt[e];if(!t)throw new Error(e+" units is invalid");return r*t}function gt(r,e){e===void 0&&(e="kilometers");var t=dt[e];if(!t)throw new Error(e+" units is invalid");return r/t}function ir(r,e){return or(gt(r,e))}function Or(r){var e=r%360;return e<0&&(e+=360),e}function or(r){var e=r%(2*Math.PI);return e*180/Math.PI}function kr(r){var e=r%360;return e*Math.PI/180}function Ar(r,e,t){if(e===void 0&&(e="kilometers"),t===void 0&&(t="kilometers"),!(r>=0))throw new Error("length must be a positive number");return nr(gt(r,e),t)}function Fr(r,e,t){if(e===void 0&&(e="meters"),t===void 0&&(t="kilometers"),!(r>=0))throw new Error("area must be a positive number");var n=et[e];if(!n)throw new Error("invalid original units");var o=et[t];if(!o)throw new Error("invalid final units");return r/n*o}function Ye(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function ke(r){return!!r&&r.constructor===Object}function Tr(r){if(!r)throw new Error("bbox is required");if(!Array.isArray(r))throw new Error("bbox must be an Array");if(r.length!==4&&r.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");r.forEach(function(e){if(!Ye(e))throw new Error("bbox must only contain numbers")})}function Rr(r){if(!r)throw new Error("id is required");if(["string","number"].indexOf(typeof r)===-1)throw new Error("id must be a number or a string")}const Nr=Object.freeze(Object.defineProperty({__proto__:null,earthRadius:T,factors:dt,unitsFactors:Pr,areaFactors:et,feature:V,geometry:Sr,point:K,points:Mr,polygon:me,polygons:Ir,lineString:B,lineStrings:Cr,featureCollection:re,multiLineString:We,multiPoint:rr,multiPolygon:Qe,geometryCollection:_r,round:Lr,radiansToLength:nr,lengthToRadians:gt,lengthToDegrees:ir,bearingToAzimuth:Or,radiansToDegrees:or,degreesToRadians:kr,convertLength:Ar,convertArea:Fr,isNumber:Ye,isObject:ke,validateBBox:Tr,validateId:Rr},Symbol.toStringTag,{value:"Module"}));function Dr(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function G(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function he(r){return r.type==="Feature"?r.geometry:r}function Br(r,e){return r.type==="FeatureCollection"?"FeatureCollection":r.type==="GeometryCollection"?"GeometryCollection":r.type==="Feature"&&r.geometry!==null?r.geometry.type:r.type}function tt(r){for(var e=G(r),t=0,n=1,o,i;n<e.length;)o=i||e[0],i=e[n],t+=(i[0]-o[0])*(i[1]+o[1]),n++;return t>0}function be(r,e,t){if(r!==null)for(var n,o,i,a,u,s,l,v=0,h=0,d,g=r.type,m=g==="FeatureCollection",y=g==="Feature",S=m?r.features.length:1,P=0;P<S;P++){l=m?r.features[P].geometry:y?r.geometry:r,d=l?l.type==="GeometryCollection":!1,u=d?l.geometries.length:1;for(var f=0;f<u;f++){var c=0,p=0;if(a=d?l.geometries[f]:l,a!==null){s=a.coordinates;var w=a.type;switch(v=t&&(w==="Polygon"||w==="MultiPolygon")?1:0,w){case null:break;case"Point":if(e(s,h,P,c,p)===!1)return!1;h++,c++;break;case"LineString":case"MultiPoint":for(n=0;n<s.length;n++){if(e(s[n],h,P,c,p)===!1)return!1;h++,w==="MultiPoint"&&c++}w==="LineString"&&c++;break;case"Polygon":case"MultiLineString":for(n=0;n<s.length;n++){for(o=0;o<s[n].length-v;o++){if(e(s[n][o],h,P,c,p)===!1)return!1;h++}w==="MultiLineString"&&c++,w==="Polygon"&&p++}w==="Polygon"&&c++;break;case"MultiPolygon":for(n=0;n<s.length;n++){for(p=0,o=0;o<s[n].length;o++){for(i=0;i<s[n][o].length-v;i++){if(e(s[n][o][i],h,P,c,p)===!1)return!1;h++}p++}c++}break;case"GeometryCollection":for(n=0;n<a.geometries.length;n++)if(be(a.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Yr(r,e,t,n){var o=t;return be(r,function(i,a,u,s,l){a===0&&t===void 0?o=i:o=e(o,i,a,u,s,l)},n),o}function ar(r,e){var t;switch(r.type){case"FeatureCollection":for(t=0;t<r.features.length&&e(r.features[t].properties,t)!==!1;t++);break;case"Feature":e(r.properties,0);break}}function Gr(r,e,t){var n=t;return ar(r,function(o,i){i===0&&t===void 0?n=o:n=e(n,o,i)}),n}function we(r,e){if(r.type==="Feature")e(r,0);else if(r.type==="FeatureCollection")for(var t=0;t<r.features.length&&e(r.features[t],t)!==!1;t++);}function Vr(r,e,t){var n=t;return we(r,function(o,i){i===0&&t===void 0?n=o:n=e(n,o,i)}),n}function Ur(r){var e=[];return be(r,function(t){e.push(t)}),e}function Ae(r,e){var t,n,o,i,a,u,s,l,v,h,d=0,g=r.type==="FeatureCollection",m=r.type==="Feature",y=g?r.features.length:1;for(t=0;t<y;t++){for(u=g?r.features[t].geometry:m?r.geometry:r,l=g?r.features[t].properties:m?r.properties:{},v=g?r.features[t].bbox:m?r.bbox:void 0,h=g?r.features[t].id:m?r.id:void 0,s=u?u.type==="GeometryCollection":!1,a=s?u.geometries.length:1,o=0;o<a;o++){if(i=s?u.geometries[o]:u,i===null){if(e(null,d,l,v,h)===!1)return!1;continue}switch(i.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(i,d,l,v,h)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<i.geometries.length;n++)if(e(i.geometries[n],d,l,v,h)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}d++}}function Xr(r,e,t){var n=t;return Ae(r,function(o,i,a,u,s){i===0&&t===void 0?n=o:n=e(n,o,i,a,u,s)}),n}function ue(r,e){Ae(r,function(t,n,o,i,a){var u=t===null?null:t.type;switch(u){case null:case"Point":case"LineString":case"Polygon":return e(V(t,o,{bbox:i,id:a}),n,0)===!1?!1:void 0}var s;switch(u){case"MultiPoint":s="Point";break;case"MultiLineString":s="LineString";break;case"MultiPolygon":s="Polygon";break}for(var l=0;l<t.coordinates.length;l++){var v=t.coordinates[l],h={type:s,coordinates:v};if(e(V(h,o),n,l)===!1)return!1}})}function zr(r,e,t){var n=t;return ue(r,function(o,i,a){i===0&&a===0&&t===void 0?n=o:n=e(n,o,i,a)}),n}function ur(r,e){ue(r,function(t,n,o){var i=0;if(!!t.geometry){var a=t.geometry.type;if(!(a==="Point"||a==="MultiPoint")){var u,s=0,l=0,v=0;if(be(t,function(h,d,g,m,y){if(u===void 0||n>s||m>l||y>v){u=h,s=n,l=m,v=y,i=0;return}var S=B([u,h],t.properties);if(e(S,n,o,y,i)===!1)return!1;i++,u=h})===!1)return!1}}})}function qr(r,e,t){var n=t,o=!1;return ur(r,function(i,a,u,s,l){o===!1&&t===void 0?n=i:n=e(n,i,a,u,s,l),o=!0}),n}function sr(r,e){if(!r)throw new Error("geojson is required");ue(r,function(t,n,o){if(t.geometry!==null){var i=t.geometry.type,a=t.geometry.coordinates;switch(i){case"LineString":if(e(t,n,o,0,0)===!1)return!1;break;case"Polygon":for(var u=0;u<a.length;u++)if(e(B(a[u],t.properties),n,o,u)===!1)return!1;break}}})}function Zr(r,e,t){var n=t;return sr(r,function(o,i,a,u){i===0&&t===void 0?n=o:n=e(n,o,i,a,u)}),n}function Jr(r,e){if(e=e||{},!ke(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,o=e.geometryIndex||0,i=e.segmentIndex||0,a=e.properties,u;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),a=a||r.features[t].properties,u=r.features[t].geometry;break;case"Feature":a=a||r.properties,u=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":u=r;break;default:throw new Error("geojson is invalid")}if(u===null)return null;var s=u.coordinates;switch(u.type){case"Point":case"MultiPoint":return null;case"LineString":return i<0&&(i=s.length+i-1),B([s[i],s[i+1]],a,e);case"Polygon":return o<0&&(o=s.length+o),i<0&&(i=s[o].length+i-1),B([s[o][i],s[o][i+1]],a,e);case"MultiLineString":return n<0&&(n=s.length+n),i<0&&(i=s[n].length+i-1),B([s[n][i],s[n][i+1]],a,e);case"MultiPolygon":return n<0&&(n=s.length+n),o<0&&(o=s[n].length+o),i<0&&(i=s[n][o].length-i-1),B([s[n][o][i],s[n][o][i+1]],a,e)}throw new Error("geojson is invalid")}function Wr(r,e){if(e=e||{},!ke(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,o=e.geometryIndex||0,i=e.coordIndex||0,a=e.properties,u;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),a=a||r.features[t].properties,u=r.features[t].geometry;break;case"Feature":a=a||r.properties,u=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":u=r;break;default:throw new Error("geojson is invalid")}if(u===null)return null;var s=u.coordinates;switch(u.type){case"Point":return K(s,a,e);case"MultiPoint":return n<0&&(n=s.length+n),K(s[n],a,e);case"LineString":return i<0&&(i=s.length+i),K(s[i],a,e);case"Polygon":return o<0&&(o=s.length+o),i<0&&(i=s[o].length+i),K(s[o][i],a,e);case"MultiLineString":return n<0&&(n=s.length+n),i<0&&(i=s[n].length+i),K(s[n][i],a,e);case"MultiPolygon":return n<0&&(n=s.length+n),o<0&&(o=s[n].length+o),i<0&&(i=s[n][o].length-i),K(s[n][o][i],a,e)}throw new Error("geojson is invalid")}const Qr=Object.freeze(Object.defineProperty({__proto__:null,coordAll:Ur,coordEach:be,coordReduce:Yr,featureEach:we,featureReduce:Vr,findPoint:Wr,findSegment:Jr,flattenEach:ue,flattenReduce:zr,geomEach:Ae,geomReduce:Xr,lineEach:sr,lineReduce:Zr,propEach:ar,propReduce:Gr,segmentEach:ur,segmentReduce:qr},Symbol.toStringTag,{value:"Module"}));function $r(r,e){if(e=e||{},!ke(e))throw new Error("options is invalid");var t=e.reverse||!1,n=e.mutate||!1;if(!r)throw new Error("<geojson> is required");if(typeof t!="boolean")throw new Error("<reverse> must be a boolean");if(typeof n!="boolean")throw new Error("<mutate> must be a boolean");n===!1&&(r=Kt(r));var o=[];switch(r.type){case"GeometryCollection":return Ae(r,function(i){Be(i,t)}),r;case"FeatureCollection":return we(r,function(i){we(Be(i,t),function(a){o.push(a)})}),re(o)}return Be(r,t)}function Be(r,e){var t=r.type==="Feature"?r.geometry.type:r.type;switch(t){case"GeometryCollection":return Ae(r,function(n){Be(n,e)}),r;case"LineString":return bt(G(r),e),r;case"Polygon":return Pt(G(r),e),r;case"MultiLineString":return G(r).forEach(function(n){bt(n,e)}),r;case"MultiPolygon":return G(r).forEach(function(n){Pt(n,e)}),r;case"Point":case"MultiPoint":return r}}function bt(r,e){tt(r)===e&&r.reverse()}function Pt(r,e){tt(r[0])!==e&&r[0].reverse();for(var t=1;t<r.length;t++)tt(r[t])===e&&r[t].reverse()}function Hr(r,e){var t=0,n=0,o=0,i=0,a=0,u=0,s=0,l=0,v=null,h=null,d=r[0],g=r[1],m=e.length;for(t;t<m;t++){n=0;var y=e[t].length-1,S=e[t];if(v=S[0],v[0]!==S[y][0]&&v[1]!==S[y][1])throw new Error("First and last coordinates in a ring must be the same");for(a=v[0]-d,u=v[1]-g,n;n<y;n++){if(h=S[n+1],l=h[1]-g,u<0&&l<0||u>0&&l>0){v=h,u=l,a=v[0]-d;continue}if(s=h[0]-r[0],l>0&&u<=0){if(i=a*l-s*u,i>0)o=o+1;else if(i===0)return 0}else if(u>0&&l<=0){if(i=a*l-s*u,i<0)o=o+1;else if(i===0)return 0}else if(l===0&&u<0){if(i=a*l-s*u,i===0)return 0}else if(u===0&&l<0){if(i=a*l-s*u,i===0)return 0}else if(u===0&&l===0){if(s<=0&&a>=0)return 0;if(a<=0&&s>=0)return 0}v=h,u=l,a=s}}return o%2!==0}const te=11102230246251565e-32,F=134217729,Kr=(3+8*te)*te;function Ke(r,e,t,n,o){let i,a,u,s,l=e[0],v=n[0],h=0,d=0;v>l==v>-l?(i=l,l=e[++h]):(i=v,v=n[++d]);let g=0;if(h<r&&d<t)for(v>l==v>-l?(a=l+i,u=i-(a-l),l=e[++h]):(a=v+i,u=i-(a-v),v=n[++d]),i=a,u!==0&&(o[g++]=u);h<r&&d<t;)v>l==v>-l?(a=i+l,s=a-i,u=i-(a-s)+(l-s),l=e[++h]):(a=i+v,s=a-i,u=i-(a-s)+(v-s),v=n[++d]),i=a,u!==0&&(o[g++]=u);for(;h<r;)a=i+l,s=a-i,u=i-(a-s)+(l-s),l=e[++h],i=a,u!==0&&(o[g++]=u);for(;d<t;)a=i+v,s=a-i,u=i-(a-s)+(v-s),v=n[++d],i=a,u!==0&&(o[g++]=u);return(i!==0||g===0)&&(o[g++]=i),g}function jr(r,e){let t=e[0];for(let n=1;n<r;n++)t+=e[n];return t}function Fe(r){return new Float64Array(r)}const en=(3+16*te)*te,tn=(2+12*te)*te,rn=(9+64*te)*te*te,pe=Fe(4),St=Fe(8),Mt=Fe(12),It=Fe(16),R=Fe(4);function nn(r,e,t,n,o,i,a){let u,s,l,v,h,d,g,m,y,S,P,f,c,p,w,E,x,b;const M=r-o,C=t-o,I=e-i,_=n-i;p=M*_,d=F*M,g=d-(d-M),m=M-g,d=F*_,y=d-(d-_),S=_-y,w=m*S-(p-g*y-m*y-g*S),E=I*C,d=F*I,g=d-(d-I),m=I-g,d=F*C,y=d-(d-C),S=C-y,x=m*S-(E-g*y-m*y-g*S),P=w-x,h=w-P,pe[0]=w-(P+h)+(h-x),f=p+P,h=f-p,c=p-(f-h)+(P-h),P=c-E,h=c-P,pe[1]=c-(P+h)+(h-E),b=f+P,h=b-f,pe[2]=f-(b-h)+(P-h),pe[3]=b;let L=jr(4,pe),O=tn*a;if(L>=O||-L>=O||(h=r-M,u=r-(M+h)+(h-o),h=t-C,l=t-(C+h)+(h-o),h=e-I,s=e-(I+h)+(h-i),h=n-_,v=n-(_+h)+(h-i),u===0&&s===0&&l===0&&v===0)||(O=rn*a+Kr*Math.abs(L),L+=M*v+_*u-(I*l+C*s),L>=O||-L>=O))return L;p=u*_,d=F*u,g=d-(d-u),m=u-g,d=F*_,y=d-(d-_),S=_-y,w=m*S-(p-g*y-m*y-g*S),E=s*C,d=F*s,g=d-(d-s),m=s-g,d=F*C,y=d-(d-C),S=C-y,x=m*S-(E-g*y-m*y-g*S),P=w-x,h=w-P,R[0]=w-(P+h)+(h-x),f=p+P,h=f-p,c=p-(f-h)+(P-h),P=c-E,h=c-P,R[1]=c-(P+h)+(h-E),b=f+P,h=b-f,R[2]=f-(b-h)+(P-h),R[3]=b;const k=Ke(4,pe,4,R,St);p=M*v,d=F*M,g=d-(d-M),m=M-g,d=F*v,y=d-(d-v),S=v-y,w=m*S-(p-g*y-m*y-g*S),E=I*l,d=F*I,g=d-(d-I),m=I-g,d=F*l,y=d-(d-l),S=l-y,x=m*S-(E-g*y-m*y-g*S),P=w-x,h=w-P,R[0]=w-(P+h)+(h-x),f=p+P,h=f-p,c=p-(f-h)+(P-h),P=c-E,h=c-P,R[1]=c-(P+h)+(h-E),b=f+P,h=b-f,R[2]=f-(b-h)+(P-h),R[3]=b;const X=Ke(k,St,4,R,Mt);p=u*v,d=F*u,g=d-(d-u),m=u-g,d=F*v,y=d-(d-v),S=v-y,w=m*S-(p-g*y-m*y-g*S),E=s*l,d=F*s,g=d-(d-s),m=s-g,d=F*l,y=d-(d-l),S=l-y,x=m*S-(E-g*y-m*y-g*S),P=w-x,h=w-P,R[0]=w-(P+h)+(h-x),f=p+P,h=f-p,c=p-(f-h)+(P-h),P=c-E,h=c-P,R[1]=c-(P+h)+(h-E),b=f+P,h=b-f,R[2]=f-(b-h)+(P-h),R[3]=b;const Q=Ke(X,Mt,4,R,It);return It[Q-1]}function on(r,e,t,n,o,i){const a=(e-i)*(t-o),u=(r-o)*(n-i),s=a-u;if(a===0||u===0||a>0!=u>0)return s;const l=Math.abs(a+u);return Math.abs(s)>=en*l?s:-nn(r,e,t,n,o,i,l)}var Ct=function(e,t,n,o,i){this.p1=e,this.p2=t,this.edgeType=n,this.originalIndex=o,this.polygonContourId=i,this.interiorRing=!1,this.minX=Math.min(e.p[0],t.p[0]),this.minY=Math.min(e.p[1],t.p[1]),this.maxX=Math.max(e.p[0],t.p[0]),this.maxY=Math.max(e.p[1],t.p[1]),this.intersectionPoints=[],this.nextEdge=null},Te=function(e){this.p=e},an=function(e,t){this.id=e,this.rawCoords=t};function un(r,e,t,n,o){for(var i=0,a=[],u=e.type==="Feature"?e.geometry:e,s=u.type==="LineString"?[u.coordinates]:u.coordinates,l=0,v=0;v<s.length;v++){for(var h=s[v].length-1,d=new Te(s[v][0]),g=null,m={nextEdge:null},y=0;y<h;y++){g=new Te(s[v][y+1]),d.nextPoint=g,g.prevPoint=d;var S=new Ct(d,g,"polyline",l,null);n.push(S),m.nextEdge=S,S.prevEdge=m,o[0]=Math.min(o[0],d.p[0]),o[1]=Math.min(o[1],d.p[1]),o[2]=Math.max(o[2],d.p[0]),o[3]=Math.max(o[3],d.p[1]),d=g,l=l+1,m=S}o[0]=Math.min(o[0],s[v][h][0]),o[1]=Math.min(o[1],s[v][h][1]),o[2]=Math.max(o[2],s[v][h][0]),o[3]=Math.max(o[3],s[v][h][1])}for(var P=r.type==="Feature"?r.geometry:r,f=P.type==="Polygon"?[P.coordinates]:P.coordinates,c=f.length,p=0;p<c;p++)for(var w=f[p].length,E=0;E<w;E++){i=i+1;var x=f[p][E],b=x.length;a.push(new an(i,x));for(var M=new Te(x[0]),C=M,I=void 0,_=null,L={nextEdge:null,prevEdge:null},O=null,k=1;k<b;k++)I=new Te(x[k]),C.nextPoint=I,I.prevPoint=C,_=new Ct(C,I,"polygon",l,i),L.nextEdge=_,_.prevEdge=L,k===1&&(O=_),E>0&&(_.interiorRing=!0),_.intersectPolylineBbox=sn(_,o),t.push(_),C=I,l=l+1,L=_;_.nextEdge=O,O.prevEdge=_,I.nextPoint=M.nextPoint,M.prevPoint=I.prevPoint}return a}function sn(r,e){return!(r.maxX<e[0]||r.minX>e[2]||r.maxY<e[1]||r.minY>e[3])}var lr=function(e,t,n,o){this.p=e,this.polylineEdge=t,this.polygonEdge=n,this.isHeadingIn=o,this.distanceFromPolylineEdgeStart=_t(this.polylineEdge.p1.p,this.p),this.distanceFromPolygonEdgeStart=_t(this.polygonEdge.p1.p,this.p),this.polygonEdge.intersectionPoints.push(this),this.polylineEdge.intersectionPoints.push(this),this.visitCount=0};lr.prototype.incrementVisitCount=function(){this.visitCount=this.visitCount+1};function _t(r,e){var t=e[0]-r[0],n=e[1]-r[1];return t*=t,n*=n,Math.sqrt(t+n)}function ln(r,e,t){var n,o,i,a=e.length,u=r.length;for(n=0;n<a;n++){var s=e[n];for(o=0;o<u;o++){var l=r[o];if(!!l.intersectPolylineBbox&&!(l.maxX<s.minX||l.minX>s.maxX)&&!(l.maxY<s.minY||l.minY>s.maxY)){var v=cn(s,l);if(v!==null)for(i=0;i<v.length;i++){var h=on(l.p1.p[0],l.p1.p[1],l.p2.p[0],l.p2.p[1],s.p1.p[0],s.p1.p[1]),d=new lr(v[i],s,l,h>0);t.push(d)}}}}e.forEach(function(g){g.intersectionPoints.sort(function(m,y){return m.distanceFromPolylineEdgeStart-y.distanceFromPolylineEdgeStart})}),r.forEach(function(g){g.intersectionPoints.sort(function(m,y){return m.distanceFromPolygonEdgeStart-y.distanceFromPolygonEdgeStart})})}var fn=1e-9;function Re(r,e){return r[0]*e[1]-r[1]*e[0]}function Ne(r,e){return r[0]*e[0]+r[1]*e[1]}function ce(r,e,t){return[r[0]+e*t[0],r[1]+e*t[1]]}function cn(r,e,t){var n=[r.p2.p[0]-r.p1.p[0],r.p2.p[1]-r.p1.p[1]],o=[e.p2.p[0]-e.p1.p[0],e.p2.p[1]-e.p1.p[1]],i=[e.p1.p[0]-r.p1.p[0],e.p1.p[1]-r.p1.p[1]],a=Re(n,o),u=a*a,s=Ne(n,n);if(u>0){var l=Re(i,o)/a;if(l<0||l>1)return null;var v=Re(i,n)/a;return v<0||v>1?null:l===0||l===1?t?null:[ce(r.p1.p,l,n)]:v===0||v===1?t?null:[ce(e.p1.p,v,o)]:[ce(r.p1.p,l,n)]}var h=Ne(i,i);if(a=Re(i,n),u=a*a,u>fn*s*h)return null;var d=Ne(n,i)/s,g=d+Ne(n,o)/s,m=Math.min(d,g),y=Math.max(d,g);return m<=1&&y>=0?m===1?t?null:[ce(r.p1.p,m>0?m:0,n)]:y===0?t?null:[ce(r.p1.p,y<1?y:1,n)]:t&&m===0&&y===1?null:[ce(r.p1.p,m>0?m:0,n),ce(r.p1.p,y<1?y:1,n)]:null}function hn(r,e){var t=$r(r),n=[],o=[],i=[],a=[1/0,1/0,1/0,1/0],u=un(t,e,o,i,a);if(ln(o,i,n),n.length===0)return r;var s={};u.forEach(function(le){return s[le.id]=0}),n.forEach(function(le){var fe=le.polygonEdge.polygonContourId;s[fe]=s[fe]+1});for(var l=0,v=[],h=null,d=0;d<i.length;d++){var g=i[d];if(g.intersectionPoints.length>0){h=g.intersectionPoints[0];break}}for(var m=h,y={visitCount:1};h!==y&&!(l>n.length*2);){if(l=l++,y.visitCount>=2){for(var S=!1,P=0;P<n.length;P++){var f=n[P];if(f.visitCount<2){m=f,S=!0;break}}if(!S)break}m.visitCount=m.visitCount+1;var c=[];v.push(c),c.push(m.p),m.visitCount=m.visitCount+1;var p=Lt(m,c);y=p;var w=!1;if(p===y&&n.length===2)for(var E=0;E<n.length;E++){var x=n[E];x.visitCount<2&&(w=!0)}for(;p!==m||w;){var b=p.isHeadingIn?yn:gn;p=b(p,c),p!==m&&(p=Lt(p,c)),w=!1}if(y.visitCount>=2){for(var M=!1,C=0;C<n.length;C++){var I=n[C];if(I.visitCount<2){m=I,M=!0;break}}M&&(y=m)}m=y}for(var _=v.map(function(le){return[le]}),L=Object.keys(s),O=0;O<L.length;O++){var k=L[O],X=s[k];if(X===0){var Q=vn(o,parseInt(k)),ne=pn(Q,u);dn(ne,_)}}return{type:"Feature",properties:{},geometry:{type:"MultiPolygon",coordinates:_}}}function vn(r,e){for(var t=0;t<r.length;t++){var n=r[t];if(n.polygonContourId===e)return n}}function pn(r,e){var t=e.find(function(n){return n.id===r.polygonContourId});return t.rawCoords}function dn(r,e){for(var t=0;t<e.length;t++){var n=e[t];if(Hr(r[0],[n[0]])){n.push(r);return}}e.push([r])}function Lt(r,e){var t=r.polygonEdge;if(t.intersectionPoints.length>1){var n=t.intersectionPoints[t.intersectionPoints.length-1];if(n!==r){var o=yt(r,t.intersectionPoints),i=t.intersectionPoints[o+1];return e.push(i.p),i.incrementVisitCount(),i}}for(var a=!0;a;){if(e.push(t.p2.p),t=t.nextEdge,t===null)return r;t.intersectionPoints.length>0&&(a=!1)}return t.intersectionPoints[0].incrementVisitCount(),e.push(t.intersectionPoints[0].p),t.intersectionPoints[0]}function yt(r,e){for(var t=0;t<e.length;t++){var n=e[t];if(n===r)return t}return null}function gn(r,e){var t=r.polylineEdge;if(t.intersectionPoints.length===2){var n=t.intersectionPoints[t.intersectionPoints.length-1];if(n===r){var o=t.intersectionPoints[0];return e.push(o.p),o.incrementVisitCount(),o}else return e.push(n.p),n.incrementVisitCount(),n}else if(t.intersectionPoints.length>2){var i=t.intersectionPoints[0];if(i!==r){var a=yt(r,t.intersectionPoints),u=t.intersectionPoints[a-1];return e.push(u.p),u.incrementVisitCount(),u}}for(var s=!0;s;){if(e.push(t.p1.p),t=t.prevEdge,t.originalIndex===void 0)return r;t.intersectionPoints.length>0&&(s=!1)}if(t.originalIndex===void 0)return r;var l=t.intersectionPoints[t.intersectionPoints.length-1];return l.incrementVisitCount(),e.push(l.p),l}function yn(r,e){var t=r.polylineEdge;if(t.intersectionPoints.length>1){var n=t.intersectionPoints[t.intersectionPoints.length-1];if(n!==r){var o=yt(r,t.intersectionPoints),i=t.intersectionPoints[o+1];return e.push(i.p),i.incrementVisitCount(),i}}for(var a=!0;a;){if(e.push(t.p2.p),t=t.nextEdge,t===null)return r;t.intersectionPoints.length>0&&(a=!1)}if(t===void 0)return r;var u=t.intersectionPoints[0];return u.incrementVisitCount(),e.push(u.p),u}function Ot(r){if(!r)throw new Error("geojson is required");var e=[];return ue(r,function(t){mn(t,e)}),re(e)}function mn(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=G(n);break;case"LineString":t=[G(n)]}t.forEach(function(o){var i=wn(o,r.properties);i.forEach(function(a){a.id=e.length,e.push(a)})})}}function wn(r,e){var t=[];return r.reduce(function(n,o){var i=B([n,o],e);return i.bbox=En(n,o),t.push(i),o}),t}function En(r,e){var t=r[0],n=r[1],o=e[0],i=e[1],a=t<o?t:o,u=n<i?n:i,s=t>o?t:o,l=n>i?n:i;return[a,u,s,l]}var xn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function mt(r){var e=r.default;if(typeof e=="function"){var t=function(){return e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var o=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,o.get?o:{enumerable:!0,get:function(){return r[n]}})}),t}var wt={exports:{}},fr={exports:{}};(function(r,e){(function(t,n){r.exports=n()})(xn,function(){function t(f,c,p,w,E){(function x(b,M,C,I,_){for(;I>C;){if(I-C>600){var L=I-C+1,O=M-C+1,k=Math.log(L),X=.5*Math.exp(2*k/3),Q=.5*Math.sqrt(k*X*(L-X)/L)*(O-L/2<0?-1:1),ne=Math.max(C,Math.floor(M-O*X/L+Q)),le=Math.min(I,Math.floor(M+(L-O)*X/L+Q));x(b,M,ne,le,_)}var fe=b[M],Se=C,z=I;for(n(b,C,M),_(b[I],fe)>0&&n(b,C,I);Se<z;){for(n(b,Se,z),Se++,z--;_(b[Se],fe)<0;)Se++;for(;_(b[z],fe)>0;)z--}_(b[C],fe)===0?n(b,C,z):n(b,++z,I),z<=M&&(C=z+1),M<=z&&(I=z-1)}})(f,c,p||0,w||f.length-1,E||o)}function n(f,c,p){var w=f[c];f[c]=f[p],f[p]=w}function o(f,c){return f<c?-1:f>c?1:0}var i=function(f){f===void 0&&(f=9),this._maxEntries=Math.max(4,f),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function a(f,c,p){if(!p)return c.indexOf(f);for(var w=0;w<c.length;w++)if(p(f,c[w]))return w;return-1}function u(f,c){s(f,0,f.children.length,c,f)}function s(f,c,p,w,E){E||(E=S(null)),E.minX=1/0,E.minY=1/0,E.maxX=-1/0,E.maxY=-1/0;for(var x=c;x<p;x++){var b=f.children[x];l(E,f.leaf?w(b):b)}return E}function l(f,c){return f.minX=Math.min(f.minX,c.minX),f.minY=Math.min(f.minY,c.minY),f.maxX=Math.max(f.maxX,c.maxX),f.maxY=Math.max(f.maxY,c.maxY),f}function v(f,c){return f.minX-c.minX}function h(f,c){return f.minY-c.minY}function d(f){return(f.maxX-f.minX)*(f.maxY-f.minY)}function g(f){return f.maxX-f.minX+(f.maxY-f.minY)}function m(f,c){return f.minX<=c.minX&&f.minY<=c.minY&&c.maxX<=f.maxX&&c.maxY<=f.maxY}function y(f,c){return c.minX<=f.maxX&&c.minY<=f.maxY&&c.maxX>=f.minX&&c.maxY>=f.minY}function S(f){return{children:f,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function P(f,c,p,w,E){for(var x=[c,p];x.length;)if(!((p=x.pop())-(c=x.pop())<=w)){var b=c+Math.ceil((p-c)/w/2)*w;t(f,b,c,p,E),x.push(c,b,b,p)}}return i.prototype.all=function(){return this._all(this.data,[])},i.prototype.search=function(f){var c=this.data,p=[];if(!y(f,c))return p;for(var w=this.toBBox,E=[];c;){for(var x=0;x<c.children.length;x++){var b=c.children[x],M=c.leaf?w(b):b;y(f,M)&&(c.leaf?p.push(b):m(f,M)?this._all(b,p):E.push(b))}c=E.pop()}return p},i.prototype.collides=function(f){var c=this.data;if(!y(f,c))return!1;for(var p=[];c;){for(var w=0;w<c.children.length;w++){var E=c.children[w],x=c.leaf?this.toBBox(E):E;if(y(f,x)){if(c.leaf||m(f,x))return!0;p.push(E)}}c=p.pop()}return!1},i.prototype.load=function(f){if(!f||!f.length)return this;if(f.length<this._minEntries){for(var c=0;c<f.length;c++)this.insert(f[c]);return this}var p=this._build(f.slice(),0,f.length-1,0);if(this.data.children.length)if(this.data.height===p.height)this._splitRoot(this.data,p);else{if(this.data.height<p.height){var w=this.data;this.data=p,p=w}this._insert(p,this.data.height-p.height-1,!0)}else this.data=p;return this},i.prototype.insert=function(f){return f&&this._insert(f,this.data.height-1),this},i.prototype.clear=function(){return this.data=S([]),this},i.prototype.remove=function(f,c){if(!f)return this;for(var p,w,E,x=this.data,b=this.toBBox(f),M=[],C=[];x||M.length;){if(x||(x=M.pop(),w=M[M.length-1],p=C.pop(),E=!0),x.leaf){var I=a(f,x.children,c);if(I!==-1)return x.children.splice(I,1),M.push(x),this._condense(M),this}E||x.leaf||!m(x,b)?w?(p++,x=w.children[p],E=!1):x=null:(M.push(x),C.push(p),p=0,w=x,x=x.children[0])}return this},i.prototype.toBBox=function(f){return f},i.prototype.compareMinX=function(f,c){return f.minX-c.minX},i.prototype.compareMinY=function(f,c){return f.minY-c.minY},i.prototype.toJSON=function(){return this.data},i.prototype.fromJSON=function(f){return this.data=f,this},i.prototype._all=function(f,c){for(var p=[];f;)f.leaf?c.push.apply(c,f.children):p.push.apply(p,f.children),f=p.pop();return c},i.prototype._build=function(f,c,p,w){var E,x=p-c+1,b=this._maxEntries;if(x<=b)return u(E=S(f.slice(c,p+1)),this.toBBox),E;w||(w=Math.ceil(Math.log(x)/Math.log(b)),b=Math.ceil(x/Math.pow(b,w-1))),(E=S([])).leaf=!1,E.height=w;var M=Math.ceil(x/b),C=M*Math.ceil(Math.sqrt(b));P(f,c,p,C,this.compareMinX);for(var I=c;I<=p;I+=C){var _=Math.min(I+C-1,p);P(f,I,_,M,this.compareMinY);for(var L=I;L<=_;L+=M){var O=Math.min(L+M-1,_);E.children.push(this._build(f,L,O,w-1))}}return u(E,this.toBBox),E},i.prototype._chooseSubtree=function(f,c,p,w){for(;w.push(c),!c.leaf&&w.length-1!==p;){for(var E=1/0,x=1/0,b=void 0,M=0;M<c.children.length;M++){var C=c.children[M],I=d(C),_=(L=f,O=C,(Math.max(O.maxX,L.maxX)-Math.min(O.minX,L.minX))*(Math.max(O.maxY,L.maxY)-Math.min(O.minY,L.minY))-I);_<x?(x=_,E=I<E?I:E,b=C):_===x&&I<E&&(E=I,b=C)}c=b||c.children[0]}var L,O;return c},i.prototype._insert=function(f,c,p){var w=p?f:this.toBBox(f),E=[],x=this._chooseSubtree(w,this.data,c,E);for(x.children.push(f),l(x,w);c>=0&&E[c].children.length>this._maxEntries;)this._split(E,c),c--;this._adjustParentBBoxes(w,E,c)},i.prototype._split=function(f,c){var p=f[c],w=p.children.length,E=this._minEntries;this._chooseSplitAxis(p,E,w);var x=this._chooseSplitIndex(p,E,w),b=S(p.children.splice(x,p.children.length-x));b.height=p.height,b.leaf=p.leaf,u(p,this.toBBox),u(b,this.toBBox),c?f[c-1].children.push(b):this._splitRoot(p,b)},i.prototype._splitRoot=function(f,c){this.data=S([f,c]),this.data.height=f.height+1,this.data.leaf=!1,u(this.data,this.toBBox)},i.prototype._chooseSplitIndex=function(f,c,p){for(var w,E,x,b,M,C,I,_=1/0,L=1/0,O=c;O<=p-c;O++){var k=s(f,0,O,this.toBBox),X=s(f,O,p,this.toBBox),Q=(E=k,x=X,b=void 0,M=void 0,C=void 0,I=void 0,b=Math.max(E.minX,x.minX),M=Math.max(E.minY,x.minY),C=Math.min(E.maxX,x.maxX),I=Math.min(E.maxY,x.maxY),Math.max(0,C-b)*Math.max(0,I-M)),ne=d(k)+d(X);Q<_?(_=Q,w=O,L=ne<L?ne:L):Q===_&&ne<L&&(L=ne,w=O)}return w||p-c},i.prototype._chooseSplitAxis=function(f,c,p){var w=f.leaf?this.compareMinX:v,E=f.leaf?this.compareMinY:h;this._allDistMargin(f,c,p,w)<this._allDistMargin(f,c,p,E)&&f.children.sort(w)},i.prototype._allDistMargin=function(f,c,p,w){f.children.sort(w);for(var E=this.toBBox,x=s(f,0,c,E),b=s(f,p-c,p,E),M=g(x)+g(b),C=c;C<p-c;C++){var I=f.children[C];l(x,f.leaf?E(I):I),M+=g(x)}for(var _=p-c-1;_>=c;_--){var L=f.children[_];l(b,f.leaf?E(L):L),M+=g(b)}return M},i.prototype._adjustParentBBoxes=function(f,c,p){for(var w=p;w>=0;w--)l(c[w],f)},i.prototype._condense=function(f){for(var c=f.length-1,p=void 0;c>=0;c--)f[c].children.length===0?c>0?(p=f[c-1].children).splice(p.indexOf(f[c]),1):this.clear():u(f[c],this.toBBox)},i})})(fr);const bn=mt(Nr),Pn=mt(Qr);function Ge(r){var e=[1/0,1/0,-1/0,-1/0];return be(r,function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])}),e}Ge.default=Ge;const Sn=Object.freeze(Object.defineProperty({__proto__:null,default:Ge},Symbol.toStringTag,{value:"Module"})),Mn=mt(Sn);var $=fr.exports,cr=bn,hr=Pn,de=Mn.default,In=hr.featureEach;hr.coordEach;cr.polygon;var kt=cr.featureCollection;function vr(r){var e=new $(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:de(t),$.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(o){if(o.type!=="Feature")throw new Error("invalid features");o.bbox=o.bbox?o.bbox:de(o),n.push(o)}):In(t,function(o){if(o.type!=="Feature")throw new Error("invalid features");o.bbox=o.bbox?o.bbox:de(o),n.push(o)}),$.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:de(t),$.prototype.remove.call(this,t,n)},e.clear=function(){return $.prototype.clear.call(this)},e.search=function(t){var n=$.prototype.search.call(this,this.toBBox(t));return kt(n)},e.collides=function(t){return $.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=$.prototype.all.call(this);return kt(t)},e.toJSON=function(){return $.prototype.toJSON.call(this)},e.fromJSON=function(t){return $.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=de(t);else if(t.type==="FeatureCollection")n=de(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}wt.exports=vr;wt.exports.default=vr;function $e(r,e){var t={},n=[];if(r.type==="LineString"&&(r=V(r)),e.type==="LineString"&&(e=V(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var o=At(r,e);return o&&n.push(o),re(n)}var i=wt.exports();return i.load(Ot(e)),we(Ot(r),function(a){we(i.search(a),function(u){var s=At(a,u);if(s){var l=G(s).join(",");t[l]||(t[l]=!0,n.push(s))}})}),re(n)}function At(r,e){var t=G(r),n=G(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var o=t[0][0],i=t[0][1],a=t[1][0],u=t[1][1],s=n[0][0],l=n[0][1],v=n[1][0],h=n[1][1],d=(h-l)*(a-o)-(v-s)*(u-i),g=(v-s)*(i-l)-(h-l)*(o-s),m=(a-o)*(i-l)-(u-i)*(o-s);if(d===0)return g===0&&m===0,null;var y=g/d,S=m/d;if(y>=0&&y<=1&&S>=0&&S<=1){var P=o+y*(a-o),f=i+y*(u-i);return K([P,f])}return null}function Le(r,e,t){if(t===void 0&&(t={}),!r)throw new Error("point is required");if(!e)throw new Error("polygon is required");var n=Dr(r),o=he(e),i=o.type,a=e.bbox,u=o.coordinates;if(a&&Cn(n,a)===!1)return!1;i==="Polygon"&&(u=[u]);for(var s=!1,l=0;l<u.length&&!s;l++)if(Ft(n,u[l][0],t.ignoreBoundary)){for(var v=!1,h=1;h<u[l].length&&!v;)Ft(n,u[l][h],!t.ignoreBoundary)&&(v=!0),h++;v||(s=!0)}return s}function Ft(r,e,t){var n=!1;e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]&&(e=e.slice(0,e.length-1));for(var o=0,i=e.length-1;o<e.length;i=o++){var a=e[o][0],u=e[o][1],s=e[i][0],l=e[i][1],v=r[1]*(a-s)+u*(s-r[0])+l*(r[0]-a)===0&&(a-r[0])*(s-r[0])<=0&&(u-r[1])*(l-r[1])<=0;if(v)return!t;var h=u>r[1]!=l>r[1]&&r[0]<(s-a)*(r[1]-u)/(l-u)+a;h&&(n=!n)}return n}function Cn(r,e){return e[0]<=r[0]&&e[1]<=r[1]&&e[2]>=r[0]&&e[3]>=r[1]}function rt(r,e){e===void 0&&(e={});var t=he(r);switch(!e.properties&&r.type==="Feature"&&(e.properties=r.properties),t.type){case"Polygon":return _n(t,e);case"MultiPolygon":return Ln(t,e);default:throw new Error("invalid poly")}}function _n(r,e){e===void 0&&(e={});var t=he(r),n=t.coordinates,o=e.properties?e.properties:r.type==="Feature"?r.properties:{};return pr(n,o)}function Ln(r,e){e===void 0&&(e={});var t=he(r),n=t.coordinates,o=e.properties?e.properties:r.type==="Feature"?r.properties:{},i=[];return n.forEach(function(a){i.push(pr(a,o))}),re(i)}function pr(r,e){return r.length>1?We(r,e):B(r[0],e)}function dr(r,e){var t=!0;return ue(r,function(n){ue(e,function(o){if(t===!1)return!1;t=On(n.geometry,o.geometry)})}),t}function On(r,e){switch(r.type){case"Point":switch(e.type){case"Point":return!Tn(r.coordinates,e.coordinates);case"LineString":return!Tt(e,r);case"Polygon":return!Le(r,e)}break;case"LineString":switch(e.type){case"Point":return!Tt(r,e);case"LineString":return!kn(r,e);case"Polygon":return!Rt(e,r)}break;case"Polygon":switch(e.type){case"Point":return!Le(e,r);case"LineString":return!Rt(r,e);case"Polygon":return!An(e,r)}}return!1}function Tt(r,e){for(var t=0;t<r.coordinates.length-1;t++)if(Fn(r.coordinates[t],r.coordinates[t+1],e.coordinates))return!0;return!1}function kn(r,e){var t=$e(r,e);return t.features.length>0}function Rt(r,e){for(var t=0,n=e.coordinates;t<n.length;t++){var o=n[t];if(Le(o,r))return!0}var i=$e(e,rt(r));return i.features.length>0}function An(r,e){for(var t=0,n=r.coordinates[0];t<n.length;t++){var o=n[t];if(Le(o,e))return!0}for(var i=0,a=e.coordinates[0];i<a.length;i++){var u=a[i];if(Le(u,r))return!0}var s=$e(rt(r),rt(e));return s.features.length>0}function Fn(r,e,t){var n=t[0]-r[0],o=t[1]-r[1],i=e[0]-r[0],a=e[1]-r[1],u=n*a-o*i;return u!==0?!1:Math.abs(i)>=Math.abs(a)?i>0?r[0]<=t[0]&&t[0]<=e[0]:e[0]<=t[0]&&t[0]<=r[0]:a>0?r[1]<=t[1]&&t[1]<=e[1]:e[1]<=t[1]&&t[1]<=r[1]}function Tn(r,e){return r[0]===e[0]&&r[1]===e[1]}function Ve(r){var e=r[0],t=r[1];return[t[0]-e[0],t[1]-e[1]]}function nt(r,e){return r[0]*e[1]-e[0]*r[1]}function Rn(r,e){return[r[0]+e[0],r[1]+e[1]]}function Nn(r,e){return[r[0]-e[0],r[1]-e[1]]}function Dn(r,e){return[r*e[0],r*e[1]]}function Bn(r,e){var t=r[0],n=Ve(r),o=e[0],i=Ve(e),a=nt(n,i),u=Nn(o,t),s=nt(u,i),l=s/a,v=Rn(t,Dn(l,n));return v}function Yn(r,e){var t=Ve(r),n=Ve(e);return nt(t,n)===0}function Gn(r,e){return Yn(r,e)?!1:Bn(r,e)}function Nt(r,e,t){if(t=t||{},!ke(t))throw new Error("options is invalid");var n=t.units;if(!r)throw new Error("geojson is required");if(e==null||isNaN(e))throw new Error("distance is required");var o=Br(r),i=r.properties;switch(o){case"LineString":return Dt(r,e,n);case"MultiLineString":var a=[];return ue(r,function(u){a.push(Dt(u,e,n).geometry.coordinates)}),We(a,i);default:throw new Error("geometry "+o+" is not supported")}}function Dt(r,e,t){var n=[],o=ir(e,t),i=G(r),a=[];return i.forEach(function(u,s){if(s!==i.length-1){var l=Vn(u,i[s+1],o);if(n.push(l),s>0){var v=n[s-1],h=Gn(l,v);h!==!1&&(v[1]=h,l[0]=h),a.push(v[0]),s===i.length-2&&(a.push(l[0]),a.push(l[1]))}i.length===2&&(a.push(l[0]),a.push(l[1]))}}),B(a,r.properties)}function Vn(r,e,t){var n=Math.sqrt((r[0]-e[0])*(r[0]-e[0])+(r[1]-e[1])*(r[1]-e[1])),o=r[0]+t*(e[1]-r[1])/n,i=e[0]+t*(e[1]-r[1])/n,a=r[1]+t*(r[0]-e[0])/n,u=e[1]+t*(r[0]-e[0])/n;return[[o,a],[i,u]]}function Un(r,e){e===void 0&&(e={});var t,n,o,i=e.properties,a=(t=e.autoComplete)!==null&&t!==void 0?t:!0,u=(n=e.orderCoords)!==null&&n!==void 0?n:!0,s=(o=e.mutate)!==null&&o!==void 0?o:!1;switch(s||(r=Kt(r)),r.type){case"FeatureCollection":var l=[];return r.features.forEach(function(v){l.push(G(Bt(v,{},a,u)))}),Qe(l,i);default:return Bt(r,i,a,u)}}function Bt(r,e,t,n){e=e||(r.type==="Feature"?r.properties:{});var o=he(r),i=o.coordinates,a=o.type;if(!i.length)throw new Error("line must contain coordinates");switch(a){case"LineString":return t&&(i=Yt(i)),me([i],e);case"MultiLineString":var u=[],s=0;return i.forEach(function(l){if(t&&(l=Yt(l)),n){var v=Xn(Ge(B(l)));v>s?(u.unshift(l),s=v):u.push(l)}else u.push(l)}),me(u,e);default:throw new Error("geometry type "+a+" is not supported")}}function Yt(r){var e=r[0],t=e[0],n=e[1],o=r[r.length-1],i=o[0],a=o[1];return(t!==i||n!==a)&&r.push(e),r}function Xn(r){var e=r[0],t=r[1],n=r[2],o=r[3];return Math.abs(e-n)*Math.abs(t-o)}/**
 * splaytree v3.1.1
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function zn(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(l){return function(v){return s([l,v])}}function s(l){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,o&&(i=l[0]&2?o.return:l[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,l[1])).done)return i;switch(o=0,i&&(l=[l[0]&2,i.value]),l[0]){case 0:case 1:i=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,o=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){t.label=l[1];break}if(l[0]===6&&t.label<i[1]){t.label=i[1],i=l;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(l);break}i[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(v){l=[6,v],o=0}finally{n=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}var se=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function qn(r,e){return r>e?1:r<e?-1:0}function ie(r,e,t){for(var n=new se(null,null),o=n,i=n;;){var a=t(r,e.key);if(a<0){if(e.left===null)break;if(t(r,e.left.key)<0){var u=e.left;if(e.left=u.right,u.right=e,e=u,e.left===null)break}i.left=e,i=e,e=e.left}else if(a>0){if(e.right===null)break;if(t(r,e.right.key)>0){var u=e.right;if(e.right=u.left,u.left=e,e=u,e.right===null)break}o.right=e,o=e,e=e.right}else break}return o.right=e.left,i.left=e.right,e.left=n.right,e.right=n.left,e}function je(r,e,t,n){var o=new se(r,e);if(t===null)return o.left=o.right=null,o;t=ie(r,t,n);var i=n(r,t.key);return i<0?(o.left=t.left,o.right=t,t.left=null):i>=0&&(o.right=t.right,o.left=t,t.right=null),o}function Gt(r,e,t){var n=null,o=null;if(e){e=ie(r,e,t);var i=t(e.key,r);i===0?(n=e.left,o=e.right):i<0?(o=e.right,e.right=null,n=e):(n=e.left,e.left=null,o=e)}return{left:n,right:o}}function Zn(r,e,t){return e===null?r:(r===null||(e=ie(r.key,e,t),e.left=r),e)}function it(r,e,t,n,o){if(r){n(""+e+(t?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 ")+o(r)+`
`);var i=e+(t?"    ":"\u2502   ");r.left&&it(r.left,i,!1,n,o),r.right&&it(r.right,i,!0,n,o)}}var Et=function(){function r(e){e===void 0&&(e=qn),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=je(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new se(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var o=this._comparator,i=ie(e,this._root,o),a=o(e,i.key);return a===0?this._root=i:(a<0?(n.left=i.left,n.right=i,i.left=null):a>0&&(n.right=i.right,n.left=i,i.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var o;if(t===null)return null;t=ie(e,t,n);var i=n(e,t.key);return i===0?(t.left===null?o=t.right:(o=ie(e,t.left,n),o.right=t.right),this._size--,o):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=ie(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var o=n(e,t.key);if(o===0)return t;o<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=ie(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var o=n(e,t.key);if(o===0)return!0;o<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,o=[],i=!1;!i;)n!==null?(o.push(n),n=n.left):o.length!==0?(n=o.pop(),e.call(t,n),n=n.right):i=!0;return this},r.prototype.range=function(e,t,n,o){for(var i=[],a=this._comparator,u=this._root,s;i.length!==0||u;)if(u)i.push(u),u=u.left;else{if(u=i.pop(),s=a(u.key,t),s>0)break;if(a(u.key,e)>=0&&n.call(o,u))return this;u=u.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,o=0,i=[];!n;)if(t)i.push(t),t=t.left;else if(i.length>0){if(t=i.pop(),o===e)return t;o++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var o=this._comparator;t;){var i=o(e.key,t.key);if(i===0)break;i<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var o=this._comparator;t;){var i=o(e.key,t.key);if(i===0)break;i<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return Wn(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var o=e.length,i=this._comparator;if(n&&ut(e,t,0,o-1,i),this._root===null)this._root=ot(e,t,0,o),this._size=o;else{var a=Qn(this.toList(),Jn(e,t),i);o=this._size+o,this._root=at({head:a},0,o)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return it(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var o=this._comparator,i=Gt(e,this._root,o),a=i.left,u=i.right;o(e,t)<0?u=je(t,n,u,o):a=je(t,n,a,o),this._root=Zn(a,u,o)},r.prototype.split=function(e){return Gt(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e;return zn(this,function(t){switch(t.label){case 0:e=this.minNode(),t.label=1;case 1:return e?[4,e]:[3,3];case 2:return t.sent(),e=this.next(e),[3,1];case 3:return[2]}})},r}();function ot(r,e,t,n){var o=n-t;if(o>0){var i=t+Math.floor(o/2),a=r[i],u=e[i],s=new se(a,u);return s.left=ot(r,e,t,i),s.right=ot(r,e,i+1,n),s}return null}function Jn(r,e){for(var t=new se(null,null),n=t,o=0;o<r.length;o++)n=n.next=new se(r[o],e[o]);return n.next=null,t.next}function Wn(r){for(var e=r,t=[],n=!1,o=new se(null,null),i=o;!n;)e?(t.push(e),e=e.left):t.length>0?(e=i=i.next=t.pop(),e=e.right):n=!0;return i.next=null,o.next}function at(r,e,t){var n=t-e;if(n>0){var o=e+Math.floor(n/2),i=at(r,e,o),a=r.head;return a.left=i,r.head=r.head.next,a.right=at(r,o+1,t),a}return null}function Qn(r,e,t){for(var n=new se(null,null),o=n,i=r,a=e;i!==null&&a!==null;)t(i.key,a.key)<0?(o.next=i,i=i.next):(o.next=a,a=a.next),o=o.next;return i!==null?o.next=i:a!==null&&(o.next=a),n.next}function ut(r,e,t,n,o){if(!(t>=n)){for(var i=r[t+n>>1],a=t-1,u=n+1;;){do a++;while(o(r[a],i)<0);do u--;while(o(r[u],i)>0);if(a>=u)break;var s=r[a];r[a]=r[u],r[u]=s,s=e[a],e[a]=e[u],e[u]=s}ut(r,e,t,u,o),ut(r,e,u+1,n,o)}}function U(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function Vt(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function D(r,e,t){return e&&Vt(r.prototype,e),t&&Vt(r,t),r}var Me=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},st=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,o=e.ur.x<t.ur.x?e.ur.x:t.ur.x,i=e.ll.y<t.ll.y?t.ll.y:e.ll.y,a=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:n,y:i},ur:{x:o,y:a}}},oe=Number.EPSILON;oe===void 0&&(oe=Math.pow(2,-52));var $n=oe*oe,lt=function(e,t){if(-oe<e&&e<oe&&-oe<t&&t<oe)return 0;var n=e-t;return n*n<$n*e*t?0:e<t?-1:1},Hn=function(){function r(){U(this,r),this.reset()}return D(r,[{key:"reset",value:function(){this.xRounder=new Ut,this.yRounder=new Ut}},{key:"round",value:function(t,n){return{x:this.xRounder.round(t),y:this.yRounder.round(n)}}}]),r}(),Ut=function(){function r(){U(this,r),this.tree=new Et,this.round(0)}return D(r,[{key:"round",value:function(t){var n=this.tree.add(t),o=this.tree.prev(n);if(o!==null&&lt(n.key,o.key)===0)return this.tree.remove(t),o.key;var i=this.tree.next(n);return i!==null&&lt(n.key,i.key)===0?(this.tree.remove(t),i.key):t}}]),r}(),Oe=new Hn,_e=function(e,t){return e.x*t.y-e.y*t.x},gr=function(e,t){return e.x*t.x+e.y*t.y},Xt=function(e,t,n){var o={x:t.x-e.x,y:t.y-e.y},i={x:n.x-e.x,y:n.y-e.y},a=_e(o,i);return lt(a,0)},Ue=function(e){return Math.sqrt(gr(e,e))},Kn=function(e,t,n){var o={x:t.x-e.x,y:t.y-e.y},i={x:n.x-e.x,y:n.y-e.y};return _e(i,o)/Ue(i)/Ue(o)},jn=function(e,t,n){var o={x:t.x-e.x,y:t.y-e.y},i={x:n.x-e.x,y:n.y-e.y};return gr(i,o)/Ue(i)/Ue(o)},zt=function(e,t,n){return t.y===0?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},qt=function(e,t,n){return t.x===0?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},ei=function(e,t,n,o){if(t.x===0)return qt(n,o,e.x);if(o.x===0)return qt(e,t,n.x);if(t.y===0)return zt(n,o,e.y);if(o.y===0)return zt(e,t,n.y);var i=_e(t,o);if(i==0)return null;var a={x:n.x-e.x,y:n.y-e.y},u=_e(a,t)/i,s=_e(a,o)/i,l=e.x+s*t.x,v=n.x+u*o.x,h=e.y+s*t.y,d=n.y+u*o.y,g=(l+v)/2,m=(h+d)/2;return{x:g,y:m}},H=function(){D(r,null,[{key:"compare",value:function(t,n){var o=r.comparePoints(t.point,n.point);return o!==0?o:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:Xe.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(t,n){return t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0}}]);function r(e,t){U(this,r),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}return D(r,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var n=t.point.events,o=0,i=n.length;o<i;o++){var a=n[o];this.point.events.push(a),a.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,n=0;n<t;n++){var o=this.point.events[n];if(o.segment.consumedBy===void 0)for(var i=n+1;i<t;i++){var a=this.point.events[i];a.consumedBy===void 0&&o.otherSE.point.events===a.otherSE.point.events&&o.segment.consume(a.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],n=0,o=this.point.events.length;n<o;n++){var i=this.point.events[n];i!==this&&!i.segment.ringOut&&i.segment.isInResult()&&t.push(i)}return t}},{key:"getLeftmostComparator",value:function(t){var n=this,o=new Map,i=function(u){var s=u.otherSE;o.set(u,{sine:Kn(n.point,t.point,s.point),cosine:jn(n.point,t.point,s.point)})};return function(a,u){o.has(a)||i(a),o.has(u)||i(u);var s=o.get(a),l=s.sine,v=s.cosine,h=o.get(u),d=h.sine,g=h.cosine;return l>=0&&d>=0?v<g?1:v>g?-1:0:l<0&&d<0?v<g?-1:v>g?1:0:d<l?-1:d>l?1:0}}}]),r}(),ti=0,Xe=function(){D(r,null,[{key:"compare",value:function(t,n){var o=t.leftSE.point.x,i=n.leftSE.point.x,a=t.rightSE.point.x,u=n.rightSE.point.x;if(u<o)return 1;if(a<i)return-1;var s=t.leftSE.point.y,l=n.leftSE.point.y,v=t.rightSE.point.y,h=n.rightSE.point.y;if(o<i){if(l<s&&l<v)return 1;if(l>s&&l>v)return-1;var d=t.comparePoint(n.leftSE.point);if(d<0)return 1;if(d>0)return-1;var g=n.comparePoint(t.rightSE.point);return g!==0?g:-1}if(o>i){if(s<l&&s<h)return-1;if(s>l&&s>h)return 1;var m=n.comparePoint(t.leftSE.point);if(m!==0)return m;var y=t.comparePoint(n.rightSE.point);return y<0?1:y>0?-1:1}if(s<l)return-1;if(s>l)return 1;if(a<u){var S=n.comparePoint(t.rightSE.point);if(S!==0)return S}if(a>u){var P=t.comparePoint(n.rightSE.point);if(P<0)return 1;if(P>0)return-1}if(a!==u){var f=v-s,c=a-o,p=h-l,w=u-i;if(f>c&&p<w)return 1;if(f<c&&p>w)return-1}return a>u?1:a<u||v<h?-1:v>h?1:t.id<n.id?-1:t.id>n.id?1:0}}]);function r(e,t,n,o){U(this,r),this.id=++ti,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=o}return D(r,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<n?t:n},ur:{x:this.rightSE.point.x,y:t>n?t:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var n=this.leftSE.point,o=this.rightSE.point,i=this.vector();if(n.x===o.x)return t.x===n.x?0:t.x<n.x?1:-1;var a=(t.y-n.y)/i.y,u=n.x+a*i.x;if(t.x===u)return 0;var s=(t.x-n.x)/i.x,l=n.y+s*i.y;return t.y===l?0:t.y<l?-1:1}},{key:"getIntersection",value:function(t){var n=this.bbox(),o=t.bbox(),i=st(n,o);if(i===null)return null;var a=this.leftSE.point,u=this.rightSE.point,s=t.leftSE.point,l=t.rightSE.point,v=Me(n,s)&&this.comparePoint(s)===0,h=Me(o,a)&&t.comparePoint(a)===0,d=Me(n,l)&&this.comparePoint(l)===0,g=Me(o,u)&&t.comparePoint(u)===0;if(h&&v)return g&&!d?u:!g&&d?l:null;if(h)return d&&a.x===l.x&&a.y===l.y?null:a;if(v)return g&&u.x===s.x&&u.y===s.y?null:s;if(g&&d)return null;if(g)return u;if(d)return l;var m=ei(a,this.vector(),s,t.vector());return m===null||!Me(i,m)?null:Oe.round(m.x,m.y)}},{key:"split",value:function(t){var n=[],o=t.events!==void 0,i=new H(t,!0),a=new H(t,!1),u=this.rightSE;this.replaceRightSE(a),n.push(a),n.push(i);var s=new r(i,u,this.rings.slice(),this.windings.slice());return H.comparePoints(s.leftSE.point,s.rightSE.point)>0&&s.swapEvents(),H.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),o&&(i.checkForConsuming(),a.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,o=this.windings.length;n<o;n++)this.windings[n]*=-1}},{key:"consume",value:function(t){for(var n=this,o=t;n.consumedBy;)n=n.consumedBy;for(;o.consumedBy;)o=o.consumedBy;var i=r.compare(n,o);if(i!==0){if(i>0){var a=n;n=o,o=a}if(n.prev===o){var u=n;n=o,o=u}for(var s=0,l=o.rings.length;s<l;s++){var v=o.rings[s],h=o.windings[s],d=n.rings.indexOf(v);d===-1?(n.rings.push(v),n.windings.push(h)):n.windings[d]+=h}o.rings=null,o.windings=null,o.consumedBy=n,o.leftSE.consumedBy=n.leftSE,o.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,o=this._afterState.windings,i=this._afterState.multiPolys,a=0,u=this.rings.length;a<u;a++){var s=this.rings[a],l=this.windings[a],v=n.indexOf(s);v===-1?(n.push(s),o.push(l)):o[v]+=l}for(var h=[],d=[],g=0,m=n.length;g<m;g++)if(o[g]!==0){var y=n[g],S=y.poly;if(d.indexOf(S)===-1)if(y.isExterior)h.push(S);else{d.indexOf(S)===-1&&d.push(S);var P=h.indexOf(y.poly);P!==-1&&h.splice(P,1)}}for(var f=0,c=h.length;f<c;f++){var p=h[f].multiPoly;i.indexOf(p)===-1&&i.push(p)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(q.type){case"union":{var o=t.length===0,i=n.length===0;this._isInResult=o!==i;break}case"intersection":{var a,u;t.length<n.length?(a=t.length,u=n.length):(a=n.length,u=t.length),this._isInResult=u===q.numMultiPolys&&a<u;break}case"xor":{var s=Math.abs(t.length-n.length);this._isInResult=s%2===1;break}case"difference":{var l=function(h){return h.length===1&&h[0].isSubject};this._isInResult=l(t)!==l(n);break}default:throw new Error("Unrecognized operation type found ".concat(q.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,o){var i,a,u,s=H.comparePoints(t,n);if(s<0)i=t,a=n,u=1;else if(s>0)i=n,a=t,u=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var l=new H(i,!0),v=new H(a,!1);return new r(l,v,[o],[u])}}]),r}(),Zt=function(){function r(e,t,n){if(U(this,r),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var o=Oe.round(e[0][0],e[0][1]);this.bbox={ll:{x:o.x,y:o.y},ur:{x:o.x,y:o.y}};for(var i=o,a=1,u=e.length;a<u;a++){if(typeof e[a][0]!="number"||typeof e[a][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var s=Oe.round(e[a][0],e[a][1]);s.x===i.x&&s.y===i.y||(this.segments.push(Xe.fromRing(i,s,this)),s.x<this.bbox.ll.x&&(this.bbox.ll.x=s.x),s.y<this.bbox.ll.y&&(this.bbox.ll.y=s.y),s.x>this.bbox.ur.x&&(this.bbox.ur.x=s.x),s.y>this.bbox.ur.y&&(this.bbox.ur.y=s.y),i=s)}(o.x!==i.x||o.y!==i.y)&&this.segments.push(Xe.fromRing(i,o,this))}return D(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,o=this.segments.length;n<o;n++){var i=this.segments[n];t.push(i.leftSE),t.push(i.rightSE)}return t}}]),r}(),ri=function(){function r(e,t){if(U(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Zt(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var n=1,o=e.length;n<o;n++){var i=new Zt(e[n],this,!1);i.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=i.bbox.ll.x),i.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=i.bbox.ll.y),i.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=i.bbox.ur.x),i.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=i.bbox.ur.y),this.interiorRings.push(i)}this.multiPoly=t}return D(r,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),n=0,o=this.interiorRings.length;n<o;n++)for(var i=this.interiorRings[n].getSweepEvents(),a=0,u=i.length;a<u;a++)t.push(i[a]);return t}}]),r}(),Jt=function(){function r(e,t){if(U(this,r),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var n=0,o=e.length;n<o;n++){var i=new ri(e[n],this);i.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=i.bbox.ll.x),i.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=i.bbox.ll.y),i.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=i.bbox.ur.x),i.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=i.bbox.ur.y),this.polys.push(i)}this.isSubject=t}return D(r,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,o=this.polys.length;n<o;n++)for(var i=this.polys[n].getSweepEvents(),a=0,u=i.length;a<u;a++)t.push(i[a]);return t}}]),r}(),ni=function(){D(r,null,[{key:"factory",value:function(t){for(var n=[],o=0,i=t.length;o<i;o++){var a=t[o];if(!(!a.isInResult()||a.ringOut)){for(var u=null,s=a.leftSE,l=a.rightSE,v=[s],h=s.point,d=[];u=s,s=l,v.push(s),s.point!==h;)for(;;){var g=s.getAvailableLinkedEvents();if(g.length===0){var m=v[0].point,y=v[v.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(m.x,",")+" ".concat(m.y,"]. Last matching segment found ends at")+" [".concat(y.x,", ").concat(y.y,"]."))}if(g.length===1){l=g[0].otherSE;break}for(var S=null,P=0,f=d.length;P<f;P++)if(d[P].point===s.point){S=P;break}if(S!==null){var c=d.splice(S)[0],p=v.splice(c.index);p.unshift(p[0].otherSE),n.push(new r(p.reverse()));continue}d.push({index:v.length,point:s.point});var w=s.getLeftmostComparator(u);l=g.sort(w)[0].otherSE;break}n.push(new r(v))}}return n}}]);function r(e){U(this,r),this.events=e;for(var t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}return D(r,[{key:"getGeom",value:function(){for(var t=this.events[0].point,n=[t],o=1,i=this.events.length-1;o<i;o++){var a=this.events[o].point,u=this.events[o+1].point;Xt(a,t,u)!==0&&(n.push(a),t=a)}if(n.length===1)return null;var s=n[0],l=n[1];Xt(s,t,l)===0&&n.shift(),n.push(n[0]);for(var v=this.isExteriorRing()?1:-1,h=this.isExteriorRing()?0:n.length-1,d=this.isExteriorRing()?n.length:-1,g=[],m=h;m!=d;m+=v)g.push([n[m].x,n[m].y]);return g}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],n=1,o=this.events.length;n<o;n++){var i=this.events[n];H.compare(t,i)>0&&(t=i)}for(var a=t.segment.prevInResult(),u=a?a.prevInResult():null;;){if(!a)return null;if(!u)return a.ringOut;if(u.ringOut!==a.ringOut)return u.ringOut.enclosingRing()!==a.ringOut?a.ringOut:a.ringOut.enclosingRing();a=u.prevInResult(),u=a?a.prevInResult():null}}}]),r}(),Wt=function(){function r(e){U(this,r),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return D(r,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var n=0,o=this.interiorRings.length;n<o;n++){var i=this.interiorRings[n].getGeom();i!==null&&t.push(i)}return t}}]),r}(),ii=function(){function r(e){U(this,r),this.rings=e,this.polys=this._composePolys(e)}return D(r,[{key:"getGeom",value:function(){for(var t=[],n=0,o=this.polys.length;n<o;n++){var i=this.polys[n].getGeom();i!==null&&t.push(i)}return t}},{key:"_composePolys",value:function(t){for(var n=[],o=0,i=t.length;o<i;o++){var a=t[o];if(!a.poly)if(a.isExteriorRing())n.push(new Wt(a));else{var u=a.enclosingRing();u.poly||n.push(new Wt(u)),u.poly.addInterior(a)}}return n}}]),r}(),oi=function(){function r(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Xe.compare;U(this,r),this.queue=e,this.tree=new Et(t),this.segments=[]}return D(r,[{key:"process",value:function(t){var n=t.segment,o=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(n),o;var i=t.isLeft?this.tree.insert(n):this.tree.find(n);if(!i)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var a=i,u=i,s=void 0,l=void 0;s===void 0;)a=this.tree.prev(a),a===null?s=null:a.key.consumedBy===void 0&&(s=a.key);for(;l===void 0;)u=this.tree.next(u),u===null?l=null:u.key.consumedBy===void 0&&(l=u.key);if(t.isLeft){var v=null;if(s){var h=s.getIntersection(n);if(h!==null&&(n.isAnEndpoint(h)||(v=h),!s.isAnEndpoint(h)))for(var d=this._splitSafely(s,h),g=0,m=d.length;g<m;g++)o.push(d[g])}var y=null;if(l){var S=l.getIntersection(n);if(S!==null&&(n.isAnEndpoint(S)||(y=S),!l.isAnEndpoint(S)))for(var P=this._splitSafely(l,S),f=0,c=P.length;f<c;f++)o.push(P[f])}if(v!==null||y!==null){var p=null;if(v===null)p=y;else if(y===null)p=v;else{var w=H.comparePoints(v,y);p=w<=0?v:y}this.queue.remove(n.rightSE),o.push(n.rightSE);for(var E=n.split(p),x=0,b=E.length;x<b;x++)o.push(E[x])}o.length>0?(this.tree.remove(n),o.push(t)):(this.segments.push(n),n.prev=s)}else{if(s&&l){var M=s.getIntersection(l);if(M!==null){if(!s.isAnEndpoint(M))for(var C=this._splitSafely(s,M),I=0,_=C.length;I<_;I++)o.push(C[I]);if(!l.isAnEndpoint(M))for(var L=this._splitSafely(l,M),O=0,k=L.length;O<k;O++)o.push(L[O])}}this.tree.remove(n)}return o}},{key:"_splitSafely",value:function(t,n){this.tree.remove(t);var o=t.rightSE;this.queue.remove(o);var i=t.split(n);return i.push(o),t.consumedBy===void 0&&this.tree.insert(t),i}}]),r}(),Qt=typeof process<"u"&&process.env.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,ai=typeof process<"u"&&process.env.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,ui=function(){function r(){U(this,r)}return D(r,[{key:"run",value:function(t,n,o){q.type=t,Oe.reset();for(var i=[new Jt(n,!0)],a=0,u=o.length;a<u;a++)i.push(new Jt(o[a],!1));if(q.numMultiPolys=i.length,q.type==="difference")for(var s=i[0],l=1;l<i.length;)st(i[l].bbox,s.bbox)!==null?l++:i.splice(l,1);if(q.type==="intersection"){for(var v=0,h=i.length;v<h;v++)for(var d=i[v],g=v+1,m=i.length;g<m;g++)if(st(d.bbox,i[g].bbox)===null)return[]}for(var y=new Et(H.compare),S=0,P=i.length;S<P;S++)for(var f=i[S].getSweepEvents(),c=0,p=f.length;c<p;c++)if(y.insert(f[c]),y.size>Qt)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var w=new oi(y),E=y.size,x=y.pop();x;){var b=x.key;if(y.size===E){var M=b.segment;throw new Error("Unable to pop() ".concat(b.isLeft?"left":"right"," SweepEvent ")+"[".concat(b.point.x,", ").concat(b.point.y,"] from segment #").concat(M.id," ")+"[".concat(M.leftSE.point.x,", ").concat(M.leftSE.point.y,"] -> ")+"[".concat(M.rightSE.point.x,", ").concat(M.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(y.size>Qt)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(w.segments.length>ai)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var C=w.process(b),I=0,_=C.length;I<_;I++){var L=C[I];L.consumedBy===void 0&&y.insert(L)}E=y.size,x=y.pop()}Oe.reset();var O=ni.factory(w.segments),k=new ii(O);return k.getGeom()}}]),r}(),q=new ui,si=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return q.run("union",e,n)},li=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return q.run("intersection",e,n)},fi=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return q.run("xor",e,n)},ci=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return q.run("difference",e,n)},hi={union:si,intersection:li,xor:fi,difference:ci};function vi(r,e){var t=he(r),n=he(e),o=r.properties||{},i=hi.difference(t.coordinates,n.coordinates);return i.length===0?null:i.length===1?me(i[0],o):Qe(i,o)}const Ee="split_polygon",yr=`${Ee}_passing_draw_line_string`,xt=`${Ee}_highlight`,De={highlightColor:"#222",lineWidth:0,lineWidthUnit:"kilometers",onSelectFeatureRequest(){throw new Error("no Feature is selected to split.")}},Pe={};Pe.onSetup=function(r){const{featureIds:e=[],highlightColor:t=De.highlightColor,lineWidth:n=De.lineWidth,lineWidthUnit:o=De.lineWidthUnit,onSelectFeatureRequest:i=De.onSelectFeatureRequest}=r||{},a=this._ctx.api,u=[],s=this.getSelected();if(e.length!==0)u.push.apply(u,e.map(v=>a.get(v)));else if(s.length!==0)u.push.apply(u,s.filter(v=>v.type===N.POLYGON||v.type===N.MULTI_POLYGON).map(v=>v.toGeoJSON()));else return i();const l={options:{highlightColor:t,lineWidth:n,lineWidthUnit:o},featuresToSplit:u,api:a};return setTimeout(this.drawAndSplit.bind(this,l),0),this.highlighFeatures(l),l};Pe.drawAndSplit=function(r){const{api:e,options:t}=r,{lineWidth:n,lineWidthUnit:o}=t;try{this.changeMode(yr,{onDraw:i=>{const a=[];r.featuresToSplit.forEach(u=>{if(dr(u,i)){console.info(`Line was outside of Polygon ${u.id}`),a.push(u);return}else if(n===0){const s=pi(u.geometry,i.geometry);s.id=u.id,e.add(s),a.push(s)}else{const s=di(u.geometry,i.geometry,{line_width:n,line_width_unit:o});s.id=u.id,e.add(s),a.push(s)}}),this.fireUpdate(a),this.highlighFeatures(r,!1)},onCancel:()=>{this.highlighFeatures(r,!1)}})}catch(i){console.error("\u{1F680} ~ file: mode.js ~ line 116 ~ err",i)}};Pe.highlighFeatures=function(r,e=!0){const t=e?r.options.highlightColor:void 0;r.featuresToSplit.forEach(n=>{r.api.setFeatureProperty(n.id,xt,t)})};Pe.toDisplayFeatures=function(r,e,t){t(e)};Pe.fireUpdate=function(r){this.map.fire(ze.UPDATE,{action:Ee,features:r})};function pi(r,e){return hn(r,e)}function di(r,e,t){const{line_width:n,line_width_unit:o}=t||{},i=[],a=null;let u,s,l,v,h,d,g;if(typeof n>"u"||typeof o>"u"||r.type!=N.POLYGON&&r.type!=N.MULTI_POLYGON||e.type!=N.LINE_STRING||dr(e,r)||(l=$e(r,e),l.features.length===0))return a;for(i[0]=Nt(e,n,{units:o}),i[1]=Nt(e,-n,{units:o}),u=0;u<=1;u++){v=u;const m=[];for(s=0;s<e.coordinates.length;s++)m.push(e.coordinates[s]);for(s=i[v].geometry.coordinates.length-1;s>=0;s--)m.push(i[v].geometry.coordinates[s]);m.push(e.coordinates[0]),h=B(m),d=Un(h),g=vi(r,d)}return g}const ge=`user_${xt}`,gi=r=>r.map(e=>e.id.endsWith("inactive")?{...e,filter:[...e.filter,["!has",ge]]}:e).concat([{id:`${Ee}-fill-active`,type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["has",ge]],paint:{"fill-color":["get",ge],"fill-outline-color":["get",ge],"fill-opacity":.1}},{id:`${Ee}-stroke-active`,type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["has",ge]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["get",ge],"line-dasharray":[.2,2],"line-width":2}}]),j={};j.onSetup=function(){const r=this.newFeature({type:N.FEATURE,properties:{},geometry:{type:N.POINT,coordinates:[]}});return this.addFeature(r),this.clearSelectedFeatures(),this.updateUIClasses({mouse:Y.ADD}),this.activateUIButton(ht.POINT),this.setActionableState({trash:!0}),{point:r}};j.stopDrawingAndRemove=function(r){this.deleteFeature([r.point.id],{silent:!0}),this.changeMode(A.SIMPLE_SELECT)};j.onTap=j.onClick=function(r,e){this.updateUIClasses({mouse:Y.MOVE}),r.point.updateCoordinate("",e.lngLat.lng,e.lngLat.lat),this.map.fire(ze.CREATE,{features:[r.point.toGeoJSON()]}),this.changeMode(A.SIMPLE_SELECT,{featureIds:[r.point.id]})};j.onStop=function(r){this.activateUIButton(),r.point.getCoordinate().length||this.deleteFeature([r.point.id],{silent:!0})};j.toDisplayFeatures=function(r,e,t){const n=e.properties.id===r.point.id;if(e.properties.active=n?ae.ACTIVE:ae.INACTIVE,!n)return t(e)};j.onTrash=j.stopDrawingAndRemove;j.onKeyUp=function(r,e){if(Je(e)||vt(e))return this.stopDrawingAndRemove(r,e)};const{onSetup:yi,onClick:mi,...wi}=j;({...wi});function ft(r,e){return r.lngLat?r.lngLat.lng===e[0]&&r.lngLat.lat===e[1]:!1}function ct(r,e,t,n){return{type:N.FEATURE,properties:{meta:qe.VERTEX,parent:r,coord_path:t,active:n?ae.ACTIVE:ae.INACTIVE},geometry:{type:N.POINT,coordinates:e}}}const J={};J.onSetup=function(r){r=r||{};const e=r.featureId;let t,n,o="forward";if(e){if(t=this.getFeature(e),!t)throw new Error("Could not find a feature with the provided featureId");let i=r.from;if(i&&i.type==="Feature"&&i.geometry&&i.geometry.type==="Point"&&(i=i.geometry),i&&i.type==="Point"&&i.coordinates&&i.coordinates.length===2&&(i=i.coordinates),!i||!Array.isArray(i))throw new Error("Please use the `from` property to indicate which point to continue the line from");const a=t.coordinates.length-1;if(t.coordinates[a][0]===i[0]&&t.coordinates[a][1]===i[1])n=a+1,t.addCoordinate(n,...t.coordinates[a]);else if(t.coordinates[0][0]===i[0]&&t.coordinates[0][1]===i[1])o="backwards",n=0,t.addCoordinate(n,...t.coordinates[0]);else throw new Error("`from` should match the point at either the start or the end of the provided LineString")}else t=this.newFeature({type:N.FEATURE,properties:{},geometry:{type:N.LINE_STRING,coordinates:[]}}),n=0,this.addFeature(t);return this.clearSelectedFeatures(),xe.disable(this),this.updateUIClasses({mouse:Y.ADD}),this.activateUIButton(ht.LINE),this.setActionableState({trash:!0}),{line:t,currentVertexPosition:n,direction:o}};J.clickAnywhere=function(r,e){if(r.currentVertexPosition>0&&ft(e,r.line.coordinates[r.currentVertexPosition-1])||r.direction==="backwards"&&ft(e,r.line.coordinates[r.currentVertexPosition+1]))return this.changeMode(A.SIMPLE_SELECT,{featureIds:[r.line.id]});this.updateUIClasses({mouse:Y.ADD}),r.line.updateCoordinate(r.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),r.direction==="forward"?(r.currentVertexPosition++,r.line.updateCoordinate(r.currentVertexPosition,e.lngLat.lng,e.lngLat.lat)):r.line.addCoordinate(0,e.lngLat.lng,e.lngLat.lat)};J.clickOnVertex=function(r){return this.changeMode(A.SIMPLE_SELECT,{featureIds:[r.line.id]})};J.onMouseMove=function(r,e){r.line.updateCoordinate(r.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),Ze(e)&&this.updateUIClasses({mouse:Y.POINTER})};J.onTap=J.onClick=function(r,e){if(Ze(e))return this.clickOnVertex(r,e);this.clickAnywhere(r,e)};J.onKeyUp=function(r,e){vt(e)?this.changeMode(A.SIMPLE_SELECT,{featureIds:[r.line.id]}):Je(e)&&(this.deleteFeature([r.line.id],{silent:!0}),this.changeMode(A.SIMPLE_SELECT))};J.onStop=function(r){xe.enable(this),this.activateUIButton(),this.getFeature(r.line.id)!==void 0&&(r.line.removeCoordinate(`${r.currentVertexPosition}`),r.line.isValid()?this.map.fire(ze.CREATE,{features:[r.line.toGeoJSON()]}):(this.deleteFeature([r.line.id],{silent:!0}),this.changeMode(A.SIMPLE_SELECT,{},{silent:!0})))};J.onTrash=function(r){this.deleteFeature([r.line.id],{silent:!0}),this.changeMode(A.SIMPLE_SELECT)};J.toDisplayFeatures=function(r,e,t){const n=e.properties.id===r.line.id;if(e.properties.active=n?ae.ACTIVE:ae.INACTIVE,!n)return t(e);e.geometry.coordinates.length<2||(e.properties.meta=qe.FEATURE,t(ct(r.line.id,e.geometry.coordinates[r.direction==="forward"?e.geometry.coordinates.length-2:1],`${r.direction==="forward"?e.geometry.coordinates.length-2:1}`,!1)),t(e))};const{onSetup:Ei,onMouseMove:xi,...bi}=J,He={originOnSetup:Ei,originOnMouseMove:xi,...bi};He.onSetup=function(r){const e=this.originOnSetup(),{onDraw:t,onCancel:n}=r;return e.onDraw=t,e.onCancel=n,e};He.onMouseMove=function(r,e){this.updateUIClasses({mouse:Y.ADD}),this.originOnMouseMove(r,e)};He.onStop=function(r){const e=r.line;if(this.updateUIClasses({mouse:Y.NONE}),xe.enable(this),this.activateUIButton(),this.getFeature(e.id)===void 0){typeof r.onCancel=="function"&&r.onCancel();return}else e.removeCoordinate(`${r.currentVertexPosition}`);e.isValid()&&(typeof r.onDraw=="function"?r.onDraw(e.toGeoJSON()):this.map.fire("draw.passing-create",{features:[e.toGeoJSON()]})),this.deleteFeature([e.id],{silent:!0}),this.changeMode(A.SIMPLE_SELECT,{},{silent:!0})};const W={};W.onSetup=function(){const r=this.newFeature({type:N.FEATURE,properties:{},geometry:{type:N.POLYGON,coordinates:[[]]}});return this.addFeature(r),this.clearSelectedFeatures(),xe.disable(this),this.updateUIClasses({mouse:Y.ADD}),this.activateUIButton(ht.POLYGON),this.setActionableState({trash:!0}),{polygon:r,currentVertexPosition:0}};W.clickAnywhere=function(r,e){if(r.currentVertexPosition>0&&ft(e,r.polygon.coordinates[0][r.currentVertexPosition-1]))return this.changeMode(A.SIMPLE_SELECT,{featureIds:[r.polygon.id]});this.updateUIClasses({mouse:Y.ADD}),r.polygon.updateCoordinate(`0.${r.currentVertexPosition}`,e.lngLat.lng,e.lngLat.lat),r.currentVertexPosition++,r.polygon.updateCoordinate(`0.${r.currentVertexPosition}`,e.lngLat.lng,e.lngLat.lat)};W.clickOnVertex=function(r){return this.changeMode(A.SIMPLE_SELECT,{featureIds:[r.polygon.id]})};W.onMouseMove=function(r,e){r.polygon.updateCoordinate(`0.${r.currentVertexPosition}`,e.lngLat.lng,e.lngLat.lat),Ze(e)&&this.updateUIClasses({mouse:Y.POINTER})};W.onTap=W.onClick=function(r,e){return Ze(e)?this.clickOnVertex(r,e):this.clickAnywhere(r,e)};W.onKeyUp=function(r,e){Je(e)?(this.deleteFeature([r.polygon.id],{silent:!0}),this.changeMode(A.SIMPLE_SELECT)):vt(e)&&this.changeMode(A.SIMPLE_SELECT,{featureIds:[r.polygon.id]})};W.onStop=function(r){this.updateUIClasses({mouse:Y.NONE}),xe.enable(this),this.activateUIButton(),this.getFeature(r.polygon.id)!==void 0&&(r.polygon.removeCoordinate(`0.${r.currentVertexPosition}`),r.polygon.isValid()?this.map.fire(ze.CREATE,{features:[r.polygon.toGeoJSON()]}):(this.deleteFeature([r.polygon.id],{silent:!0}),this.changeMode(A.SIMPLE_SELECT,{},{silent:!0})))};W.toDisplayFeatures=function(r,e,t){const n=e.properties.id===r.polygon.id;if(e.properties.active=n?ae.ACTIVE:ae.INACTIVE,!n)return t(e);if(e.geometry.coordinates.length===0)return;const o=e.geometry.coordinates[0].length;if(!(o<3)){if(e.properties.meta=qe.FEATURE,t(ct(r.polygon.id,e.geometry.coordinates[0][0],"0.0",!1)),o>3){const i=e.geometry.coordinates[0].length-3;t(ct(r.polygon.id,e.geometry.coordinates[0][i],`0.${i}`,!1))}if(o<=4){const i=[[e.geometry.coordinates[0][0][0],e.geometry.coordinates[0][0][1]],[e.geometry.coordinates[0][1][0],e.geometry.coordinates[0][1][1]]];if(t({type:N.FEATURE,properties:e.properties,geometry:{coordinates:i,type:N.LINE_STRING}}),o===3)return}return t(e)}};W.onTrash=function(r){this.deleteFeature([r.polygon.id],{silent:!0}),this.changeMode(A.SIMPLE_SELECT)};const{onSetup:Pi,onMouseMove:Si,...Mi}=W;({...Mi});function Ii(r){return{...Ht(r),[yr]:He,[Ee]:Pe}}const{MODE:Ci}={BASE_URL:"/mapbox-gl-draw-split-polygon-mode/",MODE:"production",DEV:!1,PROD:!0};let Ie,Z,mr;function $t(r){try{Z==null||Z.changeMode("split_polygon",{featureIds:r,highlightColor:"#222"})}catch(e){console.error(e)}}function _i(){const r=Z.getSelectedIds();r.length>0?$t(r):Z.changeMode("select_feature",{selectHighlightColor:"yellow",onSelect(e){$t([e])}})}class Li{constructor(e){let t=this;t.draw=e.draw,t.buttons=e.buttons||[],t.onAddOrig=e.draw.onAdd,t.onRemoveOrig=e.draw.onRemove}onAdd(e){let t=this;return t.map=e,t.elContainer=t.onAddOrig(e),t.buttons.forEach(n=>{t.addButton(n)}),t.elContainer}onRemove(e){let t=this;t.buttons.forEach(n=>{t.removeButton(n)}),t.onRemoveOrig(e)}addButton(e){let t=this;var n=document.createElement("button");n.className="mapbox-gl-draw_ctrl-draw-btn",e.classes instanceof Array&&e.classes.forEach(o=>{n.classList.add(o)}),n.addEventListener(e.on,e.action),t.elContainer.appendChild(n),e.elButton=n}removeButton(e){e.elButton.removeEventListener(e.on,e.action),e.elButton.remove()}}mapboxgl.getRTLTextPluginStatus()==="unavailable"&&mapboxgl.setRTLTextPlugin("https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js",r=>{r&&console.error(r)},!0);Ie=new mapboxgl.Map({container:"map",style:Ci==="development"?{version:8,sources:{},layers:[]}:"https://map.ir/vector/styles/main/mapir-xyz-light-style.json",center:[51.3857,35.6102],zoom:7.78,pitch:0,interactive:!0,hash:!0,attributionControl:!0,customAttribution:"\xA9 Map \xA9 Openstreetmap",transformRequest:r=>({url:r,headers:{"x-api-key":"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImp0aSI6ImRiZWU0YWU4OTk4OTA3MmQ3OTFmMjQ4ZDE5N2VhZTgwZWU2NTUyYjhlYjczOWI2NDdlY2YyYzIzNWRiYThiMzIzOTM5MDkzZDM0NTY2MmU3In0.eyJhdWQiOiI5NDMyIiwianRpIjoiZGJlZTRhZTg5OTg5MDcyZDc5MWYyNDhkMTk3ZWFlODBlZTY1NTJiOGViNzM5YjY0N2VjZjJjMjM1ZGJhOGIzMjM5MzkwOTNkMzQ1NjYyZTciLCJpYXQiOjE1OTA4MjU0NzIsIm5iZiI6MTU5MDgyNTQ3MiwiZXhwIjoxNTkzNDE3NDcyLCJzdWIiOiIiLCJzY29wZXMiOlsiYmFzaWMiXX0.M_z4xJlJRuYrh8RFe9UrW89Y_XBzpPth4yk3hlT-goBm8o3x8DGCrSqgskFfmJTUD2wC2qSoVZzQKB67sm-swtD5fkxZO7C0lBCMAU92IYZwCdYehIOtZbP5L1Lfg3C6pxd0r7gQOdzcAZj9TStnKBQPK3jSvzkiHIQhb6I0sViOS_8JceSNs9ZlVelQ3gs77xM2ksWDM6vmqIndzsS-5hUd-9qdRDTLHnhdbS4_UBwNDza47Iqd5vZkBgmQ_oDZ7dVyBuMHiQFg28V6zhtsf3fijP0UhePCj4GM89g3tzYBOmuapVBobbX395FWpnNC3bYg7zDaVHcllSUYDjGc1A","Mapir-SDK":"reactjs"}})});Z=new MapboxDraw({modes:{...Ii(Ht(MapboxDraw.modes))},styles:[...gi(xr(wr))],userProperties:!0});window.draw=Z;mr=new Li({draw:Z,buttons:[{on:"click",action:_i,classes:["split-polygon"]}]});Ie.once("load",()=>{Ie.resize(),Ie.addControl(mr,"top-right"),Z.set({type:"FeatureCollection",features:[{id:"example",type:"Feature",properties:{},geometry:{coordinates:[[[[52,35],[53,35],[53,36],[52,36],[52,35]]],[[[50,35],[51,35],[51,36],[50,36],[50,35]],[[50.2,35.2],[50.8,35.2],[50.8,35.8],[50.2,35.8],[50.2,35.2]]]],type:"MultiPolygon"}}]}),Ie.on("draw.update",function(r){console.log("\u{1F680} ~ file: index.js ~ line 158 ~ e",r),r.action==="split_polygon"&&Z.getAll().features.forEach(({id:t})=>Z.setFeatureProperty(t,xt,void 0))})});
